<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>缪大厨美食</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FF5722', // 橙色作为主色调，代表食物和活力
            secondary: '#4CAF50', // 绿色作为辅助色，代表新鲜和健康
            accent: '#FFC107', // 黄色作为强调色，代表温暖和快乐
            dark: '#333333', // 深灰色作为文本颜色
            light: '#F5F5F5', // 浅灰色作为背景色
            love: '#FF4D6D', // 爱心专用粉色
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- 自定义工具类 -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }
      .btn-hover {
        transition: all 0.3s ease;
      }
      .btn-hover:hover {
        transform: translateY(-2px);
      }
      .food-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .food-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .love-heart {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: theme('colors.love');
        opacity: 0.8;
        transform: rotate(45deg);
        animation: fall 4s linear forwards, float 2s ease-in-out infinite;
        z-index: 50;
      }
      .love-heart:before, .love-heart:after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: theme('colors.love');
        border-radius: 50%;
      }
      .love-heart:before {
        top: -10px;
        left: 0;
      }
      .love-heart:after {
        top: 0;
        left: -10px;
      }
      @keyframes fall {
        0% {
          top: -10%;
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        100% {
          top: 100%;
          opacity: 0;
        }
      }
      @keyframes float {
        0%, 100% {
          transform: rotate(45deg) translateX(0);
        }
        50% {
          transform: rotate(45deg) translateX(15px);
        }
      }
      .love-text {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: theme('colors.love');
        font-size: 2rem;
        font-weight: bold;
        text-shadow: 0 0 15px rgba(255, 77, 109, 0.8);
        z-index: 60;
        opacity: 0;
        animation: fadeInOut 3s ease-in-out forwards;
      }
      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        30%, 70% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
      }

      /* 登录成功动画 */
      @keyframes ripple {
          0% {
              transform: scale(0);
              opacity: 0.8;
          }
          100% {
              transform: scale(2);
              opacity: 0;
          }
      }

      @keyframes welcomeText {
          0% {
              transform: translateY(20px);
              opacity: 0;
          }
          100% {
              transform: translateY(0);
              opacity: 1;
          }
      }

      @keyframes iconRotate {
          0% {
              transform: rotate(-180deg) scale(0);
              opacity: 0;
          }
          100% {
              transform: rotate(0) scale(1);
              opacity: 1;
          }
      }

      @keyframes backgroundShift {
          0% {
              background-position: 0% 50%;
          }
          50% {
              background-position: 100% 50%;
          }
          100% {
              background-position: 0% 50%;
          }
      }

      .login-success {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          background: linear-gradient(135deg, #ff6b6b, #ff8e8e, #ffb6b6);
          background-size: 400% 400%;
          animation: backgroundShift 8s ease infinite;
          z-index: 9999;
          overflow: hidden;
      }

      .login-success::before {
          content: '';
          position: absolute;
          width: 150px;
          height: 150px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.1);
          animation: ripple 2s ease-out infinite;
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      }

      .login-success::after {
          content: '';
          position: absolute;
          width: 150px;
          height: 150px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.1);
          animation: ripple 2s ease-out 1s infinite;
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      }

      .login-success-icon {
          font-size: 80px;
          color: white;
          margin-bottom: 20px;
          animation: iconRotate 1s ease-out;
          text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      .login-success-text {
          font-size: 28px;
          color: white;
          text-align: center;
          animation: welcomeText 1s ease-out;
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          font-weight: 500;
      }

      .login-success-subtext {
          font-size: 16px;
          color: rgba(255, 255, 255, 0.9);
          margin-top: 10px;
          animation: welcomeText 1s ease-out 0.3s backwards;
          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* 登录成功动画 */
      @keyframes heartBeat {
          0% {
              transform: scale(0.8);
              opacity: 0;
          }
          50% {
              transform: scale(1.2);
              opacity: 1;
          }
          100% {
              transform: scale(1);
              opacity: 0.8;
          }
      }

      @keyframes float {
          0% {
              transform: translateY(0) rotate(0deg);
          }
          50% {
              transform: translateY(-20px) rotate(10deg);
          }
          100% {
              transform: translateY(0) rotate(0deg);
          }
      }

      .heart-container {
          position: absolute;
          width: 100%;
          height: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
      }

      .heart {
          position: absolute;
          font-size: 100px;
          color: white;
          animation: heartBeat 1.5s ease-in-out infinite;
          text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      }

      .floating-hearts {
          position: absolute;
          width: 100%;
          height: 100%;
          pointer-events: none;
      }

      .floating-heart {
          position: absolute;
          font-size: 30px;
          color: rgba(255, 255, 255, 0.6);
          animation: float 3s ease-in-out infinite;
      }

      .login-success-text {
          font-size: 36px;
          color: white;
          text-align: center;
          margin-top: 20px;
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
          font-weight: bold;
          z-index: 2;
      }

      .login-success-subtext {
          font-size: 18px;
          color: rgba(255, 255, 255, 0.9);
          margin-top: 10px;
          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
          z-index: 2;
      }

      /* 优惠券样式 */
      .coupon-card {
        border: 2px dashed #FF5722;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        background: rgba(255, 87, 34, 0.05);
        transition: all 0.3s ease;
      }
      
      .coupon-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(255, 87, 34, 0.2);
      }
      
      .coupon-card.selected {
        background: rgba(255, 87, 34, 0.08);
        border-style: solid;
        border-width: 1px;
        border-color: #FF5722;
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.15);
        position: relative;
      }
      
      /* 添加选中状态的左侧边框标记 */
      .coupon-card.selected::before {
        content: '';
        position: absolute;
        left: -1px;
        top: 10px;
        bottom: 10px;
        width: 3px;
        background: #FF5722;
        border-radius: 0 2px 2px 0;
      }
      
      .coupon-card.selected::after {
        content: '✓';
        position: absolute;
        top: -10px;
        right: -10px;
        background: #FF5722;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      
      .coupon-discount {
        font-size: 24px;
        font-weight: bold;
        color: #FF5722;
      }
      
      .coupon-condition {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }

      /* 语音录音动画 */
      .voice-wave {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: rgba(255, 107, 107, 0.1);
        animation: voice-wave 2s infinite ease-out;
      }
      
      .delay-1 {
        animation-delay: 0.6s;
      }
      
      .delay-2 {
        animation-delay: 1.2s;
      }
      
      @keyframes voice-wave {
        0% {
          transform: scale(0.5);
          opacity: 1;
        }
        100% {
          transform: scale(1.5);
          opacity: 0;
        }
      }
      
      #voice-animation {
        position: relative;
        background-color: rgba(255, 107, 107, 0.1);
      }
      
      #voice-animation.recording .voice-wave {
        background-color: rgba(255, 107, 107, 0.2);
      }
      
      #voice-animation.recording i {
        color: #ff6b6b;
        animation: pulse 1s infinite;
      }
      
      @keyframes pulse {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }
    }
    
    /* 登录页面美食背景 */
    .food-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-position: center;
      filter: blur(3px) brightness(0.7);
      z-index: -1;
      animation: slowZoom 30s infinite alternate ease-in-out;
      transform-origin: center;
    }
    
    .food-bg::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.4) 0%, rgba(255, 184, 140, 0.4) 100%);
    }
    
    @keyframes slowZoom {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(1.1);
      }
    }
    
    .login-container {
      backdrop-filter: blur(10px);
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      animation: fadeInUp 0.8s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .login-title {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .floating-food {
      position: absolute;
      opacity: 0.8;
      filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
      animation: float 6s infinite ease-in-out;
      z-index: -1;
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
      }
      50% {
        transform: translateY(-20px) rotate(5deg);
      }
    }
  </style>
</head>

<body class="bg-light font-sans text-dark min-h-screen">
  <!-- 应用容器 -->
  <div id="app" class="min-h-screen flex flex-col">
    <!-- 登录页 -->
    <div id="login-page" class="flex flex-col items-center justify-center h-screen p-6">
      <!-- 美食背景 -->
      <div class="food-bg"></div>
      
      <!-- 漂浮的食物图标 -->
      <img src="https://cdn-icons-png.flaticon.com/512/2515/2515263.png" class="floating-food w-16 h-16 top-20 left-20" style="animation-delay: 0s;">
      <img src="https://cdn-icons-png.flaticon.com/512/1046/1046857.png" class="floating-food w-14 h-14 top-40 right-40" style="animation-delay: 1s;">
      <img src="https://cdn-icons-png.flaticon.com/512/1147/1147805.png" class="floating-food w-12 h-12 bottom-20 left-1/4" style="animation-delay: 2s;">
      <img src="https://cdn-icons-png.flaticon.com/512/3075/3075929.png" class="floating-food w-16 h-16 bottom-40 right-1/4" style="animation-delay: 3s;">
      
      <div class="w-full max-w-md login-container p-8 fade-in">
        <div class="text-center mb-8">
          <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-primary mb-2 login-title">缪大厨美食</h1>
          <p class="text-gray-600">请登录后点餐</p>
        </div>
        
        <form id="login-form" class="space-y-6">
          <div class="space-y-2">
            <label for="name" class="block text-sm font-medium text-gray-700">姓名</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-user text-gray-400"></i>
              </div>
              <input type="text" id="name" name="name" placeholder="请输入姓名" 
                class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
            </div>
          </div>
          
          <div class="space-y-2">
            <label for="phone" class="block text-sm font-medium text-gray-700">手机号</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-phone text-gray-400"></i>
              </div>
              <input type="tel" id="phone" name="phone" placeholder="请输入手机号" 
                class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
            </div>
          </div>
          
          <button type="submit" 
            class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover flex items-center justify-center">
            <i class="fa fa-sign-in mr-2"></i> 登录
          </button>
        </form>
      </div>
    </div>
    
    <!-- 主应用页面 (默认隐藏) -->
    <div id="main-app" class="hidden flex-1 flex flex-col">
      <!-- 顶部导航栏 -->
      <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
          <div class="flex items-center">
            <h1 class="text-xl font-bold text-primary">缪大厨美食</h1>
          </div>
          <div class="flex items-center space-x-4">
            <button id="cart-btn" class="relative text-gray-600 hover:text-primary transition-colors">
              <i class="fa fa-shopping-cart text-xl"></i>
              <span id="cart-count" class="absolute -top-2 -right-2 bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
            <button id="logout-btn" class="text-gray-600 hover:text-red-500 transition-colors">
              <i class="fa fa-sign-out text-xl"></i>
            </button>
          </div>
        </div>
      </header>
      
      <!-- 内容区域 -->
      <main class="flex-1 overflow-y-auto">
        <!-- 点餐页 -->
        <div id="menu-page" class="p-4">
          <!-- 搜索栏 -->
          <div class="mb-6">
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-search text-gray-400"></i>
              </div>
              <input type="text" id="search-input" placeholder="搜索美食..." 
                class="w-full pl-10 pr-16 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
              <button id="voice-search-btn" class="absolute inset-y-0 right-0 px-4 text-gray-500 hover:text-primary transition-colors">
                <i class="fa fa-microphone"></i>
              </button>
            </div>
          </div>
          
          <!-- 语音搜索模态框 -->
          <div id="voice-search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4 text-center">
              <div id="voice-animation" class="w-24 h-24 mx-auto mb-4 rounded-full flex items-center justify-center">
                <div class="voice-wave"></div>
                <div class="voice-wave delay-1"></div>
                <div class="voice-wave delay-2"></div>
                <i class="fa fa-microphone text-3xl text-primary"></i>
              </div>
              <h3 class="text-lg font-bold mb-2">正在聆听...</h3>
              <p id="voice-result" class="text-gray-600 mb-4">请说出您想要的美食</p>
              <div class="flex space-x-3">
                <button id="voice-cancel-btn" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                  取消
                </button>
                <button id="voice-confirm-btn" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                  确认
                </button>
              </div>
            </div>
          </div>
          
          <!-- 分类标签 -->
          <div class="flex overflow-x-auto pb-4 mb-6 scrollbar-hide space-x-2">
            <button class="category-btn bg-primary text-white px-4 py-2 rounded-full whitespace-nowrap" data-category="all">全部</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="hot">热菜</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="cold">凉菜</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="staple">主食</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="soup">汤品</button>
          </div>
          
          <!-- 菜品列表 -->
          <div id="food-list" class="grid grid-cols-2 gap-4">
            <!-- 菜品将通过JavaScript动态添加 -->
          </div>
        </div>
        
        <!-- 菜品详情页 (默认隐藏) -->
        <div id="food-detail-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">菜品详情</h2>
          </div>
          
          <div class="bg-white rounded-xl overflow-hidden shadow-sm mb-6">
            <div class="h-64 image-container">
              <img id="detail-image" src="https://img0.baidu.com/it/u=2614935587,2823371438&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=1067" alt="宫保鸡丁" class="w-full h-full object-cover">
            </div>
            <div class="p-5">
              <div class="flex justify-between items-start mb-2">
                <h3 id="detail-name" class="text-2xl font-bold">宫保鸡丁</h3>
                <span id="detail-price" class="text-primary font-bold text-xl">¥38</span>
              </div>
              <p id="detail-desc" class="text-gray-600 mb-6">
                宫保鸡丁是一道经典的川菜，以鲜嫩的鸡肉块为主料，搭配香脆的花生、干辣椒和蔬菜炒制而成。
                口感鲜香麻辣，鸡肉滑嫩，花生酥脆，是一道深受欢迎的家常美食。
              </p>
              
              <div class="mb-6">
                <h4 class="font-semibold mb-3">规格选择</h4>
                <div class="grid grid-cols-3 gap-3">
                  <button class="spec-btn bg-primary text-white py-2 px-3 rounded-lg">小份</button>
                  <button class="spec-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">中份</button>
                  <button class="spec-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">大份</button>
                </div>
              </div>
              
              <div class="mb-6">
                <h4 class="font-semibold mb-3">辣度选择</h4>
                <div class="grid grid-cols-4 gap-3">
                  <button class="spicy-btn bg-primary text-white py-2 px-3 rounded-lg">不辣</button>
                  <button class="spicy-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">微辣</button>
                  <button class="spicy-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">中辣</button>
                  <button class="spicy-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">特辣</button>
                </div>
              </div>
              
              <div class="flex justify-between items-center">
                <div class="flex items-center border rounded-lg overflow-hidden">
                  <button class="quantity-btn bg-gray-100 hover:bg-gray-200 p-2 transition-colors">
                    <i class="fa fa-minus"></i>
                  </button>
                  <span id="quantity" class="w-10 text-center font-medium">1</span>
                  <button class="quantity-btn bg-gray-100 hover:bg-gray-200 p-2 transition-colors">
                    <i class="fa fa-plus"></i>
                  </button>
                </div>
                <button id="add-to-cart-detail" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                  加入购物车
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 购物车页 (默认隐藏) -->
        <div id="cart-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-cart" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">我的购物车</h2>
          </div>
          
          <div id="empty-cart" class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
            <i class="fa fa-shopping-cart text-5xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-500 mb-2">购物车是空的</h3>
            <p class="text-gray-400 mb-6">快去挑选喜爱的美食吧！</p>
            <button id="go-to-menu-from-empty-cart" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
              去点餐
            </button>
          </div>
          
          <div id="cart-items" class="hidden space-y-4 mb-6">
            <!-- 购物车商品将通过JavaScript动态添加 -->
          </div>
          
          <div id="cart-summary" class="hidden bg-white rounded-xl p-5 shadow-sm">
            <div class="space-y-3 mb-5">
              <div class="flex justify-between">
                <span class="text-gray-600">小计</span>
                <span id="subtotal">¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">配送费</span>
                <span>¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">优惠</span>
                <span class="text-green-500">-¥0</span>
              </div>
              <div class="flex justify-between pt-3 border-t border-gray-100">
                <span class="font-semibold">总计</span>
                <span id="total" class="font-semibold text-primary">¥0</span>
              </div>
            </div>
            
            <div class="flex space-x-3">
              <button id="save-pending-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
                保存待结算
                <i class="fa fa-clock-o ml-2"></i>
              </button>
              <button id="checkout-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
                去结算
                <i class="fa fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>
        
        <!-- 结算页 (默认隐藏) -->
        <div id="checkout-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-cart" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">结算</h2>
          </div>
          
          <div class="bg-white rounded-xl overflow-hidden shadow-sm mb-6">
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-2">收货信息</h3>
              <div class="flex items-center">
                <div class="mr-3">
                  <i class="fa fa-map-marker text-primary"></i>
                </div>
                <div class="flex-1">
                  <div class="flex justify-between">
                    <span class="font-medium">王冬</span>
                    <span>15252775173</span>
                  </div>
                  <p class="text-gray-500 text-sm mt-1">恒益园8栋二单元</p>
                </div>
              </div>
            </div>
            
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-3">订单信息</h3>
              <div id="checkout-items" class="space-y-3 mb-4">
                <!-- 结算商品将通过JavaScript动态添加 -->
              </div>
            </div>
            
            <div class="p-5">
              <h3 class="font-semibold mb-3">支付方式</h3>
              <div class="space-y-3">
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                  <input type="radio" name="payment" id="alipay" class="mr-3" checked>
                  <label for="alipay" class="flex items-center flex-1 cursor-pointer">
                    <i class="fa fa-credit-card text-blue-500 mr-3"></i>
                    <span>支付宝</span>
                  </label>
                </div>
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                  <input type="radio" name="payment" id="wechat" class="mr-3">
                  <label for="wechat" class="flex items-center flex-1 cursor-pointer">
                    <i class="fa fa-wechat text-green-500 mr-3"></i>
                    <span>微信支付</span>
                  </label>
                </div>
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                  <input type="radio" name="payment" id="cash" class="mr-3">
                  <label for="cash" class="flex items-center flex-1 cursor-pointer">
                    <i class="fa fa-money text-gray-500 mr-3"></i>
                    <span>货到付款</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-xl p-5 shadow-sm">
            <div class="space-y-3 mb-5">
              <div class="flex justify-between">
                <span class="text-gray-600">商品小计</span>
                <span id="checkout-subtotal">¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">配送费</span>
                <span>¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">优惠</span>
                <span class="text-green-500">-¥0</span>
              </div>
              <div class="flex justify-between pt-3 border-t border-gray-100">
                <span class="font-semibold">实付款</span>
                <span id="checkout-total" class="font-semibold text-primary">¥0</span>
              </div>
            </div>
            
            <button id="place-order-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
              提交订单
              <i class="fa fa-check ml-2"></i>
            </button>
          </div>
        </div>
        
        <!-- 结算成功页 (默认隐藏) -->
        <div id="success-page" class="hidden flex flex-col items-center justify-center p-4 h-full">
          <div class="bg-white rounded-2xl p-8 card-shadow text-center max-w-md w-full">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="fa fa-check text-3xl text-green-500"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">订单提交成功</h2>
            <p class="text-gray-500 mb-6">
              缪大厨已收到，请及时付款给缪大厨，少一分不做！
            </p>
            <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
              <h3 class="font-medium mb-2">订单详情</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">订单编号</span>
                  <span id="order-number">ORD-20250612-1234</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">下单时间</span>
                  <span id="order-time"></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">实付款</span>
                  <span id="order-amount" class="text-primary">¥0</span>
                </div>
              </div>
            </div>
            <div class="flex space-x-3">
              <button id="new-order-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                继续点餐
              </button>
              <button id="order-detail-btn" class="flex-1 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                查看订单
              </button>
            </div>
          </div>
        </div>
        
        <!-- 订单详情页 (默认隐藏) -->
        <div id="order-detail-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-from-order-detail" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">订单详情</h2>
            <button id="logout-btn-detail" class="ml-auto text-gray-600 hover:text-red-500 transition-colors">
              <i class="fa fa-sign-out"></i> 退出登录
            </button>
          </div>
          
          <div class="bg-white rounded-xl overflow-hidden shadow-sm mb-6">
            <div class="p-5 border-b border-gray-100">
              <div class="flex justify-between items-center">
                <h3 class="font-semibold">订单信息</h3>
                <span class="bg-green-100 text-green-600 text-xs font-medium px-2.5 py-0.5 rounded-full">已支付</span>
              </div>
              <div class="space-y-2 mt-3 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">订单编号</span>
                  <span id="detail-order-number">ORD-20250612-1234</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">下单时间</span>
                  <span id="detail-order-time"></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">支付方式</span>
                  <span id="detail-payment-method">支付宝</span>
                </div>
              </div>
            </div>
            
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-3">收货信息</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">收货人</span>
                  <span id="detail-recipient">王冬</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">联系电话</span>
                  <span id="detail-phone">15252775173</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">收货地址</span>
                  <span id="detail-address">恒益园8栋二单元</span>
                </div>
              </div>
            </div>
            
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-3">商品信息</h3>
              <div id="order-items" class="space-y-3 mb-4">
                <!-- 订单商品将通过JavaScript动态添加 -->
              </div>
            </div>
            
            <div class="p-5">
              <h3 class="font-semibold mb-3">订单金额</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">商品小计</span>
                  <span id="detail-subtotal">¥0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">配送费</span>
                  <span>¥0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">优惠</span>
                  <span class="text-green-500">-¥0</span>
                </div>
                <div class="flex justify-between pt-3 border-t border-gray-100 text-base">
                  <span class="font-semibold">实付款</span>
                  <span id="detail-total" class="font-semibold text-primary">¥0</span>
                </div>
              </div>
            </div>
          </div>
          
          <button id="back-to-home-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
            返回首页
            <i class="fa fa-home ml-2"></i>
          </button>
        </div>

        <!-- 优惠券页面 (默认隐藏) -->
        <div id="coupon-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-coupon" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">我的优惠券</h2>
          </div>
          
          <div id="my-coupons" class="space-y-4">
            <!-- 优惠券将通过JavaScript动态添加 -->
          </div>
          
          <button onclick="showCouponModal()" class="fixed bottom-20 right-4 bg-primary text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center">
            <i class="fa fa-plus text-xl"></i>
          </button>
        </div>
        
        <!-- 待结算页面 (默认隐藏) -->
        <div id="pending-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-pending" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">待结算订单</h2>
          </div>
          
          <div id="pending-orders-container" class="space-y-4">
            <div id="empty-pending" class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
              <i class="fa fa-clock-o text-5xl text-gray-300 mb-4"></i>
              <h3 class="text-xl font-medium text-gray-500 mb-2">暂无待结算订单</h3>
              <p class="text-gray-400 mb-6">您的购物车中的商品会显示在这里</p>
              <button id="go-to-menu-from-empty-pending" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                去点餐
              </button>
            </div>
            
            <div id="pending-orders-list" class="hidden">
              <!-- 待结算订单将通过JavaScript动态添加 -->
            </div>
          </div>
        </div>
        
        <!-- 我的订单页面 (默认隐藏) -->
        <div id="orders-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-orders" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">我的订单</h2>
          </div>
          
          <div id="orders-container" class="space-y-4">
            <div id="empty-orders" class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
              <i class="fa fa-list-alt text-5xl text-gray-300 mb-4"></i>
              <h3 class="text-xl font-medium text-gray-500 mb-2">暂无订单记录</h3>
              <p class="text-gray-400 mb-6">您的订单记录将显示在这里</p>
              <button id="go-to-menu-from-empty-orders" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                去点餐
              </button>
            </div>
            
            <div id="orders-list" class="hidden">
              <!-- 订单将通过JavaScript动态添加 -->
            </div>
          </div>
        </div>
      </main>
      
      <!-- 底部导航栏 -->
      <footer class="bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] py-2">
        <div class="container mx-auto px-4">
          <div class="flex justify-around">
            <a href="#" class="nav-link flex flex-col items-center text-primary" id="home-nav">
              <i class="fa fa-cutlery text-xl"></i>
              <span class="text-xs mt-1">菜单</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="cart-nav">
              <i class="fa fa-shopping-cart text-xl"></i>
              <span class="text-xs mt-1">购物车</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="pending-nav">
              <i class="fa fa-clock-o text-xl"></i>
              <span class="text-xs mt-1">待结算</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="orders-nav">
              <i class="fa fa-list-alt text-xl"></i>
              <span class="text-xs mt-1">订单</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="coupon-nav">
              <i class="fa fa-ticket text-xl"></i>
              <span class="text-xs mt-1">优惠券</span>
            </a>
          </div>
        </div>
      </footer>
    </div>
    
    <!-- 退出登录确认模态框 -->
    <div id="logout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-6 max-w-md w-full card-shadow fade-in">
        <div class="text-center">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa fa-exclamation-triangle text-2xl text-red-500"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">退出登录</h3>
          <p class="text-gray-500 mb-6">确定要退出当前账号吗？</p>
          <div class="flex space-x-3">
            <button id="cancel-logout" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
              取消
            </button>
            <button id="confirm-logout" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 登录成功特效容器 -->
    <div id="login-effect" class="fixed inset-0 z-50 pointer-events-none hidden">
      <div class="love-text" id="love-message">为王冬公主服务</div>
    </div>
    
    <!-- 模态框 - 登录成功提示 -->
    <div id="login-success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-6 max-w-md w-full card-shadow fade-in">
        <div class="text-center">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa fa-check text-2xl text-primary"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">登录成功</h3>
          <p class="text-gray-500 mb-6">欢迎来到缪大厨的美食世界</p>
          <button id="close-login-modal" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
            确定
          </button>
        </div>
      </div>
    </div>
    
    <!-- 提示消息 -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-dark text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
      <p id="toast-message"></p>
    </div>
  </div>
  
  <!-- 优惠券模态框 -->
  <div id="couponModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4">
      <h3 class="text-xl font-bold mb-4">获取优惠券</h3>
      <div class="space-y-4">
        <div class="coupon-card" data-discount="0.5" data-duration="30">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">5折优惠券</div>
              <div class="coupon-condition">按摩30分钟即可获得</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getCoupon(0.5, 30)">
              获取
            </button>
          </div>
        </div>
        <div class="coupon-card" data-discount="0.7" data-duration="20">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">7折优惠券</div>
              <div class="coupon-condition">按摩20分钟即可获得</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getCoupon(0.7, 20)">
              获取
            </button>
          </div>
        </div>
        <div class="coupon-card" data-discount="0.8" data-duration="10">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">8折优惠券</div>
              <div class="coupon-condition">按摩10分钟即可获得</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getCoupon(0.8, 10)">
              获取
            </button>
          </div>
        </div>
        <div class="coupon-card" data-discount="0.9">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">9折优惠券</div>
              <div class="coupon-condition">叫一声爸爸即可获得</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getDaddyCoupon()">
              获取
            </button>
          </div>
        </div>
      </div>
      <button class="mt-4 w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300" onclick="closeCouponModal()">
        关闭
      </button>
    </div>
  </div>

  <!-- 叫爸爸模态框 -->
  <div id="daddyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4 text-center">
      <h3 class="text-xl font-bold mb-4">获取9折优惠券</h3>
      <p class="text-gray-600 mb-4" id="daddyModalText">请对着麦克风叫一声"爸爸"</p>
      <div id="voice-animation-daddy" class="w-24 h-24 mx-auto mb-4 rounded-full flex items-center justify-center hidden">
        <div class="voice-wave"></div>
        <div class="voice-wave delay-1"></div>
        <div class="voice-wave delay-2"></div>
        <i class="fa fa-microphone text-3xl text-primary"></i>
      </div>
      <p id="daddy-voice-result" class="text-gray-600 mb-4 hidden"></p>
      <div class="flex flex-col space-y-3">
        <button id="startRecordingBtn" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90">
          开始录音
        </button>
        <div id="recording-controls" class="hidden flex space-x-3">
          <button id="stopRecordingBtn" class="flex-1 bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">
            停止录音
          </button>
          <button id="cancelRecordingBtn" class="flex-1 bg-red-500 text-white px-6 py-2 rounded-full hover:bg-red-600">
            取消录音
          </button>
        </div>
      </div>
      <button onclick="closeDaddyModal()" class="mt-4 w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300">
        关闭
      </button>
    </div>
  </div>

  <!-- 敲头表情动画 -->
  <div id="knockHeadAnimation" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex flex-col items-center justify-center">
    <div class="text-9xl animate-bounce mb-4">🤦</div>
    <p class="text-white text-2xl font-bold mb-8 animate-pulse">你小子，还不承认我是你爸爸</p>
    <button onclick="closeKnockHeadAnimation()" class="bg-white text-primary px-6 py-2 rounded-full hover:bg-opacity-90">
      知道了
    </button>
  </div>
  
  <!-- 按摩计时器模态框 -->
  <div id="massageTimerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4 text-center relative">
      <button onclick="stopMassage()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
        <i class="fa fa-times text-xl"></i>
      </button>
      <h3 class="text-xl font-bold mb-4">按摩计时</h3>
      <div class="text-4xl font-bold text-primary mb-4" id="massageTimer">00:00</div>
      <div class="text-gray-600 mb-4">请为缪大厨按摩 <span id="massageDuration">0</span> 分钟</div>
      <button id="startMassageBtn" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90">
        开始按摩
      </button>
      <button id="stopMassageBtn" class="hidden mt-2 bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">
        停止按摩
      </button>
    </div>
  </div>

  <!-- 优惠券列表 -->
  <div id="couponList" class="fixed bottom-20 right-16 z-40 bg-white rounded-lg shadow-lg p-4 w-64 hidden">
    <h4 class="font-bold mb-2">我的优惠券</h4>
      <!-- 优惠券将通过JavaScript动态添加 -->
    </div>
  </div>

  <!-- 结算页面 -->
  <div id="checkoutPage" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="bg-white h-full w-full md:w-96 md:ml-auto p-6 overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">订单结算</h2>
        <button onclick="closeCheckout()" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <!-- 订单商品列表 -->
      <div class="space-y-4 mb-6">
        <div id="checkoutItems" class="space-y-4">
          <!-- 订单商品将通过JavaScript动态添加 -->
        </div>
      </div>

      <!-- 优惠券选择区域 -->
      <div class="mb-6">
        <h3 class="font-bold mb-2">选择优惠券</h3>
        <div id="checkoutCoupons" class="space-y-2">
          <div class="text-gray-500 text-sm">暂无可用优惠券</div>
        </div>
        <button onclick="showCouponModal()" class="mt-2 text-primary hover:text-opacity-80 text-sm">
          <i class="fa fa-plus"></i> 获取更多优惠券
        </button>
      </div>
      
      <!-- 订单总计 -->
      <div class="border-t pt-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-gray-600">商品总额</span>
          <span id="subtotalPrice">¥0.00</span>
        </div>
        <div class="flex justify-between items-center mb-2" id="discountRow" style="display: none;">
          <span class="text-gray-600">优惠金额</span>
          <span id="discountAmount" class="text-primary">-¥0.00</span>
        </div>
        <div class="flex justify-between items-center text-lg font-bold">
          <span>总计</span>
          <span id="totalPrice" class="text-primary">¥0.00</span>
        </div>
      </div>

      <button onclick="submitOrder()" class="w-full bg-primary text-white py-3 rounded-full mt-6 hover:bg-opacity-90">
        提交订单
      </button>
    </div>
  </div>

  <script>
    // 全局数据
    let isLoggedIn = false; // 登录状态
    let cart = [];
    let currentCategory = 'all';
    let searchTerm = '';
    let currentOrder = null;
    let loggedInUser = null; // 存储登录用户信息
    
    // 爸爸语音识别变量
    let daddyRecognition;
    let daddyRecognitionResult = '';
    
    // 初始化爸爸语音识别
    function initDaddyVoiceRecognition() {
      // 检查浏览器是否支持语音识别
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        daddyRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        daddyRecognition.continuous = false;
        daddyRecognition.interimResults = true;
        daddyRecognition.lang = 'zh-CN'; // 设置为中文
        
        // 处理识别结果
        daddyRecognition.onresult = function(event) {
          let interimTranscript = '';
          let finalTranscript = '';
          
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          // 显示识别结果
          daddyRecognitionResult = finalTranscript || interimTranscript;
          document.getElementById('daddy-voice-result').textContent = daddyRecognitionResult || '正在聆听...';
          document.getElementById('daddy-voice-result').classList.remove('hidden');
        };
        
        // 处理识别结束
        daddyRecognition.onend = function() {
          document.getElementById('voice-animation-daddy').classList.remove('recording');
          
          if (!daddyRecognitionResult) {
            // 隐藏爸爸模态框
            document.getElementById('daddyModal').classList.add('hidden');
            
            // 显示敲头表情动画
            document.getElementById('knockHeadAnimation').classList.remove('hidden');
            
            // 重置录音按钮状态，确保下次可以正常使用
            document.getElementById('recording-controls').classList.add('hidden');
            document.getElementById('startRecordingBtn').classList.remove('hidden');
            return;
          }
          
          // 检查是否说了"爸爸"
          const isDaddy = daddyRecognitionResult.includes('爸爸');
          processDaddyCoupon(isDaddy);
        };
        
        // 处理错误
        daddyRecognition.onerror = function(event) {
          console.error('语音识别错误:', event.error);
          document.getElementById('voice-animation-daddy').classList.remove('recording');
          
                  // 处理不同类型的错误
        if (event.error === 'no-speech') {
          // 显示提示信息
          document.getElementById('daddy-voice-result').textContent = '没有听到您说话，请重试';
          document.getElementById('daddy-voice-result').classList.remove('hidden');
          document.getElementById('recording-controls').classList.add('hidden');
          document.getElementById('startRecordingBtn').classList.remove('hidden');
          
          // 3秒后重新显示开始录音按钮
          setTimeout(() => {
            if (document.getElementById('daddyModal').classList.contains('hidden')) return;
            document.getElementById('daddyModalText').textContent = '请对着麦克风叫一声"爸爸"';
            document.getElementById('daddy-voice-result').classList.add('hidden');
          }, 3000);
        } else {
          // 其他错误显示敲头表情
          document.getElementById('daddyModal').classList.add('hidden');
          document.getElementById('knockHeadAnimation').classList.remove('hidden');
          document.getElementById('recording-controls').classList.add('hidden');
          document.getElementById('startRecordingBtn').classList.remove('hidden');
        }
        };
      }
    }
    
    // 开始爸爸语音识别
    function startDaddyVoiceRecognition() {
      if (!daddyRecognition) {
        initDaddyVoiceRecognition();
      }
      
      if (daddyRecognition) {
        document.getElementById('daddy-voice-result').textContent = '正在聆听...';
        document.getElementById('daddy-voice-result').classList.remove('hidden');
        daddyRecognitionResult = '';
        
        try {
          daddyRecognition.start();
        } catch (e) {
          console.error('语音识别启动失败:', e);
          document.getElementById('daddy-voice-result').textContent = '语音识别启动失败，请重试';
          document.getElementById('stopRecordingBtn').classList.add('hidden');
          document.getElementById('startRecordingBtn').classList.remove('hidden');
        }
      }
    }
    
    // 停止爸爸语音识别
    function stopDaddyVoiceRecognition() {
      if (daddyRecognition) {
        try {
          daddyRecognition.stop();
        } catch (e) {
          console.error('语音识别停止失败:', e);
        }
      }
    }
    
    // 菜品数据（已替换为真实可访问的图片）
    const foodData = [
      // 热菜
      {
        id: 1,
        name: '宫保鸡丁',
        price: 38,
        description: '经典川菜，鲜嫩鸡肉搭配香脆花生、干辣椒和蔬菜，口感鲜香麻辣。',
        image: 'https://img0.baidu.com/it/u=2614935587,2823371438&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=1067',
        category: 'hot',
        tags: ['川菜', '辣', '热销']
      },
      {
        id: 2,
        name: '鱼香肉丝',
        price: 32,
        description: '传统川菜，猪肉丝配以木耳、胡萝卜等蔬菜，酸甜微辣，香气扑鼻。',
        image: 'https://img1.baidu.com/it/u=4072396536,3897783405&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=667',
        category: 'hot',
        tags: ['川菜', '酸甜']
      },
      {
        id: 3,
        name: '麻婆豆腐',
        price: 28,
        description: '麻辣鲜香的经典川菜，嫩豆腐与肉末完美结合，下饭佳品。',
        image: 'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage109.360doc.com%2FDownloadImg%2F2024%2F12%2F1320%2F291950008_3_20241213080511131&refer=http%3A%2F%2Fimage109.360doc.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1752317985&t=3760de53b644b62a6ecc31dbe9d90577',
        category: 'hot',
        tags: ['川菜', '辣', '热销']
      },
      {
        id: 4,
        name: '糖醋排骨',
        price: 42,
        description: '酸甜可口的家常菜，猪小排配以特制糖醋汁，肉质鲜嫩。',
        image: 'https://qcloud.dpfile.com/pc/_p2ScpP85UpOivz3B37fvtIAbvOez8g8WJbCX0YpqZ9OvnLpWKfeEkt4lRrW2v6K.jpg',
        category: 'hot',
        tags: ['酸甜', '家常']
      },
      {
        id: 5,
        name: '红烧肉',
        price: 48,
        description: '肥而不腻的经典家常菜，五花肉配以冰糖、酱油烧制，香甜可口。',
        image: 'https://img2.baidu.com/it/u=954568553,3432212147&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=745',
        category: 'hot',
        tags: ['家常', '甜']
      },
      {
        id: 6,
        name: '可乐鸡翅',
        price: 48,
        description: '肥而不腻的经典家常菜，鸡翅配以冰糖、醋，酱油烧制，香甜可口。',
        image: 'https://pic.rmb.bdstatic.com/bjh/240307/0a62de68e24e433f67d2ab558df9ab1b6572.jpeg',
        category: 'hot',
        tags: ['家常', '甜']
      },
      {
        id: 7,
        name: '辣烧鸡爪',
        price: 48,
        description: '香辣解馋，鸡爪软烂入味',
        image: 'https://img2.baidu.com/it/u=11922117,731404843&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=902',
        category: 'hot',
        tags: ['家常', '辣']
      },
      {
        id: 8,
        name: '黄焖鸡',
        price: 48,
        description: '黄焖鸡是一道让人回味无穷的美食，它的浓郁香气和独特的口感让人难以忘怀。鸡肉鲜嫩细腻，每一口都充满了醇厚的口感，让人不禁一口接一口。',
        image: 'https://img0.baidu.com/it/u=1626638360,2246865851&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=1212',
        category: 'hot',
        tags: ['家常', '微辣']
      },
      
      // 凉菜
      {
        id: 9,
        name: '凉拌黄瓜',
        price: 12,
        description: '清爽可口的家常菜，黄瓜配以蒜末、醋等调料凉拌，解暑佳品。',
        image: 'https://img0.baidu.com/it/u=2460532109,2661651747&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=667',
        category: 'cold',
        tags: ['清爽', '家常']
      },
      {
        id: 10,
        name: '夫妻肺片',
        price: 36,
        description: '经典川菜凉菜，牛头皮、牛心等配以辣椒油、花椒油，麻辣鲜香。',
        image: 'https://img0.baidu.com/it/u=521970733,339027069&fm=253&fmt=auto&app=120&f=JPEG?w=800&h=900',
        category: 'cold',
        tags: ['川菜', '辣']
      },
      {
        id: 11,
        name: '凉拌木耳',
        price: 16,
        description: '健康清爽的家常菜，木耳配以蒜末、醋等调料凉拌，营养丰富。',
        image: 'https://img1.baidu.com/it/u=1821773267,4216692821&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500',
        category: 'cold',
        tags: ['健康', '家常']
      },
      
      // 主食
      {
        id: 12,
        name: '青椒肉丝面',
        price: 18,
        description: '手工制作的面条，口感筋道，汤汁鲜美。',
        image: 'https://img1.baidu.com/it/u=4264226242,1050909318&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=647',
        category: 'staple',
        tags: ['家常', '主食']
      },
      
      // 汤品
      {
        id: 13,
        name: '西红柿鸡蛋汤',
        price: 16,
        description: '简单家常的汤品，西红柿与鸡蛋完美结合，酸甜可口，营养丰富。',
        image: 'https://pic.rmb.bdstatic.com/bjh/240322/events/fc18e216fe55202bd9fec8554ff5869f4335.jpeg@h_1280',
        category: 'soup',
        tags: ['家常', '清淡']
      },
      {
        id: 14,
        name: '酸辣汤',
        price: 22,
        description: '经典川菜汤品，豆腐、木耳等配以辣椒油、花椒油，麻辣鲜香。',
        image: 'https://miaobi-lite.bj.bcebos.com/miaobi/5mao/b%27LV8xNzM2NDg4MTc1LjIyNTkxODg%3D%27/0.png?authorization=bce-auth-v1%2FALTAKmda7zOvhZVbRzBLewvCMU%2F2025-01-10T05%3A49%3A36Z%2F-1%2F%2Fa7e1485c337dc1f7e6ebbad9bc7e98955df4794e671578d8def7ecc60955dade',
        category: 'soup',
        tags: ['川菜', '辣']
      }
    ];
    
    // DOM元素
    const loginPage = document.getElementById('login-page');
    const mainApp = document.getElementById('main-app');
    const loginForm = document.getElementById('login-form');
    const loginSuccessModal = document.getElementById('login-success-modal');
    const closeLoginModalBtn = document.getElementById('close-login-modal');
    const foodList = document.getElementById('food-list');
    const foodDetailPage = document.getElementById('food-detail-page');
    const backToMenuBtn = document.getElementById('back-to-menu');
    const detailName = document.getElementById('detail-name');
    const detailPrice = document.getElementById('detail-price');
    const detailDesc = document.getElementById('detail-desc');
    const detailImage = document.getElementById('detail-image');
    const addToCartDetailBtn = document.getElementById('add-to-cart-detail');
    const quantityEl = document.getElementById('quantity');
    const cartBtn = document.getElementById('cart-btn');
    const cartNav = document.getElementById('cart-nav');
    const cartPage = document.getElementById('cart-page');
    const backToMenuFromCartBtn = document.getElementById('back-to-menu-from-cart');
    const cartItems = document.getElementById('cart-items');
    const emptyCart = document.getElementById('empty-cart');
    const cartSummary = document.getElementById('cart-summary');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkoutPage = document.getElementById('checkout-page');
    const backToCartBtn = document.getElementById('back-to-cart');
    const checkoutItems = document.getElementById('checkout-items');
    const checkoutSubtotalEl = document.getElementById('checkout-subtotal');
    const checkoutTotalEl = document.getElementById('checkout-total');
    const placeOrderBtn = document.getElementById('place-order-btn');
    const successPage = document.getElementById('success-page');
    const newOrderBtn = document.getElementById('new-order-btn');
    const orderDetailBtn = document.getElementById('order-detail-btn');
    const orderNumberSpan = document.getElementById('order-number');
    const orderTimeSpan = document.getElementById('order-time');
    const orderAmountSpan = document.getElementById('order-amount');
    const goToMenuFromEmptyCartBtn = document.getElementById('go-to-menu-from-empty-cart');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const searchInput = document.getElementById('search-input');
    const categoryBtns = document.querySelectorAll('.category-btn');
    const loginEffect = document.getElementById('login-effect');
    const loveMessage = document.getElementById('love-message');
    const orderDetailPage = document.getElementById('order-detail-page');
    const backFromOrderDetailBtn = document.getElementById('back-from-order-detail');
    const orderItemsEl = document.getElementById('order-items');
    const detailOrderNumber = document.getElementById('detail-order-number');
    const detailOrderTime = document.getElementById('detail-order-time');
    const detailPaymentMethod = document.getElementById('detail-payment-method');
    const detailRecipient = document.getElementById('detail-recipient');
    const detailPhone = document.getElementById('detail-phone');
    const detailAddress = document.getElementById('detail-address');
    const detailSubtotal = document.getElementById('detail-subtotal');
    const detailTotal = document.getElementById('detail-total');
    const backToHomeBtn = document.getElementById('back-to-home-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const logoutBtnDetail = document.getElementById('logout-btn-detail');
    const logoutModal = document.getElementById('logout-modal');
    const cancelLogoutBtn = document.getElementById('cancel-logout');
    const confirmLogoutBtn = document.getElementById('confirm-logout');
    
    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 设置当前时间
      const now = new Date();
      orderTimeSpan.textContent = now.toISOString().slice(0, 16).replace('T', ' ');
      detailOrderTime.textContent = now.toISOString().slice(0, 16).replace('T', ' ');
      
      // 绑定登录表单提交事件
      loginForm.addEventListener('submit', handleLogin);
      
      // 绑定关闭登录成功模态框事件
      closeLoginModalBtn.addEventListener('click', () => {
        loginSuccessModal.classList.add('hidden');
        mainApp.classList.remove('hidden');
        renderFoodList();
      });
      
      // 绑定返回菜单按钮事件
      backToMenuBtn.addEventListener('click', () => {
        foodDetailPage.classList.add('hidden');
        document.getElementById('menu-page').classList.remove('hidden');
      });
      
      // 绑定购物车按钮事件
      cartBtn.addEventListener('click', () => {
        switchToPage('cart');
      });
      
      // 绑定底部导航购物车按钮事件
      cartNav.addEventListener('click', () => {
        switchToPage('cart');
      });
      
      // 绑定从购物车返回菜单按钮事件
      backToMenuFromCartBtn.addEventListener('click', () => {
        switchToPage('menu');
      });
      
      // 绑定从空购物车返回菜单按钮事件
      goToMenuFromEmptyCartBtn.addEventListener('click', () => {
        switchToPage('menu');
      });
      
      // 绑定结算按钮事件
      checkoutBtn.addEventListener('click', () => {
        switchToPage('checkout');
      });
      
      // 绑定返回购物车按钮事件
      backToCartBtn.addEventListener('click', () => {
        switchToPage('cart');
      });
      
      // 绑定提交订单按钮事件
      placeOrderBtn.addEventListener('click', handlePlaceOrder);
      
      // 绑定继续点餐按钮事件
      newOrderBtn.addEventListener('click', () => {
        switchToPage('menu');
        cart = [];
        updateCartUI();
      });
      
      // 绑定查看订单按钮事件
      orderDetailBtn.addEventListener('click', showOrderDetail);
      
      // 绑定从订单详情返回按钮事件
      backFromOrderDetailBtn.addEventListener('click', () => {
        orderDetailPage.classList.add('hidden');
        // 如果是从订单列表查看的详情，则返回到订单列表
        if (document.getElementById('orders-page').classList.contains('hidden') === false) {
          document.getElementById('orders-page').classList.remove('hidden');
        } else {
          // 否则返回到成功页面（从结算成功页查看的详情）
          successPage.classList.remove('hidden');
        }
      });
      
      // 绑定返回首页按钮事件
      backToHomeBtn.addEventListener('click', () => {
        orderDetailPage.classList.add('hidden');
        document.getElementById('menu-page').classList.remove('hidden');
        cart = [];
        updateCartUI();
      });
      
      // 绑定搜索输入事件
      searchInput.addEventListener('input', () => {
        searchTerm = searchInput.value.trim().toLowerCase();
        renderFoodList();
      });
      
      // 绑定分类按钮事件
      categoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          currentCategory = btn.dataset.category;
          updateCategoryButton(btn);
          renderFoodList();
        });
      });
      
      // 绑定数量增减按钮事件
      document.addEventListener('click', (e) => {
        if (e.target.closest('.quantity-btn')) {
          const btn = e.target.closest('.quantity-btn');
          const quantityEl = btn.parentElement.querySelector('.quantity');
          const currentValue = parseInt(quantityEl.textContent);
          
          if (btn.querySelector('.fa-minus')) {
            if (currentValue > 1) {
              quantityEl.textContent = currentValue - 1;
            }
          } else {
            quantityEl.textContent = currentValue + 1;
          }
        }
      });
      
      // 绑定添加到购物车按钮事件
      document.addEventListener('click', (e) => {
        if (e.target.closest('.add-to-cart-btn')) {
          const btn = e.target.closest('.add-to-cart-btn');
          const foodId = parseInt(btn.dataset.id);
          addToCart(foodId);
        }
      });
      
      // 绑定购物车删除按钮事件
      document.addEventListener('click', (e) => {
        if (e.target.closest('.remove-from-cart-btn')) {
          const btn = e.target.closest('.remove-from-cart-btn');
          const foodId = parseInt(btn.dataset.id);
          removeFromCart(foodId);
        }
      });
      
      // 绑定购物车数量增减按钮事件
      document.addEventListener('click', (e) => {
        if (e.target.closest('.cart-quantity-btn')) {
          const btn = e.target.closest('.cart-quantity-btn');
          const foodId = parseInt(btn.dataset.id);
          const isIncrease = btn.querySelector('.fa-plus');
          
          if (isIncrease) {
            increaseQuantity(foodId);
          } else {
            decreaseQuantity(foodId);
          }
        }
      });
      
      // 绑定辣度选择按钮事件
      document.addEventListener('click', (e) => {
        if (e.target.closest('.spicy-btn')) {
          const btn = e.target.closest('.spicy-btn');
          const parent = btn.parentElement;
          
          parent.querySelectorAll('.spicy-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          });
          
          btn.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          btn.classList.add('bg-primary', 'text-white');
        }
      });
      
      // 绑定规格选择按钮事件
      document.addEventListener('click', (e) => {
        if (e.target.closest('.spec-btn')) {
          const btn = e.target.closest('.spec-btn');
          const parent = btn.parentElement;
          
          parent.querySelectorAll('.spec-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          });
          
          btn.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          btn.classList.add('bg-primary', 'text-white');
        }
      });
      
      // 绑定添加到购物车(详情页)按钮事件
      addToCartDetailBtn.addEventListener('click', () => {
        const foodId = parseInt(addToCartDetailBtn.dataset.id);
        const quantity = parseInt(quantityEl.textContent);
        
        // 获取规格和辣度选择
        const selectedSpec = document.querySelector('.spec-btn.bg-primary')?.textContent || '小份';
        const selectedSpicy = document.querySelector('.spicy-btn.bg-primary')?.textContent || '不辣';
        
        // 添加到购物车
        const food = foodData.find(f => f.id === foodId);
        if (food) {
          const cartItem = cart.find(item => item.id === foodId);
          if (cartItem) {
            cartItem.quantity += quantity;
          } else {
            cart.push({
              ...food,
              quantity,
              spec: selectedSpec,
              spicy: selectedSpicy
            });
          }
          
          updateCartUI();
          showToast('已添加到购物车');
        }
      });
      
      // 绑定退出登录按钮事件
      logoutBtn.addEventListener('click', () => {
        showLogoutModal();
      });
      
      // 绑定订单详情页退出登录按钮事件
      logoutBtnDetail.addEventListener('click', () => {
        showLogoutModal();
      });
      
      // 绑定取消退出登录按钮事件
      cancelLogoutBtn.addEventListener('click', () => {
        logoutModal.classList.add('hidden');
      });
      
      // 绑定确认退出登录按钮事件
      confirmLogoutBtn.addEventListener('click', handleLogout);
      
      // 保存到待结算按钮点击事件
      document.getElementById('save-pending-btn').addEventListener('click', saveAsPendingOrder);
      
      document.getElementById('pending-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('pending');
      });
      
      document.getElementById('orders-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('orders');
      });
    });
    
    // 切换页面
    function switchToPage(page) {
      // 隐藏所有页面
      document.getElementById('menu-page').classList.add('hidden');
      cartPage.classList.add('hidden');
      foodDetailPage.classList.add('hidden');
      checkoutPage.classList.add('hidden');
      successPage.classList.add('hidden');
      orderDetailPage.classList.add('hidden');
      document.getElementById('coupon-page').classList.add('hidden');
      document.getElementById('pending-page').classList.add('hidden');
      document.getElementById('orders-page').classList.add('hidden');
      
      // 显示目标页面
      if (page === 'menu') {
        document.getElementById('menu-page').classList.remove('hidden');
        // 更新导航栏高亮
        document.getElementById('home-nav').classList.add('text-primary');
        document.getElementById('home-nav').classList.remove('text-gray-500');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      } else if (page === 'cart') {
        cartPage.classList.remove('hidden');
        updateCartUI();
        // 更新导航栏高亮
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-primary');
        document.getElementById('cart-nav').classList.remove('text-gray-500');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      } else if (page === 'checkout') {
        checkoutPage.classList.remove('hidden');
        updateCheckoutUI();
        // 保持购物车导航栏高亮
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-primary');
        document.getElementById('cart-nav').classList.remove('text-gray-500');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      } else if (page === 'coupon') {
        document.getElementById('coupon-page').classList.remove('hidden');
        // 更新导航栏高亮
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-primary');
        document.getElementById('coupon-nav').classList.remove('text-gray-500');
        // 更新优惠券列表
        updateMyCoupons();
      } else if (page === 'pending') {
        document.getElementById('pending-page').classList.remove('hidden');
        // 更新导航栏高亮
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-primary');
        document.getElementById('pending-nav').classList.remove('text-gray-500');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
        // 更新待结算订单
        updatePendingOrders();
      } else if (page === 'orders') {
        document.getElementById('orders-page').classList.remove('hidden');
        // 更新导航栏高亮
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-primary');
        document.getElementById('orders-nav').classList.remove('text-gray-500');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
        // 更新订单列表
        updateOrdersList();
      } else if (page === 'orderDetail') {
        orderDetailPage.classList.remove('hidden');
        showOrderDetail();
        // 保持订单导航栏高亮
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-primary');
        document.getElementById('orders-nav').classList.remove('text-gray-500');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      }
    }
    
    // 处理登录
    function handleLogin(e) {
      // 阻止表单默认提交行为
      e.preventDefault();
      
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      
      // 验证姓名和手机号，为王冬公主特殊处理
      if (name === '王冬' && phone === '15252775173') {
        // 保存登录用户信息
        loggedInUser = { name, phone };
        isLoggedIn = true;
        
        // 登录成功，显示爱心特效
        loginPage.classList.add('hidden');
        showLoveEffect();
      } else if (name && phone) {
        showToast('姓名或手机号错误');
      } else {
        showToast('姓名或手机号不能为空');
      }
    }
    
    // 显示爱心特效
    function showLoveEffect() {
      loginEffect.classList.remove('hidden');
      loveMessage.textContent = loggedInUser && loggedInUser.name === '王冬' 
        ? '为王冬公主服务' 
        : '登录成功';
      
      // 生成多个爱心
      for (let i = 0; i < 50; i++) {
        createLoveHeart();
      }
      
      // 3秒后隐藏特效并显示主应用
      setTimeout(() => {
        loginEffect.classList.add('hidden');
        loginSuccessModal.classList.remove('hidden');
      }, 3000);
    }
    
    // 创建单个爱心
    function createLoveHeart() {
      const heart = document.createElement('div');
      heart.className = 'love-heart';
      
      // 随机位置和大小
      const size = Math.random() * 15 + 10; // 10-25px
      const left = Math.random() * 100; // 0-100%
      const duration = Math.random() * 3 + 2; // 2-5秒
      
      heart.style.width = `${size}px`;
      heart.style.height = `${size}px`;
      heart.style.left = `${left}%`;
      heart.style.animationDuration = `${duration}s`;
      
      loginEffect.appendChild(heart);
      
      // 动画结束后移除元素
      setTimeout(() => {
        heart.remove();
      }, duration * 1000);
    }
    
    // 显示退出登录模态框
    function showLogoutModal() {
      logoutModal.classList.remove('hidden');
    }
    
    // 处理退出登录
    function handleLogout() {
      // 隐藏模态框
      logoutModal.classList.add('hidden');
      
      // 重置登录状态
      isLoggedIn = false;
      loggedInUser = null;
      
      // 清空购物车
      cart = [];
      currentOrder = null;
      
      // 显示登录页
      mainApp.classList.add('hidden');
      loginPage.classList.remove('hidden');
      
      // 清空购物车和订单UI
      updateCartUI();
      
      showToast('已退出登录');
    }
    
    // 更新分类按钮样式
    function updateCategoryButton(activeBtn) {
      categoryBtns.forEach(btn => {
        btn.classList.remove('bg-primary', 'text-white');
        btn.classList.add('bg-white', 'text-gray-700', 'shadow-sm');
      });
      activeBtn.classList.remove('bg-white', 'text-gray-700', 'shadow-sm');
      activeBtn.classList.add('bg-primary', 'text-white');
    }
    
    // 渲染菜品列表
    function renderFoodList() {
      // 根据当前分类和搜索词过滤菜品
      let filteredFoods = foodData;
      
      if (currentCategory !== 'all') {
        filteredFoods = filteredFoods.filter(food => food.category === currentCategory);
      }
      
      if (searchTerm) {
        filteredFoods = filteredFoods.filter(food => 
          food.name.toLowerCase().includes(searchTerm) || 
          food.description.toLowerCase().includes(searchTerm) ||
          (food.tags && food.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
        );
      }
      
      // 清空菜品列表
      foodList.innerHTML = '';
      
      // 如果没有符合条件的菜品
      if (filteredFoods.length === 0) {
        foodList.innerHTML = `
          <div class="col-span-2 text-center py-12">
            <i class="fa fa-search text-4xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">没有找到符合条件的菜品</p>
          </div>
        `;
        return;
      }
      
      // 渲染菜品
      filteredFoods.forEach(food => {
        const card = document.createElement('div');
        card.className = 'food-card bg-white rounded-xl overflow-hidden shadow-sm';
        card.innerHTML = `
          <div class="h-36 overflow-hidden">
            <img src="${food.image}" alt="${food.name}" class="w-full h-full object-cover">
          </div>
          <div class="p-3">
            <h3 class="font-semibold text-lg mb-1">${food.name}</h3>
            <div class="flex justify-between items-center">
              <span class="text-primary font-bold">¥${food.price}</span>
              <button class="add-to-cart-btn bg-primary/10 hover:bg-primary/20 text-primary p-2 rounded-full transition-colors" data-id="${food.id}">
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        `;
        
        // 添加点击事件，显示菜品详情
        card.addEventListener('click', () => {
          showFoodDetail(food);
        });
        
        foodList.appendChild(card);
      });
    }
    
    // 显示菜品详情
    function showFoodDetail(food) {
      detailName.textContent = food.name;
      detailPrice.textContent = `¥${food.price}`;
      detailDesc.textContent = food.description;
      detailImage.src = food.image;
      detailImage.alt = food.name;
      
      // 重置数量
      quantityEl.textContent = '1';
      
      // 设置当前菜品ID到按钮上
      addToCartDetailBtn.dataset.id = food.id;
      
      // 显示详情页
      document.getElementById('menu-page').classList.add('hidden');
      foodDetailPage.classList.remove('hidden');
    }
    
    // 添加到购物车
    function addToCart(foodId) {
      const food = foodData.find(f => f.id === foodId);
      if (!food) return;
      
      // 获取规格和辣度选择（默认为小份和不辣）
      const selectedSpec = document.querySelector('.spec-btn.bg-primary')?.textContent || '小份';
      const selectedSpicy = document.querySelector('.spicy-btn.bg-primary')?.textContent || '不辣';
      
      // 检查购物车中是否已存在该菜品
      const cartItem = cart.find(item => item.id === foodId);
      if (cartItem) {
        cartItem.quantity += 1;
      } else {
        cart.push({
          ...food,
          quantity: 1,
          spec: selectedSpec,
          spicy: selectedSpicy
        });
      }
      
      updateCartUI();
      showToast('已添加到购物车');
    }
    
    // 从购物车删除
    function removeFromCart(foodId) {
      cart = cart.filter(item => item.id !== foodId);
      updateCartUI();
    }
    
    // 增加数量
    function increaseQuantity(foodId) {
      const cartItem = cart.find(item => item.id === foodId);
      if (cartItem) {
        cartItem.quantity += 1;
        updateCartUI();
      }
    }
    
    // 减少数量
    function decreaseQuantity(foodId) {
      const cartItem = cart.find(item => item.id === foodId);
      if (cartItem && cartItem.quantity > 1) {
        cartItem.quantity -= 1;
        updateCartUI();
      }
    }
    
    // 更新购物车UI
    function updateCartUI() {
      // 更新购物车数量显示
      const cartCount = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById('cart-count').textContent = cartCount;
      
      if (cart.length === 0) {
        // 购物车为空
        cartItems.classList.add('hidden');
        cartSummary.classList.add('hidden');
        emptyCart.classList.remove('hidden');
      } else {
        // 购物车有商品
        emptyCart.classList.add('hidden');
        cartItems.classList.remove('hidden');
        cartSummary.classList.remove('hidden');
        
        // 清空购物车项目
        cartItems.innerHTML = '';
        
        // 添加购物车项目
        cart.forEach(item => {
          const itemElement = document.createElement('div');
          itemElement.className = 'bg-white rounded-xl shadow-sm overflow-hidden';
          itemElement.innerHTML = `
            <div class="flex">
              <div class="w-24 h-24">
                <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
              </div>
              <div class="flex-1 p-4">
                <div class="flex justify-between items-start mb-2">
                  <h3 class="font-semibold">${item.name}</h3>
                  <button class="remove-from-cart-btn text-gray-400 hover:text-red-500" data-id="${item.id}">
                    <i class="fa fa-trash"></i>
                  </button>
                </div>
                <p class="text-sm text-gray-500 mb-3">规格: ${item.spec} | 辣度: ${item.spicy}</p>
                <div class="flex justify-between items-center">
                  <span class="text-primary font-bold">¥${item.price}</span>
                  <div class="flex items-center border rounded-lg overflow-hidden">
                    <button class="cart-quantity-btn bg-gray-100 hover:bg-gray-200 p-1.5 transition-colors" data-id="${item.id}">
                      <i class="fa fa-minus text-xs"></i>
                    </button>
                    <span class="w-8 text-center text-sm font-medium">${item.quantity}</span>
                    <button class="cart-quantity-btn bg-gray-100 hover:bg-gray-200 p-1.5 transition-colors" data-id="${item.id}">
                      <i class="fa fa-plus text-xs"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          cartItems.appendChild(itemElement);
        });
        
        // 更新小计和总计
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        subtotalEl.textContent = `¥${subtotal}`;
        totalEl.textContent = `¥${subtotal}`;
      }
    }
    
    // 更新结算UI
    function updateCheckoutUI() {
      // 清空结算项目
      checkoutItems.innerHTML = '';
      
      // 添加结算项目
      cart.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'flex p-3 border-b border-gray-100';
        itemElement.innerHTML = `
          <div class="w-16 h-16 mr-3">
            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded-lg">
          </div>
          <div class="flex-1">
            <h3 class="font-medium">${item.name}</h3>
            <p class="text-sm text-gray-500 mb-1">规格: ${item.spec} | 辣度: ${item.spicy}</p>
            <div class="flex justify-between items-center">
              <span class="text-sm">x ${item.quantity}</span>
              <span class="text-primary font-bold">¥${(item.price * item.quantity).toFixed(2)}</span>
            </div>
          </div>
        `;
        
        checkoutItems.appendChild(itemElement);
      });
      
      // 先移除已存在的优惠券区域
      const existingCouponSection = document.getElementById('checkout-coupon-section');
      if (existingCouponSection) {
        existingCouponSection.remove();
      }
      
      // 创建新的优惠券区域
      const couponSection = document.createElement('div');
      couponSection.id = 'checkout-coupon-section';
      couponSection.className = 'bg-white rounded-xl overflow-hidden shadow-sm mb-6 mt-4';
      
      // 显示可用优惠券
      const couponContainer = document.createElement('div');
      couponContainer.className = 'mt-4 p-3 border-t border-gray-100';
      couponContainer.innerHTML = '<h3 class="font-semibold mb-2">选择优惠券</h3>';
      
      const availableCoupons = getUnusedCoupons();
      if (availableCoupons.length > 0) {
        const couponSelector = document.createElement('div');
        couponSelector.className = 'space-y-2';
        
        // 添加可用优惠券
        availableCoupons.forEach(coupon => {
          const couponElement = document.createElement('div');
          couponElement.className = `coupon-card ${selectedCoupon?.id === coupon.id ? 'selected' : ''}`;
          couponElement.setAttribute('data-id', coupon.id);
          couponElement.onclick = () => selectCoupon(coupon.id);
          couponElement.style.cursor = 'pointer';
          couponElement.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <div class="coupon-discount">${coupon.discount * 10}折优惠券</div>
                <div class="text-xs text-gray-500">${coupon.condition || '特殊活动'}</div>
              </div>
            </div>
          `;
          couponSelector.appendChild(couponElement);
        });
        
        couponContainer.appendChild(couponSelector);
      } else {
        couponContainer.innerHTML += '<p class="text-gray-500 text-sm">暂无可用优惠券</p>';
      }
      
      // 添加到优惠券区域
      couponSection.appendChild(couponContainer);
      
      // 添加到结算页面
      const summarySection = document.querySelector('#checkout-page .bg-white.rounded-xl.p-5.shadow-sm');
      checkoutPage.insertBefore(couponSection, summarySection);
      
      // 更新小计和总计
      updateCheckoutPrices();
    }
    
    // 获取未使用的优惠券
    function getUnusedCoupons() {
      return availableCoupons.filter(coupon => !coupon.used);
    }
    
    // 清除选中的优惠券
    function clearSelectedCoupon() {
      selectedCoupon = null;
      
      // 移除所有优惠券的选中样式
      document.querySelectorAll('.coupon-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      // 更新价格显示
      updateCheckoutPrices();
      updateTotalPrice();
      
      // 显示提示消息
      showToast('已取消使用优惠券');
    }
    
    // 更新结算页面的价格显示
    function updateCheckoutPrices() {
      const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      checkoutSubtotalEl.textContent = `¥${subtotal.toFixed(2)}`;
      
      // 应用优惠券
      if (selectedCoupon) {
        const discount = subtotal * (1 - selectedCoupon.discount);
        const discountedTotal = subtotal - discount;
        
        // 显示折扣信息
        document.querySelector('#checkout-page .space-y-3').innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">商品小计</span>
            <span>¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">配送费</span>
            <span>¥0</span>
          </div>
          <div class="flex justify-between text-green-500 font-medium">
            <span>优惠 (${selectedCoupon.discount * 10}折)</span>
            <span>-¥${discount.toFixed(2)}</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100">
            <span class="font-semibold">实付款</span>
            <span id="checkout-total" class="font-semibold text-primary text-xl">¥${discountedTotal.toFixed(2)}</span>
          </div>
        `;
      } else {
        document.querySelector('#checkout-page .space-y-3').innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">商品小计</span>
            <span>¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">配送费</span>
            <span>¥0</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">优惠</span>
            <span class="text-green-500">-¥0</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100">
            <span class="font-semibold">实付款</span>
            <span id="checkout-total" class="font-semibold text-primary text-xl">¥${subtotal.toFixed(2)}</span>
          </div>
        `;
      }
    }
    
    // 处理提交订单
    function handlePlaceOrder() {
      if (cart.length === 0) {
        showToast('购物车为空，无法提交订单');
        return;
      }
      
      // 计算订单总额（考虑优惠券）
      let subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      let total = subtotal;
      let discount = 0;
      
      if (selectedCoupon) {
        discount = subtotal * (1 - selectedCoupon.discount);
        total = subtotal - discount;
      }
      
      // 更新订单金额
      orderAmountSpan.textContent = `¥${total.toFixed(2)}`;
      
      // 保存当前订单数据用于订单详情页
      currentOrder = {
        id: generateOrderNumber(),
        time: new Date().toISOString().slice(0, 16).replace('T', ' '),
        amount: total,
        subtotal: subtotal,
        discount: discount,
        payment: document.querySelector('input[name="payment"]:checked').nextElementSibling.textContent.trim(),
        recipient: detailRecipient.textContent,
        phone: detailPhone.textContent,
        address: detailAddress.textContent,
        items: [...cart],
        usedCoupon: selectedCoupon ? { ...selectedCoupon } : null
      };
      
      // 如果使用了优惠券，标记为已使用
      if (selectedCoupon) {
        const couponIndex = availableCoupons.findIndex(c => c.id === selectedCoupon.id);
        if (couponIndex !== -1) {
          availableCoupons[couponIndex].used = true;
          saveAvailableCoupons();
        }
      }
      
      // 显示结算成功页
      checkoutPage.classList.add('hidden');
      successPage.classList.remove('hidden');
      
      // 更新成功页面优惠信息
      updateSuccessPageInfo();
      
      // 清理已经使用的优惠券
      cleanupUsedCoupons();
    }
    
    // 更新成功页面信息
    function updateSuccessPageInfo() {
      if (!currentOrder) return;
      
      // 更新订单号和时间
      document.getElementById('order-number').textContent = currentOrder.id;
      document.getElementById('order-time').textContent = currentOrder.time;
      
      // 更新订单金额和优惠信息
      const orderInfoEl = document.querySelector('#success-page .bg-gray-50');
      
      if (currentOrder.usedCoupon) {
        orderInfoEl.innerHTML = `
          <h3 class="font-medium mb-2">订单详情</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">订单编号</span>
              <span id="order-number">${currentOrder.id}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">下单时间</span>
              <span id="order-time">${currentOrder.time}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">商品小计</span>
              <span>¥${currentOrder.subtotal.toFixed(2)}</span>
            </div>
            <div class="flex justify-between text-green-500">
              <span>优惠 (${currentOrder.usedCoupon.discount * 10}折)</span>
              <span>-¥${currentOrder.discount.toFixed(2)}</span>
            </div>
            <div class="flex justify-between font-medium">
              <span class="text-gray-600">实付款</span>
              <span id="order-amount" class="text-primary">¥${currentOrder.amount.toFixed(2)}</span>
            </div>
          </div>
        `;
      } else {
        orderInfoEl.innerHTML = `
          <h3 class="font-medium mb-2">订单详情</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">订单编号</span>
              <span id="order-number">${currentOrder.id}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">下单时间</span>
              <span id="order-time">${currentOrder.time}</span>
            </div>
            <div class="flex justify-between font-medium">
              <span class="text-gray-600">实付款</span>
              <span id="order-amount" class="text-primary">¥${currentOrder.amount.toFixed(2)}</span>
            </div>
          </div>
        `;
      }
    }
    
    // 生成订单号
    function generateOrderNumber() {
      const date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
      return `ORD-${year}${month}${day}-${random}`;
    }
    
    // 清理已使用的优惠券
    function cleanupUsedCoupons() {
      // 移除已使用的优惠券
      availableCoupons = availableCoupons.filter(coupon => !coupon.used);
      saveAvailableCoupons();
      selectedCoupon = null;
    }
    
    // 显示订单详情
    function showOrderDetail() {
      if (!currentOrder) return;
      
      // 填充订单详情页数据
      detailOrderNumber.textContent = currentOrder.id;
      detailOrderTime.textContent = currentOrder.time;
      detailPaymentMethod.textContent = currentOrder.payment;
      detailRecipient.textContent = currentOrder.recipient;
      detailPhone.textContent = currentOrder.phone;
      detailAddress.textContent = currentOrder.address;
      
      // 计算小计金额（未折扣的金额）
      const subtotal = currentOrder.items.reduce((total, item) => total + (item.price * item.quantity), 0);
      detailSubtotal.textContent = `¥${subtotal.toFixed(2)}`;
      
      // 显示优惠信息（如果有使用优惠券）
      const orderSummaryEl = document.querySelector('#order-detail-page .p-5:last-child .space-y-2');
      
      if (currentOrder.usedCoupon) {
        const discount = subtotal * (1 - currentOrder.usedCoupon.discount);
        
        orderSummaryEl.innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">商品小计</span>
            <span id="detail-subtotal">¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">配送费</span>
            <span>¥0</span>
          </div>
          <div class="flex justify-between text-green-500 font-medium">
            <span>优惠 (${currentOrder.usedCoupon.discount * 10}折)</span>
            <span>-¥${discount.toFixed(2)}</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100 text-base">
            <span class="font-semibold">实付款</span>
            <span id="detail-total" class="font-semibold text-primary">¥${currentOrder.amount.toFixed(2)}</span>
          </div>
        `;
      } else {
        orderSummaryEl.innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">商品小计</span>
            <span id="detail-subtotal">¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">配送费</span>
            <span>¥0</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">优惠</span>
            <span class="text-green-500">-¥0</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100 text-base">
            <span class="font-semibold">实付款</span>
            <span id="detail-total" class="font-semibold text-primary">¥${currentOrder.amount.toFixed(2)}</span>
          </div>
        `;
      }
      
      // 填充订单商品
      orderItemsEl.innerHTML = '';
      currentOrder.items.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'flex p-3 border-b border-gray-100';
        itemElement.innerHTML = `
          <div class="w-16 h-16 mr-3">
            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded-lg">
          </div>
          <div class="flex-1">
            <h3 class="font-medium">${item.name}</h3>
            <p class="text-sm text-gray-500 mb-1">规格: ${item.spec} | 辣度: ${item.spicy}</p>
            <div class="flex justify-between items-center">
              <span class="text-sm">x ${item.quantity}</span>
              <span class="text-primary font-bold">¥${(item.price * item.quantity).toFixed(2)}</span>
            </div>
          </div>
        `;
        
        orderItemsEl.appendChild(itemElement);
      });
      
      // 显示订单详情页
      successPage.classList.add('hidden');
      orderDetailPage.classList.remove('hidden');
    }
    
    // 显示提示消息
    function showToast(message) {
      toastMessage.textContent = message;
      toast.classList.remove('hidden');
      
      // 3秒后隐藏提示
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    function createFloatingHearts() {
        const container = document.querySelector('.floating-hearts');
        for (let i = 0; i < 20; i++) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = '❤';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.top = Math.random() * 100 + '%';
            heart.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(heart);
        }
    }

    function showLoginSuccess() {
        const loginSuccess = document.createElement('div');
        loginSuccess.className = 'login-success';
        loginSuccess.innerHTML = `
            <div class="heart-container">
                <div class="heart">❤</div>
            </div>
            <div class="floating-hearts"></div>
            <div class="login-success-text">登录成功</div>
            <div class="login-success-subtext">正在跳转到首页...</div>
        `;
        document.body.appendChild(loginSuccess);
        createFloatingHearts();
    }

    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // 发送登录请求
        fetch('/api/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(response => {
            if (response.code === 200) {
                showLoginSuccess();
                // 3秒后跳转
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } else {
                alert('登录失败：' + response.message);
            }
        })
        .catch(error => {
            console.error('登录错误:', error);
            alert('登录失败，请稍后重试');
        });
    }

    // 优惠券相关变量
    let availableCoupons = [];
    let selectedCoupon = null;
    let massageTimer = null;
    let massageStartTime = null;
    let massageDuration = 0;

    // 显示优惠券模态框
    function showCouponModal() {
      document.getElementById('couponModal').classList.remove('hidden');
    }

    // 关闭优惠券模态框
    function closeCouponModal() {
      document.getElementById('couponModal').classList.add('hidden');
    }

    // 获取优惠券
    function getCoupon(discount, duration) {
      massageDuration = duration;
      document.getElementById('massageDuration').textContent = duration;
      document.getElementById('couponModal').classList.add('hidden');
      document.getElementById('massageTimerModal').classList.remove('hidden');
      document.getElementById('startMassageBtn').classList.remove('hidden');
      document.getElementById('stopMassageBtn').classList.add('hidden');
      document.getElementById('massageTimer').textContent = '00:00';
    }

    // 开始按摩计时
    function startMassage() {
      massageStartTime = Date.now();
      document.getElementById('startMassageBtn').classList.add('hidden');
      document.getElementById('stopMassageBtn').classList.remove('hidden');
      
      massageTimer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - massageStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('massageTimer').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (minutes >= massageDuration) {
          completeMassage();
        }
      }, 1000);
    }

    // 停止按摩
    function stopMassage() {
      clearInterval(massageTimer);
      document.getElementById('massageTimerModal').classList.add('hidden');
    }

    // 完成按摩
    function completeMassage() {
      clearInterval(massageTimer);
      document.getElementById('massageTimerModal').classList.add('hidden');
      
      // 添加优惠券
      const discount = parseFloat(document.querySelector(`[data-duration="${massageDuration}"]`).dataset.discount);
      const coupon = {
        id: Date.now(),
        discount: discount,
        used: false,
        condition: `按摩${massageDuration}分钟获得`,
        expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30天有效期
      };
      availableCoupons.push(coupon);
      
      // 保存到localStorage
      saveAvailableCoupons();
      
      updateMyCoupons();
      
      // 显示成功提示
      showToast(`恭喜获得${discount * 10}折优惠券！`);
    }

    // 保存优惠券到localStorage
    function saveAvailableCoupons() {
      localStorage.setItem('coupons', JSON.stringify(availableCoupons));
    }

    // 选择优惠券
    function selectCoupon(couponId) {
      // 如果点击的是已选中的优惠券，则取消选择
      if (selectedCoupon && selectedCoupon.id === couponId) {
        clearSelectedCoupon();
        return;
      }
      
      selectedCoupon = availableCoupons.find(c => c.id === couponId);
      
      // 更新优惠券选中样式
      if (document.querySelector('.coupon-card.selected')) {
        document.querySelectorAll('.coupon-card').forEach(card => {
          card.classList.remove('selected');
        });
      }
      
      // 找到当前选中的优惠券元素并添加选中样式
      const selectedElement = document.querySelector(`.coupon-card[data-id="${couponId}"]`);
      if (selectedElement) {
        selectedElement.classList.add('selected');
      }
      
      // 更新价格显示
      updateCheckoutPrices();
      updateTotalPrice();
      
      // 显示提示消息
      showToast(`已选择${selectedCoupon.discount * 10}折优惠券`);
    }

    // 修改计算总价的函数
    function updateTotalPrice() {
      let total = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
      });
      
      // 应用优惠券折扣
      if (selectedCoupon) {
        total = total * selectedCoupon.discount;
      }
      
      document.getElementById('totalPrice').textContent = total.toFixed(2);
    }

    // 修改提交订单函数
    function submitOrder() {
      if (cart.length === 0) {
        showToast('请先添加商品到购物车！');
        return;
      }
      
      // 使用优惠券
      if (selectedCoupon) {
        selectedCoupon.used = true;
        saveAvailableCoupons();
        selectedCoupon = null;
        updateMyCoupons();
      }
      
      // 原有的提交订单逻辑
      handlePlaceOrder();
    }

    // 添加事件监听器
    document.getElementById('startMassageBtn').addEventListener('click', startMassage);
    document.getElementById('stopMassageBtn').addEventListener('click', stopMassage);

    // 修改显示结算页面的函数
    function showCheckout() {
      document.getElementById('checkoutPage').classList.remove('hidden');
      updateCheckoutItems();
      updateCheckoutCoupons();
      updateCheckoutPrices();
    }

    // 更新结算页面的优惠券列表
    function updateCheckoutCoupons() {
      const checkoutCoupons = document.getElementById('checkoutCoupons');
      const usableCoupons = availableCoupons.filter(coupon => !coupon.used);
      
      if (usableCoupons.length === 0) {
        checkoutCoupons.innerHTML = '<div class="text-gray-500 text-sm">暂无可用优惠券</div>';
        return;
      }

      checkoutCoupons.innerHTML = usableCoupons.map(coupon => `
        <div class="coupon-card ${selectedCoupon?.id === coupon.id ? 'selected' : ''}" 
             onclick="selectCoupon(${coupon.id})" style="cursor: pointer">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">${coupon.discount * 10}折优惠券</div>
              <div class="text-xs text-gray-500">${coupon.condition || '特殊活动'}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // 修改关闭结算页面的函数
    function closeCheckout() {
      document.getElementById('checkoutPage').classList.add('hidden');
    }

    // 获取爸爸优惠券
    function getDaddyCoupon() {
      document.getElementById('couponModal').classList.add('hidden');
      document.getElementById('daddyModal').classList.remove('hidden');
      
      // 重置模态框状态
      document.getElementById('daddyModalText').textContent = '请对着麦克风叫一声"爸爸"';
      document.getElementById('daddy-voice-result').classList.add('hidden');
      document.getElementById('daddy-voice-result').textContent = '';
      document.getElementById('startRecordingBtn').classList.remove('hidden');
      document.getElementById('recording-controls').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.remove('recording');
    }

    // 处理"爸爸"优惠券获取成功
    function processDaddyCoupon(isDaddy) {
      // 隐藏录音动画
      document.getElementById('voice-animation-daddy').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.remove('recording');
      
      // 重置录音按钮状态，确保下次可以正常使用
      document.getElementById('recording-controls').classList.add('hidden');
      document.getElementById('startRecordingBtn').classList.remove('hidden');
      
      if (isDaddy) {
        document.getElementById('daddyModal').classList.add('hidden');
        
        const coupon = {
          id: Date.now(),
          discount: 0.9,
          used: false,
          condition: "叫一声爸爸获得",
          expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30天有效期
        };
        availableCoupons.push(coupon);
        
        // 保存到localStorage
        saveAvailableCoupons();
        
        updateMyCoupons();
        
        showToast('恭喜获得9折优惠券！');
      } else {
        // 隐藏爸爸模态框
        document.getElementById('daddyModal').classList.add('hidden');
        
        // 显示敲头表情动画
        document.getElementById('knockHeadAnimation').classList.remove('hidden');
      }
    }

    function closeDaddyModal() {
      document.getElementById('daddyModal').classList.add('hidden');
      
      // 停止语音识别（如果正在进行）
      stopDaddyVoiceRecognition();
      
      // 重置录音按钮状态，确保下次可以正常使用
      document.getElementById('recording-controls').classList.add('hidden');
      document.getElementById('startRecordingBtn').classList.remove('hidden');
      document.getElementById('voice-animation-daddy').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.remove('recording');
    }

    // 关闭敲头表情动画
    function closeKnockHeadAnimation() {
      document.getElementById('knockHeadAnimation').classList.add('hidden');
    }

    // 初始化加载优惠券
    function loadAvailableCoupons() {
      try {
        const savedCoupons = localStorage.getItem('coupons');
        if (savedCoupons) {
          availableCoupons = JSON.parse(savedCoupons);
          
          // 处理日期字符串转换为Date对象
          availableCoupons.forEach(coupon => {
            if (typeof coupon.expiryDate === 'string') {
              coupon.expiryDate = new Date(coupon.expiryDate);
            }
          });
        }
      } catch (error) {
        console.error('加载优惠券失败:', error);
        availableCoupons = [];
      }
    }

    // 使用优惠券
    function useCoupon(id) {
      const coupon = availableCoupons.find(c => c.id === id);
      if (!coupon) return;
      
      // 如果点击的是已选中的优惠券，则取消选择
      if (selectedCoupon && selectedCoupon.id === id) {
        clearSelectedCoupon();
        return;
      }
      
      // 选择新的优惠券
      selectedCoupon = coupon;
      showToast(`已选择${coupon.discount * 10}折优惠券`);
      
      // 切换到购物车页面
      switchToPage('cart');
      
      // 更新购物车UI
      updateCartUI();
      
      // 如果购物车不为空，自动进入结算页面
      if (cart.length > 0) {
        setTimeout(() => {
          switchToPage('checkout');
        }, 500);
      }
    }

    // 更新我的优惠券列表
    function updateMyCoupons() {
      const myCouponsContainer = document.getElementById('my-coupons');
      
      if (!myCouponsContainer) return;
      
      if (availableCoupons.length === 0) {
        myCouponsContainer.innerHTML = `
          <div class="text-center py-8">
            <i class="fa fa-ticket text-4xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">暂无优惠券</p>
            <button onclick="showCouponModal()" class="mt-4 bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90">
              获取优惠券
            </button>
          </div>
        `;
        return;
      }
      
      myCouponsContainer.innerHTML = availableCoupons.map(coupon => `
        <div class="coupon-card ${coupon.used ? 'opacity-50' : ''} ${selectedCoupon?.id === coupon.id ? 'selected' : ''}" 
             data-id="${coupon.id}" ${!coupon.used ? `onclick="useCoupon(${coupon.id})"` : ''} style="cursor: ${!coupon.used ? 'pointer' : 'default'}">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">${(coupon.discount * 10).toFixed(0)}折优惠券</div>
              <div class="coupon-condition">${coupon.condition || '特殊活动'}</div>
              <div class="text-sm text-gray-500 mt-2">有效期至：${new Date(coupon.expiryDate).toLocaleDateString()}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // 显示优惠券页面
    function showCouponPage() {
      switchToPage('coupon');
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing initialization code ...
      
      // 初始化优惠券
      loadAvailableCoupons();
      updateMyCoupons();
      
      // 添加导航按钮点击事件
      document.getElementById('home-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('menu');
      });
      
      document.getElementById('cart-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('cart');
      });
      
      document.getElementById('coupon-nav').addEventListener('click', function(e) {
        e.preventDefault();
        showCouponPage();
      });
      
      // 为"爸爸"优惠券按钮添加事件
      document.getElementById('startRecordingBtn').addEventListener('click', function() {
        // 使用Web Speech API进行语音识别
        document.getElementById('startRecordingBtn').classList.add('hidden');
        document.getElementById('recording-controls').classList.remove('hidden');
        document.getElementById('voice-animation-daddy').classList.remove('hidden');
        document.getElementById('voice-animation-daddy').classList.add('recording');
        
        startDaddyVoiceRecognition();
      });
      
      document.getElementById('stopRecordingBtn').addEventListener('click', function() {
        stopDaddyVoiceRecognition();
      });
      
      document.getElementById('cancelRecordingBtn').addEventListener('click', function() {
        // 停止录音并重置状态，不处理结果
        stopDaddyVoiceRecognition();
        document.getElementById('recording-controls').classList.add('hidden');
        document.getElementById('startRecordingBtn').classList.remove('hidden');
        document.getElementById('voice-animation-daddy').classList.add('hidden');
        document.getElementById('voice-animation-daddy').classList.remove('recording');
        document.getElementById('daddy-voice-result').classList.add('hidden');
      });
      
      // 点击敲头动画背景关闭
      document.getElementById('knockHeadAnimation').addEventListener('click', function(e) {
        if (e.target === this) {
          closeKnockHeadAnimation();
        }
      });
    });
    
    // ... existing code ...

    // 初始化变量和元素
    // const searchInput = document.getElementById('search-input'); // 已在前面声明过
    const voiceSearchBtn = document.getElementById('voice-search-btn');
    const voiceSearchModal = document.getElementById('voice-search-modal');
    const voiceAnimation = document.getElementById('voice-animation');
    const voiceResult = document.getElementById('voice-result');
    const voiceCancelBtn = document.getElementById('voice-cancel-btn');
    const voiceConfirmBtn = document.getElementById('voice-confirm-btn');
    
    // 语音识别变量
    let recognition;
    let recognitionResult = '';
    
    // 初始化语音识别
    function initSpeechRecognition() {
      // 检查浏览器是否支持语音识别
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.lang = 'zh-CN'; // 设置为中文
        
        // 处理识别结果
        recognition.onresult = function(event) {
          let interimTranscript = '';
          let finalTranscript = '';
          
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          // 显示识别结果
          recognitionResult = finalTranscript || interimTranscript;
          voiceResult.textContent = recognitionResult || '正在聆听...';
        };
        
        // 处理识别结束
        recognition.onend = function() {
          voiceAnimation.classList.remove('recording');
          if (!recognitionResult) {
            voiceResult.textContent = '未能识别，请重试';
          }
        };
        
        // 处理错误
        recognition.onerror = function(event) {
          console.error('语音识别错误:', event.error);
          voiceAnimation.classList.remove('recording');
          voiceResult.textContent = '识别出错，请重试';
        };
      } else {
        voiceSearchBtn.style.display = 'none';
        console.warn('浏览器不支持语音识别');
      }
    }
    
    // 开始语音识别
    function startVoiceRecognition() {
      if (recognition) {
        voiceSearchModal.classList.remove('hidden');
        voiceAnimation.classList.add('recording');
        voiceResult.textContent = '请说出您想要的美食';
        recognitionResult = '';
        
        try {
          recognition.start();
        } catch (e) {
          console.error('语音识别启动失败:', e);
        }
      }
    }
    
    // 停止语音识别
    function stopVoiceRecognition() {
      if (recognition) {
        try {
          recognition.stop();
        } catch (e) {
          console.error('语音识别停止失败:', e);
        }
      }
    }
    
    // 确认语音搜索结果
    function confirmVoiceSearch() {
      if (recognitionResult) {
        searchInput.value = recognitionResult;
        searchTerm = recognitionResult.toLowerCase();
        renderFoodList();
        showToast(`正在搜索: ${recognitionResult}`);
      }
      voiceSearchModal.classList.add('hidden');
      stopVoiceRecognition();
    }
    
    // 取消语音搜索
    function cancelVoiceSearch() {
      voiceSearchModal.classList.add('hidden');
      stopVoiceRecognition();
    }
    
    // 初始化语音识别
    initSpeechRecognition();
    
    // 绑定语音搜索按钮事件
    voiceSearchBtn.addEventListener('click', startVoiceRecognition);
    voiceCancelBtn.addEventListener('click', cancelVoiceSearch);
    voiceConfirmBtn.addEventListener('click', confirmVoiceSearch);
    
    // 点击模态框外部关闭
    voiceSearchModal.addEventListener('click', function(e) {
      if (e.target === voiceSearchModal) {
        cancelVoiceSearch();
      }
    });

    // 初始化变量
    let pendingOrders = [];
    let completedOrders = [];

    // 更新待结算订单
    function updatePendingOrders() {
      const pendingOrdersList = document.getElementById('pending-orders-list');
      const emptyPending = document.getElementById('empty-pending');
      
      // 如果没有待结算订单
      if (pendingOrders.length === 0) {
        pendingOrdersList.classList.add('hidden');
        emptyPending.classList.remove('hidden');
        return;
      }
      
      // 显示待结算订单列表
      pendingOrdersList.classList.remove('hidden');
      emptyPending.classList.add('hidden');
      
      // 清空列表
      pendingOrdersList.innerHTML = '';
      
      // 添加待结算订单
      pendingOrders.forEach((order, index) => {
        const orderElement = document.createElement('div');
        orderElement.className = 'bg-white rounded-xl shadow-sm overflow-hidden mb-4';
        
        // 计算订单总金额
        const totalAmount = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        orderElement.innerHTML = `
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-bold">待结算订单 #${index + 1}</h3>
              <span class="text-primary font-bold">¥${totalAmount.toFixed(2)}</span>
            </div>
            <div class="text-sm text-gray-500 mb-3">
              ${order.items.length}件商品 | ${new Date(order.time).toLocaleString()}
            </div>
            <div class="space-y-2 mb-4">
              ${order.items.map(item => `
                <div class="flex justify-between">
                  <span>${item.name} x${item.quantity}</span>
                  <span>¥${(item.price * item.quantity).toFixed(2)}</span>
                </div>
              `).join('')}
            </div>
            <div class="flex space-x-2">
              <button class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-2 rounded-lg transition-all" onclick="checkoutPendingOrder(${index})">
                去结算
              </button>
              <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-lg transition-all" onclick="deletePendingOrder(${index})">
                删除
              </button>
            </div>
          </div>
        `;
        
        pendingOrdersList.appendChild(orderElement);
      });
    }
    
    // 结算待结算订单
    function checkoutPendingOrder(index) {
      const order = pendingOrders[index];
      if (!order) return;
      
      // 将待结算订单中的商品添加到购物车
      cart = [...order.items];
      
      // 删除该待结算订单
      pendingOrders.splice(index, 1);
      savePendingOrders();
      
      // 跳转到结算页面
      switchToPage('checkout');
    }
    
    // 删除待结算订单
    function deletePendingOrder(index) {
      if (confirm('确定要删除这个待结算订单吗？')) {
        pendingOrders.splice(index, 1);
        savePendingOrders();
        updatePendingOrders();
        showToast('已删除待结算订单');
      }
    }
    
    // 保存待结算订单到localStorage
    function savePendingOrders() {
      localStorage.setItem('pendingOrders', JSON.stringify(pendingOrders));
    }
    
    // 加载待结算订单
    function loadPendingOrders() {
      try {
        const savedPendingOrders = localStorage.getItem('pendingOrders');
        if (savedPendingOrders) {
          pendingOrders = JSON.parse(savedPendingOrders);
        }
      } catch (error) {
        console.error('加载待结算订单失败:', error);
        pendingOrders = [];
      }
    }
    
    // 将当前购物车保存为待结算订单
    function saveAsPendingOrder() {
      if (cart.length === 0) {
        showToast('购物车为空，无法保存');
        return;
      }
      
      const pendingOrder = {
        time: new Date().toISOString(),
        items: [...cart]
      };
      
      pendingOrders.push(pendingOrder);
      savePendingOrders();
      
      // 清空购物车
      cart = [];
      updateCartUI();
      
      showToast('已保存到待结算订单');
      switchToPage('pending');
    }
    
    // 更新订单列表
    function updateOrdersList() {
      const ordersList = document.getElementById('orders-list');
      const emptyOrders = document.getElementById('empty-orders');
      
      // 如果没有已完成订单
      if (completedOrders.length === 0) {
        ordersList.classList.add('hidden');
        emptyOrders.classList.remove('hidden');
        return;
      }
      
      // 显示订单列表
      ordersList.classList.remove('hidden');
      emptyOrders.classList.add('hidden');
      
      // 清空列表
      ordersList.innerHTML = '';
      
      // 添加已完成订单
      completedOrders.forEach((order, index) => {
        const orderElement = document.createElement('div');
        orderElement.className = 'bg-white rounded-xl shadow-sm overflow-hidden mb-4';
        
        orderElement.innerHTML = `
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-bold">订单 #${order.id}</h3>
              <span class="text-primary font-bold">¥${order.amount.toFixed(2)}</span>
            </div>
            <div class="text-sm text-gray-500 mb-3">
              ${order.items.length}件商品 | ${new Date(order.time).toLocaleString()}
            </div>
            <div class="space-y-2 mb-4">
              ${order.items.slice(0, 2).map(item => `
                <div class="flex justify-between">
                  <span>${item.name} x${item.quantity}</span>
                  <span>¥${(item.price * item.quantity).toFixed(2)}</span>
                </div>
              `).join('')}
              ${order.items.length > 2 ? `<div class="text-gray-500 text-sm">等${order.items.length}件商品</div>` : ''}
            </div>
            <div class="flex justify-between items-center">
              <div class="text-sm">
                <span class="text-gray-500">状态:</span>
                <span class="text-green-500">已完成</span>
              </div>
              <button class="bg-primary/10 hover:bg-primary/20 text-primary px-4 py-2 rounded-lg transition-all" onclick="viewOrderDetail(${index})">
                查看详情
              </button>
            </div>
          </div>
        `;
        
        ordersList.appendChild(orderElement);
      });
    }
    
    // 查看订单详情
    function viewOrderDetail(index) {
      const order = completedOrders[index];
      if (!order) return;
      
      // 设置当前订单
      currentOrder = order;
      
      // 显示订单详情页面
      switchToPage('orderDetail');
    }
    
    // 保存已完成订单到localStorage
    function saveCompletedOrders() {
      localStorage.setItem('completedOrders', JSON.stringify(completedOrders));
    }
    
    // 加载已完成订单
    function loadCompletedOrders() {
      try {
        const savedCompletedOrders = localStorage.getItem('completedOrders');
        if (savedCompletedOrders) {
          completedOrders = JSON.parse(savedCompletedOrders);
        }
      } catch (error) {
        console.error('加载已完成订单失败:', error);
        completedOrders = [];
      }
    }

    // 修改handlePlaceOrder函数，添加保存到已完成订单的功能
    function handlePlaceOrder() {
      if (cart.length === 0) {
        showToast('购物车为空，无法提交订单');
        return;
      }
      
      // 计算订单总额（考虑优惠券）
      let subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      let total = subtotal;
      let discount = 0;
      
      if (selectedCoupon) {
        discount = subtotal * (1 - selectedCoupon.discount);
        total = subtotal - discount;
      }
      
      // 更新订单金额
      orderAmountSpan.textContent = `¥${total.toFixed(2)}`;
      
      // 保存当前订单数据用于订单详情页
      currentOrder = {
        id: generateOrderNumber(),
        time: new Date().toISOString().slice(0, 16).replace('T', ' '),
        amount: total,
        subtotal: subtotal,
        discount: discount,
        payment: document.querySelector('input[name="payment"]:checked').nextElementSibling.textContent.trim(),
        recipient: detailRecipient.textContent,
        phone: detailPhone.textContent,
        address: detailAddress.textContent,
        items: [...cart],
        usedCoupon: selectedCoupon ? { ...selectedCoupon } : null
      };
      
      // 将订单添加到已完成订单列表
      completedOrders.unshift(currentOrder);
      saveCompletedOrders();
      
      // 如果使用了优惠券，标记为已使用
      if (selectedCoupon) {
        const couponIndex = availableCoupons.findIndex(c => c.id === selectedCoupon.id);
        if (couponIndex !== -1) {
          availableCoupons[couponIndex].used = true;
          saveAvailableCoupons();
        }
      }
      
      // 显示结算成功页
      checkoutPage.classList.add('hidden');
      successPage.classList.remove('hidden');
      
      // 更新成功页面优惠信息
      updateSuccessPageInfo();
      
      // 清理已经使用的优惠券
      cleanupUsedCoupons();
      
      // 清空购物车
      cart = [];
    }

    // 添加导航按钮点击事件
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing initialization code ...
      
      document.getElementById('pending-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('pending');
      });
      
      document.getElementById('orders-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('orders');
      });
      
      document.getElementById('back-to-menu-from-pending').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      document.getElementById('back-to-menu-from-orders').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      document.getElementById('go-to-menu-from-empty-pending').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      document.getElementById('go-to-menu-from-empty-orders').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      // 加载待结算订单和已完成订单
      loadPendingOrders();
      loadCompletedOrders();
    });
// ... existing code ...
  </script>
</body>
</html>