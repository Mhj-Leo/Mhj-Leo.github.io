<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¼ªå¤§å¨ç¾é£Ÿ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
  <script>
    
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FF5722', // æ©™è‰²ä½œä¸ºä¸»è‰²è°ƒï¼Œä»£è¡¨é£Ÿç‰©å’Œæ´»åŠ›
            secondary: '#4CAF50', // ç»¿è‰²ä½œä¸ºè¾…åŠ©è‰²ï¼Œä»£è¡¨æ–°é²œå’Œå¥åº·
            accent: '#FFC107', // é»„è‰²ä½œä¸ºå¼ºè°ƒè‰²ï¼Œä»£è¡¨æ¸©æš–å’Œå¿«ä¹
            dark: '#333333', // æ·±ç°è‰²ä½œä¸ºæ–‡æœ¬é¢œè‰²
            light: '#F5F5F5', // æµ…ç°è‰²ä½œä¸ºèƒŒæ™¯è‰²
            love: '#FF4D6D', // çˆ±å¿ƒä¸“ç”¨ç²‰è‰²
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <!-- è‡ªå®šä¹‰å·¥å…·ç±» -->
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }
      .btn-hover {
        transition: all 0.3s ease;
      }
      .btn-hover:hover {
        transform: translateY(-2px);
      }
      .food-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .food-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .love-heart {
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: theme('colors.love');
        opacity: 0.8;
        transform: rotate(45deg);
        animation: fall 4s linear forwards, float 2s ease-in-out infinite;
        z-index: 50;
      }
      .love-heart:before, .love-heart:after {
        content: "";
        position: absolute;
        width: 20px;
        height: 20px;
        background-color: theme('colors.love');
        border-radius: 50%;
      }
      .love-heart:before {
        top: -10px;
        left: 0;
      }
      .love-heart:after {
        top: 0;
        left: -10px;
      }
      @keyframes fall {
        0% {
          top: -10%;
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        100% {
          top: 100%;
          opacity: 0;
        }
      }
      @keyframes float {
        0%, 100% {
          transform: rotate(45deg) translateX(0);
        }
        50% {
          transform: rotate(45deg) translateX(15px);
        }
      }
      .love-text {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: theme('colors.love');
        font-size: 2rem;
        font-weight: bold;
        text-shadow: 0 0 15px rgba(255, 77, 109, 0.8);
        z-index: 60;
        opacity: 0;
        animation: fadeInOut 3s ease-in-out forwards;
      }
      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        30%, 70% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
      }

      /* ç™»å½•æˆåŠŸåŠ¨ç”» */
      @keyframes ripple {
          0% {
              transform: scale(0);
              opacity: 0.8;
          }
          100% {
              transform: scale(2);
              opacity: 0;
          }
      }

      @keyframes welcomeText {
          0% {
              transform: translateY(20px);
              opacity: 0;
          }
          100% {
              transform: translateY(0);
              opacity: 1;
          }
      }

      @keyframes iconRotate {
          0% {
              transform: rotate(-180deg) scale(0);
              opacity: 0;
          }
          100% {
              transform: rotate(0) scale(1);
              opacity: 1;
          }
      }

      @keyframes backgroundShift {
          0% {
              background-position: 0% 50%;
          }
          50% {
              background-position: 100% 50%;
          }
          100% {
              background-position: 0% 50%;
          }
      }

      .login-success {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          background: linear-gradient(135deg, #ff6b6b, #ff8e8e, #ffb6b6);
          background-size: 400% 400%;
          animation: backgroundShift 8s ease infinite;
          z-index: 9999;
          overflow: hidden;
      }

      .login-success::before {
          content: '';
          position: absolute;
          width: 150px;
          height: 150px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.1);
          animation: ripple 2s ease-out infinite;
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      }

      .login-success::after {
          content: '';
          position: absolute;
          width: 150px;
          height: 150px;
          border-radius: 50%;
          background: rgba(255, 255, 255, 0.1);
          animation: ripple 2s ease-out 1s infinite;
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
      }

      .login-success-icon {
          font-size: 80px;
          color: white;
          margin-bottom: 20px;
          animation: iconRotate 1s ease-out;
          text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      .login-success-text {
          font-size: 28px;
          color: white;
          text-align: center;
          animation: welcomeText 1s ease-out;
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          font-weight: 500;
      }

      .login-success-subtext {
          font-size: 16px;
          color: rgba(255, 255, 255, 0.9);
          margin-top: 10px;
          animation: welcomeText 1s ease-out 0.3s backwards;
          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* ç™»å½•æˆåŠŸåŠ¨ç”» */
      @keyframes heartBeat {
          0% {
              transform: scale(0.8);
              opacity: 0;
          }
          50% {
              transform: scale(1.2);
              opacity: 1;
          }
          100% {
              transform: scale(1);
              opacity: 0.8;
          }
      }

      @keyframes float {
          0% {
              transform: translateY(0) rotate(0deg);
          }
          50% {
              transform: translateY(-20px) rotate(10deg);
          }
          100% {
              transform: translateY(0) rotate(0deg);
          }
      }

      .heart-container {
          position: absolute;
          width: 100%;
          height: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
      }

      .heart {
          position: absolute;
          font-size: 100px;
          color: white;
          animation: heartBeat 1.5s ease-in-out infinite;
          text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      }

      .floating-hearts {
          position: absolute;
          width: 100%;
          height: 100%;
          pointer-events: none;
      }

      .floating-heart {
          position: absolute;
          font-size: 30px;
          color: rgba(255, 255, 255, 0.6);
          animation: float 3s ease-in-out infinite;
      }

      .login-success-text {
          font-size: 36px;
          color: white;
          text-align: center;
          margin-top: 20px;
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
          font-weight: bold;
          z-index: 2;
      }

      .login-success-subtext {
          font-size: 18px;
          color: rgba(255, 255, 255, 0.9);
          margin-top: 10px;
          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
          z-index: 2;
      }

      /* ä¼˜æƒ åˆ¸æ ·å¼ */
      .coupon-card {
        border: 2px dashed #FF5722;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        background: rgba(255, 87, 34, 0.05);
        transition: all 0.3s ease;
      }
      
      .coupon-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(255, 87, 34, 0.2);
      }
      
      .coupon-card.selected {
        background: rgba(255, 87, 34, 0.08);
        border-style: solid;
        border-width: 1px;
        border-color: #FF5722;
        box-shadow: 0 4px 12px rgba(255, 87, 34, 0.15);
        position: relative;
      }
      
      /* æ·»åŠ é€‰ä¸­çŠ¶æ€çš„å·¦ä¾§è¾¹æ¡†æ ‡è®° */
      .coupon-card.selected::before {
        content: '';
        position: absolute;
        left: -1px;
        top: 10px;
        bottom: 10px;
        width: 3px;
        background: #FF5722;
        border-radius: 0 2px 2px 0;
      }
      
      .coupon-card.selected::after {
        content: 'âœ“';
        position: absolute;
        top: -10px;
        right: -10px;
        background: #FF5722;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      
      .coupon-discount {
        font-size: 24px;
        font-weight: bold;
        color: #FF5722;
      }
      
      .coupon-condition {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }

      /* è¯­éŸ³å½•éŸ³åŠ¨ç”» */
      .voice-wave {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: rgba(255, 107, 107, 0.1);
        animation: voice-wave 2s infinite ease-out;
      }
      
      .delay-1 {
        animation-delay: 0.6s;
      }
      
      .delay-2 {
        animation-delay: 1.2s;
      }
      
      @keyframes voice-wave {
        0% {
          transform: scale(0.5);
          opacity: 1;
        }
        100% {
          transform: scale(1.5);
          opacity: 0;
        }
      }
      
      #voice-animation {
        position: relative;
        background-color: rgba(255, 107, 107, 0.1);
      }
      
      #voice-animation.recording .voice-wave {
        background-color: rgba(255, 107, 107, 0.2);
      }
      
      #voice-animation.recording i {
        color: #ff6b6b;
        animation: pulse 1s infinite;
      }
      
      @keyframes pulse {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
      }
    }
    
    /* ç™»å½•é¡µé¢ç¾é£ŸèƒŒæ™¯ */
    .food-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-position: center;
      filter: blur(3px) brightness(0.7);
      z-index: -1;
      animation: slowZoom 30s infinite alternate ease-in-out;
      transform-origin: center;
    }
    
    .food-bg::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255, 107, 107, 0.4) 0%, rgba(255, 184, 140, 0.4) 100%);
    }
    
    @keyframes slowZoom {
      0% {
        transform: scale(1);
      }
      100% {
        transform: scale(1.1);
      }
    }
    
    .login-container {
      backdrop-filter: blur(10px);
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      animation: fadeInUp 0.8s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .login-title {
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .floating-food {
      position: absolute;
      opacity: 0.8;
      filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
      animation: float 6s infinite ease-in-out;
      z-index: -1;
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
      }
      50% {
        transform: translateY(-20px) rotate(5deg);
      }
    }
  </style>
</head>

<body class="bg-light font-sans text-dark min-h-screen">
  <!-- åº”ç”¨å®¹å™¨ -->
  <div id="app" class="min-h-screen flex flex-col">
    <!-- ç™»å½•é¡µ -->
    <div id="login-page" class="flex flex-col items-center justify-center h-screen p-6">
      <!-- ç¾é£ŸèƒŒæ™¯ -->
      <div class="food-bg"></div>
      
      <!-- æ¼‚æµ®çš„é£Ÿç‰©å›¾æ ‡ -->
      <img src="https://cdn-icons-png.flaticon.com/512/2515/2515263.png" class="floating-food w-16 h-16 top-20 left-20" style="animation-delay: 0s;">
      <img src="https://cdn-icons-png.flaticon.com/512/1046/1046857.png" class="floating-food w-14 h-14 top-40 right-40" style="animation-delay: 1s;">
      <img src="https://cdn-icons-png.flaticon.com/512/1147/1147805.png" class="floating-food w-12 h-12 bottom-20 left-1/4" style="animation-delay: 2s;">
      <img src="https://cdn-icons-png.flaticon.com/512/3075/3075929.png" class="floating-food w-16 h-16 bottom-40 right-1/4" style="animation-delay: 3s;">
      
      <div class="w-full max-w-md login-container p-8 fade-in">
        <div class="text-center mb-8">
          <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-primary mb-2 login-title">ç¼ªå¤§å¨ç¾é£Ÿ</h1>
          <p class="text-gray-600">è¯·ç™»å½•åç‚¹é¤</p>
        </div>
        
        <form id="login-form" class="space-y-6">
          <div class="space-y-2">
            <label for="name" class="block text-sm font-medium text-gray-700">å§“å</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-user text-gray-400"></i>
              </div>
              <input type="text" id="name" name="name" placeholder="è¯·è¾“å…¥å§“å" 
                class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
            </div>
          </div>
          
          <div class="space-y-2">
            <label for="phone" class="block text-sm font-medium text-gray-700">æ‰‹æœºå·</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-phone text-gray-400"></i>
              </div>
              <input type="tel" id="phone" name="phone" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
                class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
            </div>
          </div>
          
          <button type="submit" 
            class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover flex items-center justify-center">
            <i class="fa fa-sign-in mr-2"></i> ç™»å½•
          </button>
        </form>
      </div>
    </div>
    
    <!-- ä¸»åº”ç”¨é¡µé¢ (é»˜è®¤éšè—) -->
    <div id="main-app" class="hidden flex-1 flex flex-col">
      <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
      <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
          <div class="flex items-center">
            <h1 class="text-xl font-bold text-primary">ç¼ªå¤§å¨ç¾é£Ÿ</h1>
          </div>
          <div class="flex items-center space-x-4">
            <button id="cart-btn" class="relative text-gray-600 hover:text-primary transition-colors">
              <i class="fa fa-shopping-cart text-xl"></i>
              <span id="cart-count" class="absolute -top-2 -right-2 bg-primary text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
            <button id="logout-btn" class="text-gray-600 hover:text-red-500 transition-colors">
              <i class="fa fa-sign-out text-xl"></i>
            </button>
          </div>
        </div>
      </header>
      
      <!-- å†…å®¹åŒºåŸŸ -->
      <main class="flex-1 overflow-y-auto">
        <!-- ç‚¹é¤é¡µ -->
        <div id="menu-page" class="p-4">
          <!-- æœç´¢æ  -->
          <div class="mb-6">
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fa fa-search text-gray-400"></i>
              </div>
              <input type="text" id="search-input" placeholder="æœç´¢ç¾é£Ÿ..." 
                class="w-full pl-10 pr-16 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all">
              <button id="voice-search-btn" class="absolute inset-y-0 right-0 px-4 text-gray-500 hover:text-primary transition-colors">
                <i class="fa fa-microphone"></i>
              </button>
            </div>
          </div>
          
          <!-- è¯­éŸ³æœç´¢æ¨¡æ€æ¡† -->
          <div id="voice-search-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4 text-center">
              <div id="voice-animation" class="w-24 h-24 mx-auto mb-4 rounded-full flex items-center justify-center">
                <div class="voice-wave"></div>
                <div class="voice-wave delay-1"></div>
                <div class="voice-wave delay-2"></div>
                <i class="fa fa-microphone text-3xl text-primary"></i>
              </div>
              <h3 class="text-lg font-bold mb-2">æ­£åœ¨è†å¬...</h3>
              <p id="voice-result" class="text-gray-600 mb-4">è¯·è¯´å‡ºæ‚¨æƒ³è¦çš„ç¾é£Ÿ</p>
              <div class="flex space-x-3">
                <button id="voice-cancel-btn" class="flex-1 py-2 px-4 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                  å–æ¶ˆ
                </button>
                <button id="voice-confirm-btn" class="flex-1 py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                  ç¡®è®¤
                </button>
              </div>
            </div>
          </div>
          
          <!-- åˆ†ç±»æ ‡ç­¾ -->
          <div class="flex overflow-x-auto pb-4 mb-6 scrollbar-hide space-x-2">
            <button class="category-btn bg-primary text-white px-4 py-2 rounded-full whitespace-nowrap" data-category="all">å…¨éƒ¨</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="hot">çƒ­èœ</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="cold">å‡‰èœ</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="staple">ä¸»é£Ÿ</button>
            <button class="category-btn bg-white text-gray-700 px-4 py-2 rounded-full whitespace-nowrap shadow-sm" data-category="soup">æ±¤å“</button>
          </div>
          
          <!-- èœå“åˆ—è¡¨ -->
          <div id="food-list" class="grid grid-cols-2 gap-4">
            <!-- èœå“å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
          </div>
        </div>
        
        <!-- èœå“è¯¦æƒ…é¡µ (é»˜è®¤éšè—) -->
        <div id="food-detail-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">èœå“è¯¦æƒ…</h2>
          </div>
          
          <div class="bg-white rounded-xl overflow-hidden shadow-sm mb-6">
            <div class="h-64 image-container">
              <img id="detail-image" src="https://img0.baidu.com/it/u=2614935587,2823371438&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=1067" alt="å®«ä¿é¸¡ä¸" class="w-full h-full object-cover">
            </div>
            <div class="p-5">
              <div class="flex justify-between items-start mb-2">
                <h3 id="detail-name" class="text-2xl font-bold">å®«ä¿é¸¡ä¸</h3>
                <span id="detail-price" class="text-primary font-bold text-xl">Â¥38</span>
              </div>
              <p id="detail-desc" class="text-gray-600 mb-6">
                å®«ä¿é¸¡ä¸æ˜¯ä¸€é“ç»å…¸çš„å·èœï¼Œä»¥é²œå«©çš„é¸¡è‚‰å—ä¸ºä¸»æ–™ï¼Œæ­é…é¦™è„†çš„èŠ±ç”Ÿã€å¹²è¾£æ¤’å’Œè”¬èœç‚’åˆ¶è€Œæˆã€‚
                å£æ„Ÿé²œé¦™éº»è¾£ï¼Œé¸¡è‚‰æ»‘å«©ï¼ŒèŠ±ç”Ÿé…¥è„†ï¼Œæ˜¯ä¸€é“æ·±å—æ¬¢è¿çš„å®¶å¸¸ç¾é£Ÿã€‚
              </p>
              
              <div class="mb-6">
                <h4 class="font-semibold mb-3">è§„æ ¼é€‰æ‹©</h4>
                <div class="grid grid-cols-3 gap-3">
                  <button class="spec-btn bg-primary text-white py-2 px-3 rounded-lg">å°ä»½</button>
                  <button class="spec-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">ä¸­ä»½</button>
                  <button class="spec-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">å¤§ä»½</button>
                </div>
              </div>
              
              <div class="mb-6">
                <h4 class="font-semibold mb-3">è¾£åº¦é€‰æ‹©</h4>
                <div class="grid grid-cols-4 gap-3">
                  <button class="spicy-btn bg-primary text-white py-2 px-3 rounded-lg">ä¸è¾£</button>
                  <button class="spicy-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">å¾®è¾£</button>
                  <button class="spicy-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">ä¸­è¾£</button>
                  <button class="spicy-btn bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-3 rounded-lg transition-colors">ç‰¹è¾£</button>
                </div>
              </div>
              
              <div class="flex justify-between items-center">
                <div class="flex items-center border rounded-lg overflow-hidden">
                  <button class="quantity-btn bg-gray-100 hover:bg-gray-200 p-2 transition-colors">
                    <i class="fa fa-minus"></i>
                  </button>
                  <span id="quantity" class="w-10 text-center font-medium">1</span>
                  <button class="quantity-btn bg-gray-100 hover:bg-gray-200 p-2 transition-colors">
                    <i class="fa fa-plus"></i>
                  </button>
                </div>
                <button id="add-to-cart-detail" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                  åŠ å…¥è´­ç‰©è½¦
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- è´­ç‰©è½¦é¡µ (é»˜è®¤éšè—) -->
        <div id="cart-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-cart" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">æˆ‘çš„è´­ç‰©è½¦</h2>
          </div>
          
          <div id="empty-cart" class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
            <i class="fa fa-shopping-cart text-5xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-medium text-gray-500 mb-2">è´­ç‰©è½¦æ˜¯ç©ºçš„</h3>
            <p class="text-gray-400 mb-6">å¿«å»æŒ‘é€‰å–œçˆ±çš„ç¾é£Ÿå§ï¼</p>
            <button id="go-to-menu-from-empty-cart" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
              å»ç‚¹é¤
            </button>
          </div>
          
          <div id="cart-items" class="hidden space-y-4 mb-6">
            <!-- è´­ç‰©è½¦å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
          </div>
          
          <div id="cart-summary" class="hidden bg-white rounded-xl p-5 shadow-sm">
            <div class="space-y-3 mb-5">
              <div class="flex justify-between">
                <span class="text-gray-600">å°è®¡</span>
                <span id="subtotal">Â¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">é…é€è´¹</span>
                <span>Â¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">ä¼˜æƒ </span>
                <span class="text-green-500">-Â¥0</span>
              </div>
              <div class="flex justify-between pt-3 border-t border-gray-100">
                <span class="font-semibold">æ€»è®¡</span>
                <span id="total" class="font-semibold text-primary">Â¥0</span>
              </div>
            </div>
            
            <div class="flex space-x-3">
              <button id="save-pending-btn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
                ä¿å­˜å¾…ç»“ç®—
                <i class="fa fa-clock-o ml-2"></i>
              </button>
              <button id="checkout-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
                å»ç»“ç®—
                <i class="fa fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>
        
        <!-- ç»“ç®—é¡µ (é»˜è®¤éšè—) -->
        <div id="checkout-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-cart" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">ç»“ç®—</h2>
          </div>
          
          <div class="bg-white rounded-xl overflow-hidden shadow-sm mb-6">
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-2">æ”¶è´§ä¿¡æ¯</h3>
              <div class="flex items-center">
                <div class="mr-3">
                  <i class="fa fa-map-marker text-primary"></i>
                </div>
                <div class="flex-1">
                  <div class="flex justify-between">
                    <span class="font-medium">ç‹å†¬</span>
                    <span>15252775173</span>
                  </div>
                  <p class="text-gray-500 text-sm mt-1">æ’ç›Šå›­8æ ‹äºŒå•å…ƒ</p>
                </div>
              </div>
            </div>
            
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-3">è®¢å•ä¿¡æ¯</h3>
              <div id="checkout-items" class="space-y-3 mb-4">
                <!-- ç»“ç®—å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
              </div>
            </div>
            
            <div class="p-5">
              <h3 class="font-semibold mb-3">æ”¯ä»˜æ–¹å¼</h3>
              <div class="space-y-3">
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                  <input type="radio" name="payment" id="alipay" class="mr-3" checked>
                  <label for="alipay" class="flex items-center flex-1 cursor-pointer">
                    <i class="fa fa-credit-card text-blue-500 mr-3"></i>
                    <span>æ”¯ä»˜å®</span>
                  </label>
                </div>
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                  <input type="radio" name="payment" id="wechat" class="mr-3">
                  <label for="wechat" class="flex items-center flex-1 cursor-pointer">
                    <i class="fa fa-wechat text-green-500 mr-3"></i>
                    <span>å¾®ä¿¡æ”¯ä»˜</span>
                  </label>
                </div>
                <div class="flex items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors cursor-pointer">
                  <input type="radio" name="payment" id="cash" class="mr-3">
                  <label for="cash" class="flex items-center flex-1 cursor-pointer">
                    <i class="fa fa-money text-gray-500 mr-3"></i>
                    <span>è´§åˆ°ä»˜æ¬¾</span>
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <div class="bg-white rounded-xl p-5 shadow-sm">
            <div class="space-y-3 mb-5">
              <div class="flex justify-between">
                <span class="text-gray-600">å•†å“å°è®¡</span>
                <span id="checkout-subtotal">Â¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">é…é€è´¹</span>
                <span>Â¥0</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">ä¼˜æƒ </span>
                <span class="text-green-500">-Â¥0</span>
              </div>
              <div class="flex justify-between pt-3 border-t border-gray-100">
                <span class="font-semibold">å®ä»˜æ¬¾</span>
                <span id="checkout-total" class="font-semibold text-primary">Â¥0</span>
              </div>
            </div>
            
            <button id="place-order-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
              æäº¤è®¢å•
              <i class="fa fa-check ml-2"></i>
            </button>
          </div>
        </div>
        
        <!-- ç»“ç®—æˆåŠŸé¡µ (é»˜è®¤éšè—) -->
        <div id="success-page" class="hidden flex flex-col items-center justify-center p-4 h-full">
          <div class="bg-white rounded-2xl p-8 card-shadow text-center max-w-md w-full">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="fa fa-check text-3xl text-green-500"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">è®¢å•æäº¤æˆåŠŸ</h2>
            <p class="text-gray-500 mb-6">
              ç¼ªå¤§å¨å·²æ”¶åˆ°ï¼Œè¯·åŠæ—¶ä»˜æ¬¾ç»™ç¼ªå¤§å¨ï¼Œå°‘ä¸€åˆ†ä¸åšï¼
            </p>
            <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
              <h3 class="font-medium mb-2">è®¢å•è¯¦æƒ…</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">è®¢å•ç¼–å·</span>
                  <span id="order-number">ORD-20250612-1234</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">ä¸‹å•æ—¶é—´</span>
                  <span id="order-time"></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">å®ä»˜æ¬¾</span>
                  <span id="order-amount" class="text-primary">Â¥0</span>
                </div>
              </div>
            </div>
            <div class="flex space-x-3">
              <button id="new-order-btn" class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                ç»§ç»­ç‚¹é¤
              </button>
              <button id="order-detail-btn" class="flex-1 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                æŸ¥çœ‹è®¢å•
              </button>
            </div>
          </div>
        </div>
        
        <!-- è®¢å•è¯¦æƒ…é¡µ (é»˜è®¤éšè—) -->
        <div id="order-detail-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-from-order-detail" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">è®¢å•è¯¦æƒ…</h2>
            <button id="logout-btn-detail" class="ml-auto text-gray-600 hover:text-red-500 transition-colors">
              <i class="fa fa-sign-out"></i> é€€å‡ºç™»å½•
            </button>
          </div>
          
          <div class="bg-white rounded-xl overflow-hidden shadow-sm mb-6">
            <div class="p-5 border-b border-gray-100">
              <div class="flex justify-between items-center">
                <h3 class="font-semibold">è®¢å•ä¿¡æ¯</h3>
                <span class="bg-green-100 text-green-600 text-xs font-medium px-2.5 py-0.5 rounded-full">å·²æ”¯ä»˜</span>
              </div>
              <div class="space-y-2 mt-3 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">è®¢å•ç¼–å·</span>
                  <span id="detail-order-number">ORD-20250612-1234</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">ä¸‹å•æ—¶é—´</span>
                  <span id="detail-order-time"></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">æ”¯ä»˜æ–¹å¼</span>
                  <span id="detail-payment-method">æ”¯ä»˜å®</span>
                </div>
              </div>
            </div>
            
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-3">æ”¶è´§ä¿¡æ¯</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">æ”¶è´§äºº</span>
                  <span id="detail-recipient">ç‹å†¬</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">è”ç³»ç”µè¯</span>
                  <span id="detail-phone">15252775173</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">æ”¶è´§åœ°å€</span>
                  <span id="detail-address">æ’ç›Šå›­8æ ‹äºŒå•å…ƒ</span>
                </div>
              </div>
            </div>
            
            <div class="p-5 border-b border-gray-100">
              <h3 class="font-semibold mb-3">å•†å“ä¿¡æ¯</h3>
              <div id="order-items" class="space-y-3 mb-4">
                <!-- è®¢å•å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
              </div>
            </div>
            
            <div class="p-5">
              <h3 class="font-semibold mb-3">è®¢å•é‡‘é¢</h3>
              <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">å•†å“å°è®¡</span>
                  <span id="detail-subtotal">Â¥0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">é…é€è´¹</span>
                  <span>Â¥0</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">ä¼˜æƒ </span>
                  <span class="text-green-500">-Â¥0</span>
                </div>
                <div class="flex justify-between pt-3 border-t border-gray-100 text-base">
                  <span class="font-semibold">å®ä»˜æ¬¾</span>
                  <span id="detail-total" class="font-semibold text-primary">Â¥0</span>
                </div>
              </div>
            </div>
          </div>
          
          <button id="back-to-home-btn" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover flex justify-center items-center">
            è¿”å›é¦–é¡µ
            <i class="fa fa-home ml-2"></i>
          </button>
        </div>

        <!-- ä¼˜æƒ åˆ¸é¡µé¢ (é»˜è®¤éšè—) -->
        <div id="coupon-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-coupon" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">æˆ‘çš„ä¼˜æƒ åˆ¸</h2>
          </div>
          
          <div id="my-coupons" class="space-y-4">
            <!-- ä¼˜æƒ åˆ¸å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
          </div>
          
          <button onclick="showCouponModal()" class="fixed bottom-20 right-4 bg-primary text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center">
            <i class="fa fa-plus text-xl"></i>
          </button>
        </div>
        
        <!-- å¾…ç»“ç®—é¡µé¢ (é»˜è®¤éšè—) -->
        <div id="pending-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-pending" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">å¾…ç»“ç®—è®¢å•</h2>
          </div>
          
          <div id="pending-orders-container" class="space-y-4">
            <div id="empty-pending" class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
              <i class="fa fa-clock-o text-5xl text-gray-300 mb-4"></i>
              <h3 class="text-xl font-medium text-gray-500 mb-2">æš‚æ— å¾…ç»“ç®—è®¢å•</h3>
              <p class="text-gray-400 mb-6">æ‚¨çš„è´­ç‰©è½¦ä¸­çš„å•†å“ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
              <button id="go-to-menu-from-empty-pending" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                å»ç‚¹é¤
              </button>
            </div>
            
            <div id="pending-orders-list" class="hidden">
              <!-- å¾…ç»“ç®—è®¢å•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
          </div>
        </div>
        
        <!-- æˆ‘çš„è®¢å•é¡µé¢ (é»˜è®¤éšè—) -->
        <div id="orders-page" class="hidden p-4">
          <div class="flex items-center mb-4">
            <button id="back-to-menu-from-orders" class="text-gray-600 hover:text-primary mr-2">
              <i class="fa fa-arrow-left"></i>
            </button>
            <h2 class="text-xl font-bold">æˆ‘çš„è®¢å•</h2>
          </div>
          
          <div id="orders-container" class="space-y-4">
            <div id="empty-orders" class="flex flex-col items-center justify-center py-16 bg-white rounded-xl shadow-sm">
              <i class="fa fa-list-alt text-5xl text-gray-300 mb-4"></i>
              <h3 class="text-xl font-medium text-gray-500 mb-2">æš‚æ— è®¢å•è®°å½•</h3>
              <p class="text-gray-400 mb-6">æ‚¨çš„è®¢å•è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
              <button id="go-to-menu-from-empty-orders" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-6 rounded-lg transition-all duration-300 ease-in-out btn-hover">
                å»ç‚¹é¤
              </button>
            </div>
            
            <div id="orders-list" class="hidden">
              <!-- è®¢å•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
          </div>
        </div>
      </main>
      
      <!-- åº•éƒ¨å¯¼èˆªæ  -->
      <footer class="bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] py-2">
        <div class="container mx-auto px-4">
          <div class="flex justify-around">
            <a href="#" class="nav-link flex flex-col items-center text-primary" id="home-nav">
              <i class="fa fa-cutlery text-xl"></i>
              <span class="text-xs mt-1">èœå•</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="cart-nav">
              <i class="fa fa-shopping-cart text-xl"></i>
              <span class="text-xs mt-1">è´­ç‰©è½¦</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="pending-nav">
              <i class="fa fa-clock-o text-xl"></i>
              <span class="text-xs mt-1">å¾…ç»“ç®—</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="orders-nav">
              <i class="fa fa-list-alt text-xl"></i>
              <span class="text-xs mt-1">è®¢å•</span>
            </a>
            <a href="#" class="nav-link flex flex-col items-center text-gray-500 hover:text-primary transition-colors" id="coupon-nav">
              <i class="fa fa-ticket text-xl"></i>
              <span class="text-xs mt-1">ä¼˜æƒ åˆ¸</span>
            </a>
          </div>
        </div>
      </footer>
    </div>
    
    <!-- é€€å‡ºç™»å½•ç¡®è®¤æ¨¡æ€æ¡† -->
    <div id="logout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-6 max-w-md w-full card-shadow fade-in">
        <div class="text-center">
          <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa fa-exclamation-triangle text-2xl text-red-500"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">é€€å‡ºç™»å½•</h3>
          <p class="text-gray-500 mb-6">ç¡®å®šè¦é€€å‡ºå½“å‰è´¦å·å—ï¼Ÿ</p>
          <div class="flex space-x-3">
            <button id="cancel-logout" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
              å–æ¶ˆ
            </button>
            <button id="confirm-logout" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
              ç¡®è®¤
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ç™»å½•æˆåŠŸç‰¹æ•ˆå®¹å™¨ -->
    <div id="login-effect" class="fixed inset-0 z-50 pointer-events-none hidden">
      <div class="love-text" id="love-message">ä¸ºç‹å†¬å…¬ä¸»æœåŠ¡</div>
    </div>
    
    <!-- æ¨¡æ€æ¡† - ç™»å½•æˆåŠŸæç¤º -->
    <div id="login-success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-6 max-w-md w-full card-shadow fade-in">
        <div class="text-center">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fa fa-check text-2xl text-primary"></i>
          </div>
          <h3 class="text-xl font-bold mb-2">ç™»å½•æˆåŠŸ</h3>
          <p class="text-gray-500 mb-6">æ¬¢è¿æ¥åˆ°ç¼ªå¤§å¨çš„ç¾é£Ÿä¸–ç•Œ</p>
          <button id="close-login-modal" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 ease-in-out btn-hover">
            ç¡®å®š
          </button>
        </div>
      </div>
    </div>
    
    <!-- æç¤ºæ¶ˆæ¯ -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-dark text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden">
      <p id="toast-message"></p>
    </div>
  </div>
  
  <!-- ä¼˜æƒ åˆ¸æ¨¡æ€æ¡† -->
  <div id="couponModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4">
      <h3 class="text-xl font-bold mb-4">è·å–ä¼˜æƒ åˆ¸</h3>
      <div class="space-y-4">
        <div class="coupon-card" data-discount="0.5" data-duration="30">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">5æŠ˜ä¼˜æƒ åˆ¸</div>
              <div class="coupon-condition">æŒ‰æ‘©30åˆ†é’Ÿå³å¯è·å¾—</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getCoupon(0.5, 30)">
              è·å–
            </button>
          </div>
        </div>
        <div class="coupon-card" data-discount="0.7" data-duration="20">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">7æŠ˜ä¼˜æƒ åˆ¸</div>
              <div class="coupon-condition">æŒ‰æ‘©20åˆ†é’Ÿå³å¯è·å¾—</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getCoupon(0.7, 20)">
              è·å–
            </button>
          </div>
        </div>
        <div class="coupon-card" data-discount="0.8" data-duration="10">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">8æŠ˜ä¼˜æƒ åˆ¸</div>
              <div class="coupon-condition">æŒ‰æ‘©10åˆ†é’Ÿå³å¯è·å¾—</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getCoupon(0.8, 10)">
              è·å–
            </button>
          </div>
        </div>
        <div class="coupon-card" data-discount="0.9">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">9æŠ˜ä¼˜æƒ åˆ¸</div>
              <div class="coupon-condition">å«ä¸€å£°çˆ¸çˆ¸å³å¯è·å¾—</div>
            </div>
            <button class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90" onclick="getDaddyCoupon()">
              è·å–
            </button>
          </div>
        </div>
      </div>
      <button class="mt-4 w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300" onclick="closeCouponModal()">
        å…³é—­
      </button>
    </div>
  </div>

  <!-- å«çˆ¸çˆ¸æ¨¡æ€æ¡† -->
  <div id="daddyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4 text-center">
      <h3 class="text-xl font-bold mb-4">è·å–9æŠ˜ä¼˜æƒ åˆ¸</h3>
      <p class="text-gray-600 mb-4" id="daddyModalText">è¯·å¯¹ç€éº¦å…‹é£å«ä¸€å£°"çˆ¸çˆ¸"</p>
      <div id="voice-animation-daddy" class="w-24 h-24 mx-auto mb-4 rounded-full flex items-center justify-center hidden">
        <div class="voice-wave"></div>
        <div class="voice-wave delay-1"></div>
        <div class="voice-wave delay-2"></div>
        <i class="fa fa-microphone text-3xl text-primary"></i>
      </div>
      <p id="daddy-voice-result" class="text-gray-600 mb-4 hidden"></p>
      <div class="flex flex-col space-y-3">
        <button id="startRecordingBtn" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90">
          å¼€å§‹å½•éŸ³
        </button>
        <div id="recording-controls" class="hidden flex space-x-3">
          <button id="stopRecordingBtn" class="flex-1 bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">
            åœæ­¢å½•éŸ³
          </button>
          <button id="cancelRecordingBtn" class="flex-1 bg-red-500 text-white px-6 py-2 rounded-full hover:bg-red-600">
            å–æ¶ˆå½•éŸ³
          </button>
        </div>
      </div>
      <button onclick="closeDaddyModal()" class="mt-4 w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300">
        å…³é—­
      </button>
    </div>
  </div>

  <!-- æ•²å¤´è¡¨æƒ…åŠ¨ç”» -->
  <div id="knockHeadAnimation" class="fixed inset-0 bg-black bg-opacity-80 hidden z-50 flex flex-col items-center justify-center">
    <div class="text-9xl animate-bounce mb-4">ğŸ¤¦</div>
    <p class="text-white text-2xl font-bold mb-8 animate-pulse">ä½ å°å­ï¼Œè¿˜ä¸æ‰¿è®¤æˆ‘æ˜¯ä½ çˆ¸çˆ¸</p>
    <button onclick="closeKnockHeadAnimation()" class="bg-white text-primary px-6 py-2 rounded-full hover:bg-opacity-90">
      çŸ¥é“äº†
    </button>
  </div>
  
  <!-- æŒ‰æ‘©è®¡æ—¶å™¨æ¨¡æ€æ¡† -->
  <div id="massageTimerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-6 w-96 max-w-full mx-4 text-center relative">
      <button onclick="stopMassage()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
        <i class="fa fa-times text-xl"></i>
      </button>
      <h3 class="text-xl font-bold mb-4">æŒ‰æ‘©è®¡æ—¶</h3>
      <div class="text-4xl font-bold text-primary mb-4" id="massageTimer">00:00</div>
      <div class="text-gray-600 mb-4">è¯·ä¸ºç¼ªå¤§å¨æŒ‰æ‘© <span id="massageDuration">0</span> åˆ†é’Ÿ</div>
      <button id="startMassageBtn" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90">
        å¼€å§‹æŒ‰æ‘©
      </button>
      <button id="stopMassageBtn" class="hidden mt-2 bg-gray-200 text-gray-700 px-6 py-2 rounded-full hover:bg-gray-300">
        åœæ­¢æŒ‰æ‘©
      </button>
    </div>
  </div>

  <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
  <div id="couponList" class="fixed bottom-20 right-16 z-40 bg-white rounded-lg shadow-lg p-4 w-64 hidden">
    <h4 class="font-bold mb-2">æˆ‘çš„ä¼˜æƒ åˆ¸</h4>
      <!-- ä¼˜æƒ åˆ¸å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
    </div>
  </div>

  <!-- ç»“ç®—é¡µé¢ -->
  <div id="checkoutPage" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
    <div class="bg-white h-full w-full md:w-96 md:ml-auto p-6 overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">è®¢å•ç»“ç®—</h2>
        <button onclick="closeCheckout()" class="text-gray-500 hover:text-gray-700">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <!-- è®¢å•å•†å“åˆ—è¡¨ -->
      <div class="space-y-4 mb-6">
        <div id="checkoutItems" class="space-y-4">
          <!-- è®¢å•å•†å“å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </div>
      </div>

      <!-- ä¼˜æƒ åˆ¸é€‰æ‹©åŒºåŸŸ -->
      <div class="mb-6">
        <h3 class="font-bold mb-2">é€‰æ‹©ä¼˜æƒ åˆ¸</h3>
        <div id="checkoutCoupons" class="space-y-2">
          <div class="text-gray-500 text-sm">æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸</div>
        </div>
        <button onclick="showCouponModal()" class="mt-2 text-primary hover:text-opacity-80 text-sm">
          <i class="fa fa-plus"></i> è·å–æ›´å¤šä¼˜æƒ åˆ¸
        </button>
      </div>
      
      <!-- è®¢å•æ€»è®¡ -->
      <div class="border-t pt-4">
        <div class="flex justify-between items-center mb-2">
          <span class="text-gray-600">å•†å“æ€»é¢</span>
          <span id="subtotalPrice">Â¥0.00</span>
        </div>
        <div class="flex justify-between items-center mb-2" id="discountRow" style="display: none;">
          <span class="text-gray-600">ä¼˜æƒ é‡‘é¢</span>
          <span id="discountAmount" class="text-primary">-Â¥0.00</span>
        </div>
        <div class="flex justify-between items-center text-lg font-bold">
          <span>æ€»è®¡</span>
          <span id="totalPrice" class="text-primary">Â¥0.00</span>
        </div>
      </div>

      <button onclick="submitOrder()" class="w-full bg-primary text-white py-3 rounded-full mt-6 hover:bg-opacity-90">
        æäº¤è®¢å•
      </button>
    </div>
  </div>

  <script>
    // å…¨å±€æ•°æ®
    let isLoggedIn = false; // ç™»å½•çŠ¶æ€
    let cart = [];
    let currentCategory = 'all';
    let searchTerm = '';
    let currentOrder = null;
    let loggedInUser = null; // å­˜å‚¨ç™»å½•ç”¨æˆ·ä¿¡æ¯
    
    // çˆ¸çˆ¸è¯­éŸ³è¯†åˆ«å˜é‡
    let daddyRecognition;
    let daddyRecognitionResult = '';
    
    // åˆå§‹åŒ–çˆ¸çˆ¸è¯­éŸ³è¯†åˆ«
    function initDaddyVoiceRecognition() {
      // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        daddyRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        daddyRecognition.continuous = false;
        daddyRecognition.interimResults = true;
        daddyRecognition.lang = 'zh-CN'; // è®¾ç½®ä¸ºä¸­æ–‡
        
        // å¤„ç†è¯†åˆ«ç»“æœ
        daddyRecognition.onresult = function(event) {
          let interimTranscript = '';
          let finalTranscript = '';
          
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          // æ˜¾ç¤ºè¯†åˆ«ç»“æœ
          daddyRecognitionResult = finalTranscript || interimTranscript;
          document.getElementById('daddy-voice-result').textContent = daddyRecognitionResult || 'æ­£åœ¨è†å¬...';
          document.getElementById('daddy-voice-result').classList.remove('hidden');
        };
        
        // å¤„ç†è¯†åˆ«ç»“æŸ
        daddyRecognition.onend = function() {
          document.getElementById('voice-animation-daddy').classList.remove('recording');
          
          if (!daddyRecognitionResult) {
            // éšè—çˆ¸çˆ¸æ¨¡æ€æ¡†
            document.getElementById('daddyModal').classList.add('hidden');
            
            // æ˜¾ç¤ºæ•²å¤´è¡¨æƒ…åŠ¨ç”»
            document.getElementById('knockHeadAnimation').classList.remove('hidden');
            
            // é‡ç½®å½•éŸ³æŒ‰é’®çŠ¶æ€ï¼Œç¡®ä¿ä¸‹æ¬¡å¯ä»¥æ­£å¸¸ä½¿ç”¨
            document.getElementById('recording-controls').classList.add('hidden');
            document.getElementById('startRecordingBtn').classList.remove('hidden');
            return;
          }
          
          // æ£€æŸ¥æ˜¯å¦è¯´äº†"çˆ¸çˆ¸"
          const isDaddy = daddyRecognitionResult.includes('çˆ¸çˆ¸');
          processDaddyCoupon(isDaddy);
        };
        
        // å¤„ç†é”™è¯¯
        daddyRecognition.onerror = function(event) {
          console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
          document.getElementById('voice-animation-daddy').classList.remove('recording');
          
                  // å¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯
        if (event.error === 'no-speech') {
          // æ˜¾ç¤ºæç¤ºä¿¡æ¯
          document.getElementById('daddy-voice-result').textContent = 'æ²¡æœ‰å¬åˆ°æ‚¨è¯´è¯ï¼Œè¯·é‡è¯•';
          document.getElementById('daddy-voice-result').classList.remove('hidden');
          document.getElementById('recording-controls').classList.add('hidden');
          document.getElementById('startRecordingBtn').classList.remove('hidden');
          
          // 3ç§’åé‡æ–°æ˜¾ç¤ºå¼€å§‹å½•éŸ³æŒ‰é’®
          setTimeout(() => {
            if (document.getElementById('daddyModal').classList.contains('hidden')) return;
            document.getElementById('daddyModalText').textContent = 'è¯·å¯¹ç€éº¦å…‹é£å«ä¸€å£°"çˆ¸çˆ¸"';
            document.getElementById('daddy-voice-result').classList.add('hidden');
          }, 3000);
        } else {
          // å…¶ä»–é”™è¯¯æ˜¾ç¤ºæ•²å¤´è¡¨æƒ…
          document.getElementById('daddyModal').classList.add('hidden');
          document.getElementById('knockHeadAnimation').classList.remove('hidden');
          document.getElementById('recording-controls').classList.add('hidden');
          document.getElementById('startRecordingBtn').classList.remove('hidden');
        }
        };
      }
    }
    
    // å¼€å§‹çˆ¸çˆ¸è¯­éŸ³è¯†åˆ«
    function startDaddyVoiceRecognition() {
      if (!daddyRecognition) {
        initDaddyVoiceRecognition();
      }
      
      if (daddyRecognition) {
        document.getElementById('daddy-voice-result').textContent = 'æ­£åœ¨è†å¬...';
        document.getElementById('daddy-voice-result').classList.remove('hidden');
        daddyRecognitionResult = '';
        
        try {
          daddyRecognition.start();
        } catch (e) {
          console.error('è¯­éŸ³è¯†åˆ«å¯åŠ¨å¤±è´¥:', e);
          document.getElementById('daddy-voice-result').textContent = 'è¯­éŸ³è¯†åˆ«å¯åŠ¨å¤±è´¥ï¼Œè¯·é‡è¯•';
          document.getElementById('stopRecordingBtn').classList.add('hidden');
          document.getElementById('startRecordingBtn').classList.remove('hidden');
        }
      }
    }
    
    // åœæ­¢çˆ¸çˆ¸è¯­éŸ³è¯†åˆ«
    function stopDaddyVoiceRecognition() {
      if (daddyRecognition) {
        try {
          daddyRecognition.stop();
        } catch (e) {
          console.error('è¯­éŸ³è¯†åˆ«åœæ­¢å¤±è´¥:', e);
        }
      }
    }
    
    // èœå“æ•°æ®ï¼ˆå·²æ›¿æ¢ä¸ºçœŸå®å¯è®¿é—®çš„å›¾ç‰‡ï¼‰
    const foodData = [
      // çƒ­èœ
      {
        id: 1,
        name: 'å®«ä¿é¸¡ä¸',
        price: 38,
        description: 'ç»å…¸å·èœï¼Œé²œå«©é¸¡è‚‰æ­é…é¦™è„†èŠ±ç”Ÿã€å¹²è¾£æ¤’å’Œè”¬èœï¼Œå£æ„Ÿé²œé¦™éº»è¾£ã€‚',
        image: 'https://img0.baidu.com/it/u=2614935587,2823371438&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=1067',
        category: 'hot',
        tags: ['å·èœ', 'è¾£', 'çƒ­é”€']
      },
      {
        id: 2,
        name: 'é±¼é¦™è‚‰ä¸',
        price: 32,
        description: 'ä¼ ç»Ÿå·èœï¼ŒçŒªè‚‰ä¸é…ä»¥æœ¨è€³ã€èƒ¡èåœç­‰è”¬èœï¼Œé…¸ç”œå¾®è¾£ï¼Œé¦™æ°”æ‰‘é¼»ã€‚',
        image: 'https://img1.baidu.com/it/u=4072396536,3897783405&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=667',
        category: 'hot',
        tags: ['å·èœ', 'é…¸ç”œ']
      },
      {
        id: 3,
        name: 'éº»å©†è±†è…',
        price: 28,
        description: 'éº»è¾£é²œé¦™çš„ç»å…¸å·èœï¼Œå«©è±†è…ä¸è‚‰æœ«å®Œç¾ç»“åˆï¼Œä¸‹é¥­ä½³å“ã€‚',
        image: 'https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage109.360doc.com%2FDownloadImg%2F2024%2F12%2F1320%2F291950008_3_20241213080511131&refer=http%3A%2F%2Fimage109.360doc.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1752317985&t=3760de53b644b62a6ecc31dbe9d90577',
        category: 'hot',
        tags: ['å·èœ', 'è¾£', 'çƒ­é”€']
      },
      {
        id: 4,
        name: 'ç³–é†‹æ’éª¨',
        price: 42,
        description: 'é…¸ç”œå¯å£çš„å®¶å¸¸èœï¼ŒçŒªå°æ’é…ä»¥ç‰¹åˆ¶ç³–é†‹æ±ï¼Œè‚‰è´¨é²œå«©ã€‚',
        image: 'https://qcloud.dpfile.com/pc/_p2ScpP85UpOivz3B37fvtIAbvOez8g8WJbCX0YpqZ9OvnLpWKfeEkt4lRrW2v6K.jpg',
        category: 'hot',
        tags: ['é…¸ç”œ', 'å®¶å¸¸']
      },
      {
        id: 5,
        name: 'çº¢çƒ§è‚‰',
        price: 48,
        description: 'è‚¥è€Œä¸è…»çš„ç»å…¸å®¶å¸¸èœï¼Œäº”èŠ±è‚‰é…ä»¥å†°ç³–ã€é…±æ²¹çƒ§åˆ¶ï¼Œé¦™ç”œå¯å£ã€‚',
        image: 'https://img2.baidu.com/it/u=954568553,3432212147&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=745',
        category: 'hot',
        tags: ['å®¶å¸¸', 'ç”œ']
      },
      {
        id: 6,
        name: 'å¯ä¹é¸¡ç¿…',
        price: 48,
        description: 'è‚¥è€Œä¸è…»çš„ç»å…¸å®¶å¸¸èœï¼Œé¸¡ç¿…é…ä»¥å†°ç³–ã€é†‹ï¼Œé…±æ²¹çƒ§åˆ¶ï¼Œé¦™ç”œå¯å£ã€‚',
        image: 'https://pic.rmb.bdstatic.com/bjh/240307/0a62de68e24e433f67d2ab558df9ab1b6572.jpeg',
        category: 'hot',
        tags: ['å®¶å¸¸', 'ç”œ']
      },
      {
        id: 7,
        name: 'è¾£çƒ§é¸¡çˆª',
        price: 48,
        description: 'é¦™è¾£è§£é¦‹ï¼Œé¸¡çˆªè½¯çƒ‚å…¥å‘³',
        image: 'https://img2.baidu.com/it/u=11922117,731404843&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=902',
        category: 'hot',
        tags: ['å®¶å¸¸', 'è¾£']
      },
      {
        id: 8,
        name: 'é»„ç„–é¸¡',
        price: 48,
        description: 'é»„ç„–é¸¡æ˜¯ä¸€é“è®©äººå›å‘³æ— ç©·çš„ç¾é£Ÿï¼Œå®ƒçš„æµ“éƒé¦™æ°”å’Œç‹¬ç‰¹çš„å£æ„Ÿè®©äººéš¾ä»¥å¿˜æ€€ã€‚é¸¡è‚‰é²œå«©ç»†è…»ï¼Œæ¯ä¸€å£éƒ½å……æ»¡äº†é†‡åšçš„å£æ„Ÿï¼Œè®©äººä¸ç¦ä¸€å£æ¥ä¸€å£ã€‚',
        image: 'https://img0.baidu.com/it/u=1626638360,2246865851&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=1212',
        category: 'hot',
        tags: ['å®¶å¸¸', 'å¾®è¾£']
      },
      
      // å‡‰èœ
      {
        id: 9,
        name: 'å‡‰æ‹Œé»„ç“œ',
        price: 12,
        description: 'æ¸…çˆ½å¯å£çš„å®¶å¸¸èœï¼Œé»„ç“œé…ä»¥è’œæœ«ã€é†‹ç­‰è°ƒæ–™å‡‰æ‹Œï¼Œè§£æš‘ä½³å“ã€‚',
        image: 'https://img0.baidu.com/it/u=2460532109,2661651747&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=667',
        category: 'cold',
        tags: ['æ¸…çˆ½', 'å®¶å¸¸']
      },
      {
        id: 10,
        name: 'å¤«å¦»è‚ºç‰‡',
        price: 36,
        description: 'ç»å…¸å·èœå‡‰èœï¼Œç‰›å¤´çš®ã€ç‰›å¿ƒç­‰é…ä»¥è¾£æ¤’æ²¹ã€èŠ±æ¤’æ²¹ï¼Œéº»è¾£é²œé¦™ã€‚',
        image: 'https://img0.baidu.com/it/u=521970733,339027069&fm=253&fmt=auto&app=120&f=JPEG?w=800&h=900',
        category: 'cold',
        tags: ['å·èœ', 'è¾£']
      },
      {
        id: 11,
        name: 'å‡‰æ‹Œæœ¨è€³',
        price: 16,
        description: 'å¥åº·æ¸…çˆ½çš„å®¶å¸¸èœï¼Œæœ¨è€³é…ä»¥è’œæœ«ã€é†‹ç­‰è°ƒæ–™å‡‰æ‹Œï¼Œè¥å…»ä¸°å¯Œã€‚',
        image: 'https://img1.baidu.com/it/u=1821773267,4216692821&fm=253&fmt=auto&app=138&f=JPEG?w=800&h=500',
        category: 'cold',
        tags: ['å¥åº·', 'å®¶å¸¸']
      },
      
      // ä¸»é£Ÿ
      {
        id: 12,
        name: 'é’æ¤’è‚‰ä¸é¢',
        price: 18,
        description: 'æ‰‹å·¥åˆ¶ä½œçš„é¢æ¡ï¼Œå£æ„Ÿç­‹é“ï¼Œæ±¤æ±é²œç¾ã€‚',
        image: 'https://img1.baidu.com/it/u=4264226242,1050909318&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=647',
        category: 'staple',
        tags: ['å®¶å¸¸', 'ä¸»é£Ÿ']
      },
      
      // æ±¤å“
      {
        id: 13,
        name: 'è¥¿çº¢æŸ¿é¸¡è›‹æ±¤',
        price: 16,
        description: 'ç®€å•å®¶å¸¸çš„æ±¤å“ï¼Œè¥¿çº¢æŸ¿ä¸é¸¡è›‹å®Œç¾ç»“åˆï¼Œé…¸ç”œå¯å£ï¼Œè¥å…»ä¸°å¯Œã€‚',
        image: 'https://pic.rmb.bdstatic.com/bjh/240322/events/fc18e216fe55202bd9fec8554ff5869f4335.jpeg@h_1280',
        category: 'soup',
        tags: ['å®¶å¸¸', 'æ¸…æ·¡']
      },
      {
        id: 14,
        name: 'é…¸è¾£æ±¤',
        price: 22,
        description: 'ç»å…¸å·èœæ±¤å“ï¼Œè±†è…ã€æœ¨è€³ç­‰é…ä»¥è¾£æ¤’æ²¹ã€èŠ±æ¤’æ²¹ï¼Œéº»è¾£é²œé¦™ã€‚',
        image: 'https://miaobi-lite.bj.bcebos.com/miaobi/5mao/b%27LV8xNzM2NDg4MTc1LjIyNTkxODg%3D%27/0.png?authorization=bce-auth-v1%2FALTAKmda7zOvhZVbRzBLewvCMU%2F2025-01-10T05%3A49%3A36Z%2F-1%2F%2Fa7e1485c337dc1f7e6ebbad9bc7e98955df4794e671578d8def7ecc60955dade',
        category: 'soup',
        tags: ['å·èœ', 'è¾£']
      }
    ];
    
    // DOMå…ƒç´ 
    const loginPage = document.getElementById('login-page');
    const mainApp = document.getElementById('main-app');
    const loginForm = document.getElementById('login-form');
    const loginSuccessModal = document.getElementById('login-success-modal');
    const closeLoginModalBtn = document.getElementById('close-login-modal');
    const foodList = document.getElementById('food-list');
    const foodDetailPage = document.getElementById('food-detail-page');
    const backToMenuBtn = document.getElementById('back-to-menu');
    const detailName = document.getElementById('detail-name');
    const detailPrice = document.getElementById('detail-price');
    const detailDesc = document.getElementById('detail-desc');
    const detailImage = document.getElementById('detail-image');
    const addToCartDetailBtn = document.getElementById('add-to-cart-detail');
    const quantityEl = document.getElementById('quantity');
    const cartBtn = document.getElementById('cart-btn');
    const cartNav = document.getElementById('cart-nav');
    const cartPage = document.getElementById('cart-page');
    const backToMenuFromCartBtn = document.getElementById('back-to-menu-from-cart');
    const cartItems = document.getElementById('cart-items');
    const emptyCart = document.getElementById('empty-cart');
    const cartSummary = document.getElementById('cart-summary');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkoutPage = document.getElementById('checkout-page');
    const backToCartBtn = document.getElementById('back-to-cart');
    const checkoutItems = document.getElementById('checkout-items');
    const checkoutSubtotalEl = document.getElementById('checkout-subtotal');
    const checkoutTotalEl = document.getElementById('checkout-total');
    const placeOrderBtn = document.getElementById('place-order-btn');
    const successPage = document.getElementById('success-page');
    const newOrderBtn = document.getElementById('new-order-btn');
    const orderDetailBtn = document.getElementById('order-detail-btn');
    const orderNumberSpan = document.getElementById('order-number');
    const orderTimeSpan = document.getElementById('order-time');
    const orderAmountSpan = document.getElementById('order-amount');
    const goToMenuFromEmptyCartBtn = document.getElementById('go-to-menu-from-empty-cart');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const searchInput = document.getElementById('search-input');
    const categoryBtns = document.querySelectorAll('.category-btn');
    const loginEffect = document.getElementById('login-effect');
    const loveMessage = document.getElementById('love-message');
    const orderDetailPage = document.getElementById('order-detail-page');
    const backFromOrderDetailBtn = document.getElementById('back-from-order-detail');
    const orderItemsEl = document.getElementById('order-items');
    const detailOrderNumber = document.getElementById('detail-order-number');
    const detailOrderTime = document.getElementById('detail-order-time');
    const detailPaymentMethod = document.getElementById('detail-payment-method');
    const detailRecipient = document.getElementById('detail-recipient');
    const detailPhone = document.getElementById('detail-phone');
    const detailAddress = document.getElementById('detail-address');
    const detailSubtotal = document.getElementById('detail-subtotal');
    const detailTotal = document.getElementById('detail-total');
    const backToHomeBtn = document.getElementById('back-to-home-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const logoutBtnDetail = document.getElementById('logout-btn-detail');
    const logoutModal = document.getElementById('logout-modal');
    const cancelLogoutBtn = document.getElementById('cancel-logout');
    const confirmLogoutBtn = document.getElementById('confirm-logout');
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // è®¾ç½®å½“å‰æ—¶é—´
      const now = new Date();
      orderTimeSpan.textContent = now.toISOString().slice(0, 16).replace('T', ' ');
      detailOrderTime.textContent = now.toISOString().slice(0, 16).replace('T', ' ');
      
      // ç»‘å®šç™»å½•è¡¨å•æäº¤äº‹ä»¶
      loginForm.addEventListener('submit', handleLogin);
      
      // ç»‘å®šå…³é—­ç™»å½•æˆåŠŸæ¨¡æ€æ¡†äº‹ä»¶
      closeLoginModalBtn.addEventListener('click', () => {
        loginSuccessModal.classList.add('hidden');
        mainApp.classList.remove('hidden');
        renderFoodList();
      });
      
      // ç»‘å®šè¿”å›èœå•æŒ‰é’®äº‹ä»¶
      backToMenuBtn.addEventListener('click', () => {
        foodDetailPage.classList.add('hidden');
        document.getElementById('menu-page').classList.remove('hidden');
      });
      
      // ç»‘å®šè´­ç‰©è½¦æŒ‰é’®äº‹ä»¶
      cartBtn.addEventListener('click', () => {
        switchToPage('cart');
      });
      
      // ç»‘å®šåº•éƒ¨å¯¼èˆªè´­ç‰©è½¦æŒ‰é’®äº‹ä»¶
      cartNav.addEventListener('click', () => {
        switchToPage('cart');
      });
      
      // ç»‘å®šä»è´­ç‰©è½¦è¿”å›èœå•æŒ‰é’®äº‹ä»¶
      backToMenuFromCartBtn.addEventListener('click', () => {
        switchToPage('menu');
      });
      
      // ç»‘å®šä»ç©ºè´­ç‰©è½¦è¿”å›èœå•æŒ‰é’®äº‹ä»¶
      goToMenuFromEmptyCartBtn.addEventListener('click', () => {
        switchToPage('menu');
      });
      
      // ç»‘å®šç»“ç®—æŒ‰é’®äº‹ä»¶
      checkoutBtn.addEventListener('click', () => {
        switchToPage('checkout');
      });
      
      // ç»‘å®šè¿”å›è´­ç‰©è½¦æŒ‰é’®äº‹ä»¶
      backToCartBtn.addEventListener('click', () => {
        switchToPage('cart');
      });
      
      // ç»‘å®šæäº¤è®¢å•æŒ‰é’®äº‹ä»¶
      placeOrderBtn.addEventListener('click', handlePlaceOrder);
      
      // ç»‘å®šç»§ç»­ç‚¹é¤æŒ‰é’®äº‹ä»¶
      newOrderBtn.addEventListener('click', () => {
        switchToPage('menu');
        cart = [];
        updateCartUI();
      });
      
      // ç»‘å®šæŸ¥çœ‹è®¢å•æŒ‰é’®äº‹ä»¶
      orderDetailBtn.addEventListener('click', showOrderDetail);
      
      // ç»‘å®šä»è®¢å•è¯¦æƒ…è¿”å›æŒ‰é’®äº‹ä»¶
      backFromOrderDetailBtn.addEventListener('click', () => {
        orderDetailPage.classList.add('hidden');
        // å¦‚æœæ˜¯ä»è®¢å•åˆ—è¡¨æŸ¥çœ‹çš„è¯¦æƒ…ï¼Œåˆ™è¿”å›åˆ°è®¢å•åˆ—è¡¨
        if (document.getElementById('orders-page').classList.contains('hidden') === false) {
          document.getElementById('orders-page').classList.remove('hidden');
        } else {
          // å¦åˆ™è¿”å›åˆ°æˆåŠŸé¡µé¢ï¼ˆä»ç»“ç®—æˆåŠŸé¡µæŸ¥çœ‹çš„è¯¦æƒ…ï¼‰
          successPage.classList.remove('hidden');
        }
      });
      
      // ç»‘å®šè¿”å›é¦–é¡µæŒ‰é’®äº‹ä»¶
      backToHomeBtn.addEventListener('click', () => {
        orderDetailPage.classList.add('hidden');
        document.getElementById('menu-page').classList.remove('hidden');
        cart = [];
        updateCartUI();
      });
      
      // ç»‘å®šæœç´¢è¾“å…¥äº‹ä»¶
      searchInput.addEventListener('input', () => {
        searchTerm = searchInput.value.trim().toLowerCase();
        renderFoodList();
      });
      
      // ç»‘å®šåˆ†ç±»æŒ‰é’®äº‹ä»¶
      categoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          currentCategory = btn.dataset.category;
          updateCategoryButton(btn);
          renderFoodList();
        });
      });
      
      // ç»‘å®šæ•°é‡å¢å‡æŒ‰é’®äº‹ä»¶
      document.addEventListener('click', (e) => {
        if (e.target.closest('.quantity-btn')) {
          const btn = e.target.closest('.quantity-btn');
          const quantityEl = btn.parentElement.querySelector('.quantity');
          const currentValue = parseInt(quantityEl.textContent);
          
          if (btn.querySelector('.fa-minus')) {
            if (currentValue > 1) {
              quantityEl.textContent = currentValue - 1;
            }
          } else {
            quantityEl.textContent = currentValue + 1;
          }
        }
      });
      
      // ç»‘å®šæ·»åŠ åˆ°è´­ç‰©è½¦æŒ‰é’®äº‹ä»¶
      document.addEventListener('click', (e) => {
        if (e.target.closest('.add-to-cart-btn')) {
          const btn = e.target.closest('.add-to-cart-btn');
          const foodId = parseInt(btn.dataset.id);
          addToCart(foodId);
        }
      });
      
      // ç»‘å®šè´­ç‰©è½¦åˆ é™¤æŒ‰é’®äº‹ä»¶
      document.addEventListener('click', (e) => {
        if (e.target.closest('.remove-from-cart-btn')) {
          const btn = e.target.closest('.remove-from-cart-btn');
          const foodId = parseInt(btn.dataset.id);
          removeFromCart(foodId);
        }
      });
      
      // ç»‘å®šè´­ç‰©è½¦æ•°é‡å¢å‡æŒ‰é’®äº‹ä»¶
      document.addEventListener('click', (e) => {
        if (e.target.closest('.cart-quantity-btn')) {
          const btn = e.target.closest('.cart-quantity-btn');
          const foodId = parseInt(btn.dataset.id);
          const isIncrease = btn.querySelector('.fa-plus');
          
          if (isIncrease) {
            increaseQuantity(foodId);
          } else {
            decreaseQuantity(foodId);
          }
        }
      });
      
      // ç»‘å®šè¾£åº¦é€‰æ‹©æŒ‰é’®äº‹ä»¶
      document.addEventListener('click', (e) => {
        if (e.target.closest('.spicy-btn')) {
          const btn = e.target.closest('.spicy-btn');
          const parent = btn.parentElement;
          
          parent.querySelectorAll('.spicy-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          });
          
          btn.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          btn.classList.add('bg-primary', 'text-white');
        }
      });
      
      // ç»‘å®šè§„æ ¼é€‰æ‹©æŒ‰é’®äº‹ä»¶
      document.addEventListener('click', (e) => {
        if (e.target.closest('.spec-btn')) {
          const btn = e.target.closest('.spec-btn');
          const parent = btn.parentElement;
          
          parent.querySelectorAll('.spec-btn').forEach(b => {
            b.classList.remove('bg-primary', 'text-white');
            b.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          });
          
          btn.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-700');
          btn.classList.add('bg-primary', 'text-white');
        }
      });
      
      // ç»‘å®šæ·»åŠ åˆ°è´­ç‰©è½¦(è¯¦æƒ…é¡µ)æŒ‰é’®äº‹ä»¶
      addToCartDetailBtn.addEventListener('click', () => {
        const foodId = parseInt(addToCartDetailBtn.dataset.id);
        const quantity = parseInt(quantityEl.textContent);
        
        // è·å–è§„æ ¼å’Œè¾£åº¦é€‰æ‹©
        const selectedSpec = document.querySelector('.spec-btn.bg-primary')?.textContent || 'å°ä»½';
        const selectedSpicy = document.querySelector('.spicy-btn.bg-primary')?.textContent || 'ä¸è¾£';
        
        // æ·»åŠ åˆ°è´­ç‰©è½¦
        const food = foodData.find(f => f.id === foodId);
        if (food) {
          const cartItem = cart.find(item => item.id === foodId);
          if (cartItem) {
            cartItem.quantity += quantity;
          } else {
            cart.push({
              ...food,
              quantity,
              spec: selectedSpec,
              spicy: selectedSpicy
            });
          }
          
          updateCartUI();
          showToast('å·²æ·»åŠ åˆ°è´­ç‰©è½¦');
        }
      });
      
      // ç»‘å®šé€€å‡ºç™»å½•æŒ‰é’®äº‹ä»¶
      logoutBtn.addEventListener('click', () => {
        showLogoutModal();
      });
      
      // ç»‘å®šè®¢å•è¯¦æƒ…é¡µé€€å‡ºç™»å½•æŒ‰é’®äº‹ä»¶
      logoutBtnDetail.addEventListener('click', () => {
        showLogoutModal();
      });
      
      // ç»‘å®šå–æ¶ˆé€€å‡ºç™»å½•æŒ‰é’®äº‹ä»¶
      cancelLogoutBtn.addEventListener('click', () => {
        logoutModal.classList.add('hidden');
      });
      
      // ç»‘å®šç¡®è®¤é€€å‡ºç™»å½•æŒ‰é’®äº‹ä»¶
      confirmLogoutBtn.addEventListener('click', handleLogout);
      
      // ä¿å­˜åˆ°å¾…ç»“ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('save-pending-btn').addEventListener('click', saveAsPendingOrder);
      
      document.getElementById('pending-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('pending');
      });
      
      document.getElementById('orders-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('orders');
      });
    });
    
    // åˆ‡æ¢é¡µé¢
    function switchToPage(page) {
      // éšè—æ‰€æœ‰é¡µé¢
      document.getElementById('menu-page').classList.add('hidden');
      cartPage.classList.add('hidden');
      foodDetailPage.classList.add('hidden');
      checkoutPage.classList.add('hidden');
      successPage.classList.add('hidden');
      orderDetailPage.classList.add('hidden');
      document.getElementById('coupon-page').classList.add('hidden');
      document.getElementById('pending-page').classList.add('hidden');
      document.getElementById('orders-page').classList.add('hidden');
      
      // æ˜¾ç¤ºç›®æ ‡é¡µé¢
      if (page === 'menu') {
        document.getElementById('menu-page').classList.remove('hidden');
        // æ›´æ–°å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-primary');
        document.getElementById('home-nav').classList.remove('text-gray-500');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      } else if (page === 'cart') {
        cartPage.classList.remove('hidden');
        updateCartUI();
        // æ›´æ–°å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-primary');
        document.getElementById('cart-nav').classList.remove('text-gray-500');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      } else if (page === 'checkout') {
        checkoutPage.classList.remove('hidden');
        updateCheckoutUI();
        // ä¿æŒè´­ç‰©è½¦å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-primary');
        document.getElementById('cart-nav').classList.remove('text-gray-500');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      } else if (page === 'coupon') {
        document.getElementById('coupon-page').classList.remove('hidden');
        // æ›´æ–°å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-primary');
        document.getElementById('coupon-nav').classList.remove('text-gray-500');
        // æ›´æ–°ä¼˜æƒ åˆ¸åˆ—è¡¨
        updateMyCoupons();
      } else if (page === 'pending') {
        document.getElementById('pending-page').classList.remove('hidden');
        // æ›´æ–°å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-primary');
        document.getElementById('pending-nav').classList.remove('text-gray-500');
        document.getElementById('orders-nav').classList.add('text-gray-500');
        document.getElementById('orders-nav').classList.remove('text-primary');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
        // æ›´æ–°å¾…ç»“ç®—è®¢å•
        updatePendingOrders();
      } else if (page === 'orders') {
        document.getElementById('orders-page').classList.remove('hidden');
        // æ›´æ–°å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-primary');
        document.getElementById('orders-nav').classList.remove('text-gray-500');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
        // æ›´æ–°è®¢å•åˆ—è¡¨
        updateOrdersList();
      } else if (page === 'orderDetail') {
        orderDetailPage.classList.remove('hidden');
        showOrderDetail();
        // ä¿æŒè®¢å•å¯¼èˆªæ é«˜äº®
        document.getElementById('home-nav').classList.add('text-gray-500');
        document.getElementById('home-nav').classList.remove('text-primary');
        document.getElementById('cart-nav').classList.add('text-gray-500');
        document.getElementById('cart-nav').classList.remove('text-primary');
        document.getElementById('pending-nav').classList.add('text-gray-500');
        document.getElementById('pending-nav').classList.remove('text-primary');
        document.getElementById('orders-nav').classList.add('text-primary');
        document.getElementById('orders-nav').classList.remove('text-gray-500');
        document.getElementById('coupon-nav').classList.add('text-gray-500');
        document.getElementById('coupon-nav').classList.remove('text-primary');
      }
    }
    
    // å¤„ç†ç™»å½•
    function handleLogin(e) {
      // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º
      e.preventDefault();
      
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      
      // éªŒè¯å§“åå’Œæ‰‹æœºå·ï¼Œä¸ºç‹å†¬å…¬ä¸»ç‰¹æ®Šå¤„ç†
      if (name === 'ç‹å†¬' && phone === '15252775173') {
        // ä¿å­˜ç™»å½•ç”¨æˆ·ä¿¡æ¯
        loggedInUser = { name, phone };
        isLoggedIn = true;
        
        // ç™»å½•æˆåŠŸï¼Œæ˜¾ç¤ºçˆ±å¿ƒç‰¹æ•ˆ
        loginPage.classList.add('hidden');
        showLoveEffect();
      } else if (name && phone) {
        showToast('å§“åæˆ–æ‰‹æœºå·é”™è¯¯');
      } else {
        showToast('å§“åæˆ–æ‰‹æœºå·ä¸èƒ½ä¸ºç©º');
      }
    }
    
    // æ˜¾ç¤ºçˆ±å¿ƒç‰¹æ•ˆ
    function showLoveEffect() {
      loginEffect.classList.remove('hidden');
      loveMessage.textContent = loggedInUser && loggedInUser.name === 'ç‹å†¬' 
        ? 'ä¸ºç‹å†¬å…¬ä¸»æœåŠ¡' 
        : 'ç™»å½•æˆåŠŸ';
      
      // ç”Ÿæˆå¤šä¸ªçˆ±å¿ƒ
      for (let i = 0; i < 50; i++) {
        createLoveHeart();
      }
      
      // 3ç§’åéšè—ç‰¹æ•ˆå¹¶æ˜¾ç¤ºä¸»åº”ç”¨
      setTimeout(() => {
        loginEffect.classList.add('hidden');
        loginSuccessModal.classList.remove('hidden');
      }, 3000);
    }
    
    // åˆ›å»ºå•ä¸ªçˆ±å¿ƒ
    function createLoveHeart() {
      const heart = document.createElement('div');
      heart.className = 'love-heart';
      
      // éšæœºä½ç½®å’Œå¤§å°
      const size = Math.random() * 15 + 10; // 10-25px
      const left = Math.random() * 100; // 0-100%
      const duration = Math.random() * 3 + 2; // 2-5ç§’
      
      heart.style.width = `${size}px`;
      heart.style.height = `${size}px`;
      heart.style.left = `${left}%`;
      heart.style.animationDuration = `${duration}s`;
      
      loginEffect.appendChild(heart);
      
      // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
      setTimeout(() => {
        heart.remove();
      }, duration * 1000);
    }
    
    // æ˜¾ç¤ºé€€å‡ºç™»å½•æ¨¡æ€æ¡†
    function showLogoutModal() {
      logoutModal.classList.remove('hidden');
    }
    
    // å¤„ç†é€€å‡ºç™»å½•
    function handleLogout() {
      // éšè—æ¨¡æ€æ¡†
      logoutModal.classList.add('hidden');
      
      // é‡ç½®ç™»å½•çŠ¶æ€
      isLoggedIn = false;
      loggedInUser = null;
      
      // æ¸…ç©ºè´­ç‰©è½¦
      cart = [];
      currentOrder = null;
      
      // æ˜¾ç¤ºç™»å½•é¡µ
      mainApp.classList.add('hidden');
      loginPage.classList.remove('hidden');
      
      // æ¸…ç©ºè´­ç‰©è½¦å’Œè®¢å•UI
      updateCartUI();
      
      showToast('å·²é€€å‡ºç™»å½•');
    }
    
    // æ›´æ–°åˆ†ç±»æŒ‰é’®æ ·å¼
    function updateCategoryButton(activeBtn) {
      categoryBtns.forEach(btn => {
        btn.classList.remove('bg-primary', 'text-white');
        btn.classList.add('bg-white', 'text-gray-700', 'shadow-sm');
      });
      activeBtn.classList.remove('bg-white', 'text-gray-700', 'shadow-sm');
      activeBtn.classList.add('bg-primary', 'text-white');
    }
    
    // æ¸²æŸ“èœå“åˆ—è¡¨
    function renderFoodList() {
      // æ ¹æ®å½“å‰åˆ†ç±»å’Œæœç´¢è¯è¿‡æ»¤èœå“
      let filteredFoods = foodData;
      
      if (currentCategory !== 'all') {
        filteredFoods = filteredFoods.filter(food => food.category === currentCategory);
      }
      
      if (searchTerm) {
        filteredFoods = filteredFoods.filter(food => 
          food.name.toLowerCase().includes(searchTerm) || 
          food.description.toLowerCase().includes(searchTerm) ||
          (food.tags && food.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
        );
      }
      
      // æ¸…ç©ºèœå“åˆ—è¡¨
      foodList.innerHTML = '';
      
      // å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„èœå“
      if (filteredFoods.length === 0) {
        foodList.innerHTML = `
          <div class="col-span-2 text-center py-12">
            <i class="fa fa-search text-4xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„èœå“</p>
          </div>
        `;
        return;
      }
      
      // æ¸²æŸ“èœå“
      filteredFoods.forEach(food => {
        const card = document.createElement('div');
        card.className = 'food-card bg-white rounded-xl overflow-hidden shadow-sm';
        card.innerHTML = `
          <div class="h-36 overflow-hidden">
            <img src="${food.image}" alt="${food.name}" class="w-full h-full object-cover">
          </div>
          <div class="p-3">
            <h3 class="font-semibold text-lg mb-1">${food.name}</h3>
            <div class="flex justify-between items-center">
              <span class="text-primary font-bold">Â¥${food.price}</span>
              <button class="add-to-cart-btn bg-primary/10 hover:bg-primary/20 text-primary p-2 rounded-full transition-colors" data-id="${food.id}">
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
        `;
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ˜¾ç¤ºèœå“è¯¦æƒ…
        card.addEventListener('click', () => {
          showFoodDetail(food);
        });
        
        foodList.appendChild(card);
      });
    }
    
    // æ˜¾ç¤ºèœå“è¯¦æƒ…
    function showFoodDetail(food) {
      detailName.textContent = food.name;
      detailPrice.textContent = `Â¥${food.price}`;
      detailDesc.textContent = food.description;
      detailImage.src = food.image;
      detailImage.alt = food.name;
      
      // é‡ç½®æ•°é‡
      quantityEl.textContent = '1';
      
      // è®¾ç½®å½“å‰èœå“IDåˆ°æŒ‰é’®ä¸Š
      addToCartDetailBtn.dataset.id = food.id;
      
      // æ˜¾ç¤ºè¯¦æƒ…é¡µ
      document.getElementById('menu-page').classList.add('hidden');
      foodDetailPage.classList.remove('hidden');
    }
    
    // æ·»åŠ åˆ°è´­ç‰©è½¦
    function addToCart(foodId) {
      const food = foodData.find(f => f.id === foodId);
      if (!food) return;
      
      // è·å–è§„æ ¼å’Œè¾£åº¦é€‰æ‹©ï¼ˆé»˜è®¤ä¸ºå°ä»½å’Œä¸è¾£ï¼‰
      const selectedSpec = document.querySelector('.spec-btn.bg-primary')?.textContent || 'å°ä»½';
      const selectedSpicy = document.querySelector('.spicy-btn.bg-primary')?.textContent || 'ä¸è¾£';
      
      // æ£€æŸ¥è´­ç‰©è½¦ä¸­æ˜¯å¦å·²å­˜åœ¨è¯¥èœå“
      const cartItem = cart.find(item => item.id === foodId);
      if (cartItem) {
        cartItem.quantity += 1;
      } else {
        cart.push({
          ...food,
          quantity: 1,
          spec: selectedSpec,
          spicy: selectedSpicy
        });
      }
      
      updateCartUI();
      showToast('å·²æ·»åŠ åˆ°è´­ç‰©è½¦');
    }
    
    // ä»è´­ç‰©è½¦åˆ é™¤
    function removeFromCart(foodId) {
      cart = cart.filter(item => item.id !== foodId);
      updateCartUI();
    }
    
    // å¢åŠ æ•°é‡
    function increaseQuantity(foodId) {
      const cartItem = cart.find(item => item.id === foodId);
      if (cartItem) {
        cartItem.quantity += 1;
        updateCartUI();
      }
    }
    
    // å‡å°‘æ•°é‡
    function decreaseQuantity(foodId) {
      const cartItem = cart.find(item => item.id === foodId);
      if (cartItem && cartItem.quantity > 1) {
        cartItem.quantity -= 1;
        updateCartUI();
      }
    }
    
    // æ›´æ–°è´­ç‰©è½¦UI
    function updateCartUI() {
      // æ›´æ–°è´­ç‰©è½¦æ•°é‡æ˜¾ç¤º
      const cartCount = cart.reduce((total, item) => total + item.quantity, 0);
      document.getElementById('cart-count').textContent = cartCount;
      
      if (cart.length === 0) {
        // è´­ç‰©è½¦ä¸ºç©º
        cartItems.classList.add('hidden');
        cartSummary.classList.add('hidden');
        emptyCart.classList.remove('hidden');
      } else {
        // è´­ç‰©è½¦æœ‰å•†å“
        emptyCart.classList.add('hidden');
        cartItems.classList.remove('hidden');
        cartSummary.classList.remove('hidden');
        
        // æ¸…ç©ºè´­ç‰©è½¦é¡¹ç›®
        cartItems.innerHTML = '';
        
        // æ·»åŠ è´­ç‰©è½¦é¡¹ç›®
        cart.forEach(item => {
          const itemElement = document.createElement('div');
          itemElement.className = 'bg-white rounded-xl shadow-sm overflow-hidden';
          itemElement.innerHTML = `
            <div class="flex">
              <div class="w-24 h-24">
                <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover">
              </div>
              <div class="flex-1 p-4">
                <div class="flex justify-between items-start mb-2">
                  <h3 class="font-semibold">${item.name}</h3>
                  <button class="remove-from-cart-btn text-gray-400 hover:text-red-500" data-id="${item.id}">
                    <i class="fa fa-trash"></i>
                  </button>
                </div>
                <p class="text-sm text-gray-500 mb-3">è§„æ ¼: ${item.spec} | è¾£åº¦: ${item.spicy}</p>
                <div class="flex justify-between items-center">
                  <span class="text-primary font-bold">Â¥${item.price}</span>
                  <div class="flex items-center border rounded-lg overflow-hidden">
                    <button class="cart-quantity-btn bg-gray-100 hover:bg-gray-200 p-1.5 transition-colors" data-id="${item.id}">
                      <i class="fa fa-minus text-xs"></i>
                    </button>
                    <span class="w-8 text-center text-sm font-medium">${item.quantity}</span>
                    <button class="cart-quantity-btn bg-gray-100 hover:bg-gray-200 p-1.5 transition-colors" data-id="${item.id}">
                      <i class="fa fa-plus text-xs"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          cartItems.appendChild(itemElement);
        });
        
        // æ›´æ–°å°è®¡å’Œæ€»è®¡
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        subtotalEl.textContent = `Â¥${subtotal}`;
        totalEl.textContent = `Â¥${subtotal}`;
      }
    }
    
    // æ›´æ–°ç»“ç®—UI
    function updateCheckoutUI() {
      // æ¸…ç©ºç»“ç®—é¡¹ç›®
      checkoutItems.innerHTML = '';
      
      // æ·»åŠ ç»“ç®—é¡¹ç›®
      cart.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'flex p-3 border-b border-gray-100';
        itemElement.innerHTML = `
          <div class="w-16 h-16 mr-3">
            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded-lg">
          </div>
          <div class="flex-1">
            <h3 class="font-medium">${item.name}</h3>
            <p class="text-sm text-gray-500 mb-1">è§„æ ¼: ${item.spec} | è¾£åº¦: ${item.spicy}</p>
            <div class="flex justify-between items-center">
              <span class="text-sm">x ${item.quantity}</span>
              <span class="text-primary font-bold">Â¥${(item.price * item.quantity).toFixed(2)}</span>
            </div>
          </div>
        `;
        
        checkoutItems.appendChild(itemElement);
      });
      
      // å…ˆç§»é™¤å·²å­˜åœ¨çš„ä¼˜æƒ åˆ¸åŒºåŸŸ
      const existingCouponSection = document.getElementById('checkout-coupon-section');
      if (existingCouponSection) {
        existingCouponSection.remove();
      }
      
      // åˆ›å»ºæ–°çš„ä¼˜æƒ åˆ¸åŒºåŸŸ
      const couponSection = document.createElement('div');
      couponSection.id = 'checkout-coupon-section';
      couponSection.className = 'bg-white rounded-xl overflow-hidden shadow-sm mb-6 mt-4';
      
      // æ˜¾ç¤ºå¯ç”¨ä¼˜æƒ åˆ¸
      const couponContainer = document.createElement('div');
      couponContainer.className = 'mt-4 p-3 border-t border-gray-100';
      couponContainer.innerHTML = '<h3 class="font-semibold mb-2">é€‰æ‹©ä¼˜æƒ åˆ¸</h3>';
      
      const availableCoupons = getUnusedCoupons();
      if (availableCoupons.length > 0) {
        const couponSelector = document.createElement('div');
        couponSelector.className = 'space-y-2';
        
        // æ·»åŠ å¯ç”¨ä¼˜æƒ åˆ¸
        availableCoupons.forEach(coupon => {
          const couponElement = document.createElement('div');
          couponElement.className = `coupon-card ${selectedCoupon?.id === coupon.id ? 'selected' : ''}`;
          couponElement.setAttribute('data-id', coupon.id);
          couponElement.onclick = () => selectCoupon(coupon.id);
          couponElement.style.cursor = 'pointer';
          couponElement.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <div class="coupon-discount">${coupon.discount * 10}æŠ˜ä¼˜æƒ åˆ¸</div>
                <div class="text-xs text-gray-500">${coupon.condition || 'ç‰¹æ®Šæ´»åŠ¨'}</div>
              </div>
            </div>
          `;
          couponSelector.appendChild(couponElement);
        });
        
        couponContainer.appendChild(couponSelector);
      } else {
        couponContainer.innerHTML += '<p class="text-gray-500 text-sm">æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸</p>';
      }
      
      // æ·»åŠ åˆ°ä¼˜æƒ åˆ¸åŒºåŸŸ
      couponSection.appendChild(couponContainer);
      
      // æ·»åŠ åˆ°ç»“ç®—é¡µé¢
      const summarySection = document.querySelector('#checkout-page .bg-white.rounded-xl.p-5.shadow-sm');
      checkoutPage.insertBefore(couponSection, summarySection);
      
      // æ›´æ–°å°è®¡å’Œæ€»è®¡
      updateCheckoutPrices();
    }
    
    // è·å–æœªä½¿ç”¨çš„ä¼˜æƒ åˆ¸
    function getUnusedCoupons() {
      return availableCoupons.filter(coupon => !coupon.used);
    }
    
    // æ¸…é™¤é€‰ä¸­çš„ä¼˜æƒ åˆ¸
    function clearSelectedCoupon() {
      selectedCoupon = null;
      
      // ç§»é™¤æ‰€æœ‰ä¼˜æƒ åˆ¸çš„é€‰ä¸­æ ·å¼
      document.querySelectorAll('.coupon-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
      updateCheckoutPrices();
      updateTotalPrice();
      
      // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
      showToast('å·²å–æ¶ˆä½¿ç”¨ä¼˜æƒ åˆ¸');
    }
    
    // æ›´æ–°ç»“ç®—é¡µé¢çš„ä»·æ ¼æ˜¾ç¤º
    function updateCheckoutPrices() {
      const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      checkoutSubtotalEl.textContent = `Â¥${subtotal.toFixed(2)}`;
      
      // åº”ç”¨ä¼˜æƒ åˆ¸
      if (selectedCoupon) {
        const discount = subtotal * (1 - selectedCoupon.discount);
        const discountedTotal = subtotal - discount;
        
        // æ˜¾ç¤ºæŠ˜æ‰£ä¿¡æ¯
        document.querySelector('#checkout-page .space-y-3').innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">å•†å“å°è®¡</span>
            <span>Â¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">é…é€è´¹</span>
            <span>Â¥0</span>
          </div>
          <div class="flex justify-between text-green-500 font-medium">
            <span>ä¼˜æƒ  (${selectedCoupon.discount * 10}æŠ˜)</span>
            <span>-Â¥${discount.toFixed(2)}</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100">
            <span class="font-semibold">å®ä»˜æ¬¾</span>
            <span id="checkout-total" class="font-semibold text-primary text-xl">Â¥${discountedTotal.toFixed(2)}</span>
          </div>
        `;
      } else {
        document.querySelector('#checkout-page .space-y-3').innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">å•†å“å°è®¡</span>
            <span>Â¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">é…é€è´¹</span>
            <span>Â¥0</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ä¼˜æƒ </span>
            <span class="text-green-500">-Â¥0</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100">
            <span class="font-semibold">å®ä»˜æ¬¾</span>
            <span id="checkout-total" class="font-semibold text-primary text-xl">Â¥${subtotal.toFixed(2)}</span>
          </div>
        `;
      }
    }
    
    // å¤„ç†æäº¤è®¢å•
    function handlePlaceOrder() {
      if (cart.length === 0) {
        showToast('è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•æäº¤è®¢å•');
        return;
      }
      
      // è®¡ç®—è®¢å•æ€»é¢ï¼ˆè€ƒè™‘ä¼˜æƒ åˆ¸ï¼‰
      let subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      let total = subtotal;
      let discount = 0;
      
      if (selectedCoupon) {
        discount = subtotal * (1 - selectedCoupon.discount);
        total = subtotal - discount;
      }
      
      // æ›´æ–°è®¢å•é‡‘é¢
      orderAmountSpan.textContent = `Â¥${total.toFixed(2)}`;
      
      // ä¿å­˜å½“å‰è®¢å•æ•°æ®ç”¨äºè®¢å•è¯¦æƒ…é¡µ
      currentOrder = {
        id: generateOrderNumber(),
        time: new Date().toISOString().slice(0, 16).replace('T', ' '),
        amount: total,
        subtotal: subtotal,
        discount: discount,
        payment: document.querySelector('input[name="payment"]:checked').nextElementSibling.textContent.trim(),
        recipient: detailRecipient.textContent,
        phone: detailPhone.textContent,
        address: detailAddress.textContent,
        items: [...cart],
        usedCoupon: selectedCoupon ? { ...selectedCoupon } : null
      };
      
      // å¦‚æœä½¿ç”¨äº†ä¼˜æƒ åˆ¸ï¼Œæ ‡è®°ä¸ºå·²ä½¿ç”¨
      if (selectedCoupon) {
        const couponIndex = availableCoupons.findIndex(c => c.id === selectedCoupon.id);
        if (couponIndex !== -1) {
          availableCoupons[couponIndex].used = true;
          saveAvailableCoupons();
        }
      }
      
      // æ˜¾ç¤ºç»“ç®—æˆåŠŸé¡µ
      checkoutPage.classList.add('hidden');
      successPage.classList.remove('hidden');
      
      // æ›´æ–°æˆåŠŸé¡µé¢ä¼˜æƒ ä¿¡æ¯
      updateSuccessPageInfo();
      
      // æ¸…ç†å·²ç»ä½¿ç”¨çš„ä¼˜æƒ åˆ¸
      cleanupUsedCoupons();
    }
    
    // æ›´æ–°æˆåŠŸé¡µé¢ä¿¡æ¯
    function updateSuccessPageInfo() {
      if (!currentOrder) return;
      
      // æ›´æ–°è®¢å•å·å’Œæ—¶é—´
      document.getElementById('order-number').textContent = currentOrder.id;
      document.getElementById('order-time').textContent = currentOrder.time;
      
      // æ›´æ–°è®¢å•é‡‘é¢å’Œä¼˜æƒ ä¿¡æ¯
      const orderInfoEl = document.querySelector('#success-page .bg-gray-50');
      
      if (currentOrder.usedCoupon) {
        orderInfoEl.innerHTML = `
          <h3 class="font-medium mb-2">è®¢å•è¯¦æƒ…</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">è®¢å•ç¼–å·</span>
              <span id="order-number">${currentOrder.id}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">ä¸‹å•æ—¶é—´</span>
              <span id="order-time">${currentOrder.time}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">å•†å“å°è®¡</span>
              <span>Â¥${currentOrder.subtotal.toFixed(2)}</span>
            </div>
            <div class="flex justify-between text-green-500">
              <span>ä¼˜æƒ  (${currentOrder.usedCoupon.discount * 10}æŠ˜)</span>
              <span>-Â¥${currentOrder.discount.toFixed(2)}</span>
            </div>
            <div class="flex justify-between font-medium">
              <span class="text-gray-600">å®ä»˜æ¬¾</span>
              <span id="order-amount" class="text-primary">Â¥${currentOrder.amount.toFixed(2)}</span>
            </div>
          </div>
        `;
      } else {
        orderInfoEl.innerHTML = `
          <h3 class="font-medium mb-2">è®¢å•è¯¦æƒ…</h3>
          <div class="space-y-2 text-sm">
            <div class="flex justify-between">
              <span class="text-gray-600">è®¢å•ç¼–å·</span>
              <span id="order-number">${currentOrder.id}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">ä¸‹å•æ—¶é—´</span>
              <span id="order-time">${currentOrder.time}</span>
            </div>
            <div class="flex justify-between font-medium">
              <span class="text-gray-600">å®ä»˜æ¬¾</span>
              <span id="order-amount" class="text-primary">Â¥${currentOrder.amount.toFixed(2)}</span>
            </div>
          </div>
        `;
      }
    }
    
    // ç”Ÿæˆè®¢å•å·
    function generateOrderNumber() {
      const date = new Date();
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
      return `ORD-${year}${month}${day}-${random}`;
    }
    
    // æ¸…ç†å·²ä½¿ç”¨çš„ä¼˜æƒ åˆ¸
    function cleanupUsedCoupons() {
      // ç§»é™¤å·²ä½¿ç”¨çš„ä¼˜æƒ åˆ¸
      availableCoupons = availableCoupons.filter(coupon => !coupon.used);
      saveAvailableCoupons();
      selectedCoupon = null;
    }
    
    // æ˜¾ç¤ºè®¢å•è¯¦æƒ…
    function showOrderDetail() {
      if (!currentOrder) return;
      
      // å¡«å……è®¢å•è¯¦æƒ…é¡µæ•°æ®
      detailOrderNumber.textContent = currentOrder.id;
      detailOrderTime.textContent = currentOrder.time;
      detailPaymentMethod.textContent = currentOrder.payment;
      detailRecipient.textContent = currentOrder.recipient;
      detailPhone.textContent = currentOrder.phone;
      detailAddress.textContent = currentOrder.address;
      
      // è®¡ç®—å°è®¡é‡‘é¢ï¼ˆæœªæŠ˜æ‰£çš„é‡‘é¢ï¼‰
      const subtotal = currentOrder.items.reduce((total, item) => total + (item.price * item.quantity), 0);
      detailSubtotal.textContent = `Â¥${subtotal.toFixed(2)}`;
      
      // æ˜¾ç¤ºä¼˜æƒ ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ä½¿ç”¨ä¼˜æƒ åˆ¸ï¼‰
      const orderSummaryEl = document.querySelector('#order-detail-page .p-5:last-child .space-y-2');
      
      if (currentOrder.usedCoupon) {
        const discount = subtotal * (1 - currentOrder.usedCoupon.discount);
        
        orderSummaryEl.innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">å•†å“å°è®¡</span>
            <span id="detail-subtotal">Â¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">é…é€è´¹</span>
            <span>Â¥0</span>
          </div>
          <div class="flex justify-between text-green-500 font-medium">
            <span>ä¼˜æƒ  (${currentOrder.usedCoupon.discount * 10}æŠ˜)</span>
            <span>-Â¥${discount.toFixed(2)}</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100 text-base">
            <span class="font-semibold">å®ä»˜æ¬¾</span>
            <span id="detail-total" class="font-semibold text-primary">Â¥${currentOrder.amount.toFixed(2)}</span>
          </div>
        `;
      } else {
        orderSummaryEl.innerHTML = `
          <div class="flex justify-between">
            <span class="text-gray-600">å•†å“å°è®¡</span>
            <span id="detail-subtotal">Â¥${subtotal.toFixed(2)}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">é…é€è´¹</span>
            <span>Â¥0</span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">ä¼˜æƒ </span>
            <span class="text-green-500">-Â¥0</span>
          </div>
          <div class="flex justify-between pt-3 border-t border-gray-100 text-base">
            <span class="font-semibold">å®ä»˜æ¬¾</span>
            <span id="detail-total" class="font-semibold text-primary">Â¥${currentOrder.amount.toFixed(2)}</span>
          </div>
        `;
      }
      
      // å¡«å……è®¢å•å•†å“
      orderItemsEl.innerHTML = '';
      currentOrder.items.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'flex p-3 border-b border-gray-100';
        itemElement.innerHTML = `
          <div class="w-16 h-16 mr-3">
            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover rounded-lg">
          </div>
          <div class="flex-1">
            <h3 class="font-medium">${item.name}</h3>
            <p class="text-sm text-gray-500 mb-1">è§„æ ¼: ${item.spec} | è¾£åº¦: ${item.spicy}</p>
            <div class="flex justify-between items-center">
              <span class="text-sm">x ${item.quantity}</span>
              <span class="text-primary font-bold">Â¥${(item.price * item.quantity).toFixed(2)}</span>
            </div>
          </div>
        `;
        
        orderItemsEl.appendChild(itemElement);
      });
      
      // æ˜¾ç¤ºè®¢å•è¯¦æƒ…é¡µ
      successPage.classList.add('hidden');
      orderDetailPage.classList.remove('hidden');
    }
    
    // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
    function showToast(message) {
      toastMessage.textContent = message;
      toast.classList.remove('hidden');
      
      // 3ç§’åéšè—æç¤º
      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }

    function createFloatingHearts() {
        const container = document.querySelector('.floating-hearts');
        for (let i = 0; i < 20; i++) {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = 'â¤';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.top = Math.random() * 100 + '%';
            heart.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(heart);
        }
    }

    function showLoginSuccess() {
        const loginSuccess = document.createElement('div');
        loginSuccess.className = 'login-success';
        loginSuccess.innerHTML = `
            <div class="heart-container">
                <div class="heart">â¤</div>
            </div>
            <div class="floating-hearts"></div>
            <div class="login-success-text">ç™»å½•æˆåŠŸ</div>
            <div class="login-success-subtext">æ­£åœ¨è·³è½¬åˆ°é¦–é¡µ...</div>
        `;
        document.body.appendChild(loginSuccess);
        createFloatingHearts();
    }

    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // å‘é€ç™»å½•è¯·æ±‚
        fetch('/api/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(response => {
            if (response.code === 200) {
                showLoginSuccess();
                // 3ç§’åè·³è½¬
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            } else {
                alert('ç™»å½•å¤±è´¥ï¼š' + response.message);
            }
        })
        .catch(error => {
            console.error('ç™»å½•é”™è¯¯:', error);
            alert('ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        });
    }

    // ä¼˜æƒ åˆ¸ç›¸å…³å˜é‡
    let availableCoupons = [];
    let selectedCoupon = null;
    let massageTimer = null;
    let massageStartTime = null;
    let massageDuration = 0;

    // æ˜¾ç¤ºä¼˜æƒ åˆ¸æ¨¡æ€æ¡†
    function showCouponModal() {
      document.getElementById('couponModal').classList.remove('hidden');
    }

    // å…³é—­ä¼˜æƒ åˆ¸æ¨¡æ€æ¡†
    function closeCouponModal() {
      document.getElementById('couponModal').classList.add('hidden');
    }

    // è·å–ä¼˜æƒ åˆ¸
    function getCoupon(discount, duration) {
      massageDuration = duration;
      document.getElementById('massageDuration').textContent = duration;
      document.getElementById('couponModal').classList.add('hidden');
      document.getElementById('massageTimerModal').classList.remove('hidden');
      document.getElementById('startMassageBtn').classList.remove('hidden');
      document.getElementById('stopMassageBtn').classList.add('hidden');
      document.getElementById('massageTimer').textContent = '00:00';
    }

    // å¼€å§‹æŒ‰æ‘©è®¡æ—¶
    function startMassage() {
      massageStartTime = Date.now();
      document.getElementById('startMassageBtn').classList.add('hidden');
      document.getElementById('stopMassageBtn').classList.remove('hidden');
      
      massageTimer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - massageStartTime) / 1000);
        const minutes = Math.floor(elapsed / 60);
        const seconds = elapsed % 60;
        document.getElementById('massageTimer').textContent = 
          `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        if (minutes >= massageDuration) {
          completeMassage();
        }
      }, 1000);
    }

    // åœæ­¢æŒ‰æ‘©
    function stopMassage() {
      clearInterval(massageTimer);
      document.getElementById('massageTimerModal').classList.add('hidden');
    }

    // å®ŒæˆæŒ‰æ‘©
    function completeMassage() {
      clearInterval(massageTimer);
      document.getElementById('massageTimerModal').classList.add('hidden');
      
      // æ·»åŠ ä¼˜æƒ åˆ¸
      const discount = parseFloat(document.querySelector(`[data-duration="${massageDuration}"]`).dataset.discount);
      const coupon = {
        id: Date.now(),
        discount: discount,
        used: false,
        condition: `æŒ‰æ‘©${massageDuration}åˆ†é’Ÿè·å¾—`,
        expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30å¤©æœ‰æ•ˆæœŸ
      };
      availableCoupons.push(coupon);
      
      // ä¿å­˜åˆ°localStorage
      saveAvailableCoupons();
      
      updateMyCoupons();
      
      // æ˜¾ç¤ºæˆåŠŸæç¤º
      showToast(`æ­å–œè·å¾—${discount * 10}æŠ˜ä¼˜æƒ åˆ¸ï¼`);
    }

    // ä¿å­˜ä¼˜æƒ åˆ¸åˆ°localStorage
    function saveAvailableCoupons() {
      localStorage.setItem('coupons', JSON.stringify(availableCoupons));
    }

    // é€‰æ‹©ä¼˜æƒ åˆ¸
    function selectCoupon(couponId) {
      // å¦‚æœç‚¹å‡»çš„æ˜¯å·²é€‰ä¸­çš„ä¼˜æƒ åˆ¸ï¼Œåˆ™å–æ¶ˆé€‰æ‹©
      if (selectedCoupon && selectedCoupon.id === couponId) {
        clearSelectedCoupon();
        return;
      }
      
      selectedCoupon = availableCoupons.find(c => c.id === couponId);
      
      // æ›´æ–°ä¼˜æƒ åˆ¸é€‰ä¸­æ ·å¼
      if (document.querySelector('.coupon-card.selected')) {
        document.querySelectorAll('.coupon-card').forEach(card => {
          card.classList.remove('selected');
        });
      }
      
      // æ‰¾åˆ°å½“å‰é€‰ä¸­çš„ä¼˜æƒ åˆ¸å…ƒç´ å¹¶æ·»åŠ é€‰ä¸­æ ·å¼
      const selectedElement = document.querySelector(`.coupon-card[data-id="${couponId}"]`);
      if (selectedElement) {
        selectedElement.classList.add('selected');
      }
      
      // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
      updateCheckoutPrices();
      updateTotalPrice();
      
      // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
      showToast(`å·²é€‰æ‹©${selectedCoupon.discount * 10}æŠ˜ä¼˜æƒ åˆ¸`);
    }

    // ä¿®æ”¹è®¡ç®—æ€»ä»·çš„å‡½æ•°
    function updateTotalPrice() {
      let total = 0;
      cart.forEach(item => {
        total += item.price * item.quantity;
      });
      
      // åº”ç”¨ä¼˜æƒ åˆ¸æŠ˜æ‰£
      if (selectedCoupon) {
        total = total * selectedCoupon.discount;
      }
      
      document.getElementById('totalPrice').textContent = total.toFixed(2);
    }

    // ä¿®æ”¹æäº¤è®¢å•å‡½æ•°
    function submitOrder() {
      if (cart.length === 0) {
        showToast('è¯·å…ˆæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼');
        return;
      }
      
      // ä½¿ç”¨ä¼˜æƒ åˆ¸
      if (selectedCoupon) {
        selectedCoupon.used = true;
        saveAvailableCoupons();
        selectedCoupon = null;
        updateMyCoupons();
      }
      
      // åŸæœ‰çš„æäº¤è®¢å•é€»è¾‘
      handlePlaceOrder();
    }

    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
    document.getElementById('startMassageBtn').addEventListener('click', startMassage);
    document.getElementById('stopMassageBtn').addEventListener('click', stopMassage);

    // ä¿®æ”¹æ˜¾ç¤ºç»“ç®—é¡µé¢çš„å‡½æ•°
    function showCheckout() {
      document.getElementById('checkoutPage').classList.remove('hidden');
      updateCheckoutItems();
      updateCheckoutCoupons();
      updateCheckoutPrices();
    }

    // æ›´æ–°ç»“ç®—é¡µé¢çš„ä¼˜æƒ åˆ¸åˆ—è¡¨
    function updateCheckoutCoupons() {
      const checkoutCoupons = document.getElementById('checkoutCoupons');
      const usableCoupons = availableCoupons.filter(coupon => !coupon.used);
      
      if (usableCoupons.length === 0) {
        checkoutCoupons.innerHTML = '<div class="text-gray-500 text-sm">æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸</div>';
        return;
      }

      checkoutCoupons.innerHTML = usableCoupons.map(coupon => `
        <div class="coupon-card ${selectedCoupon?.id === coupon.id ? 'selected' : ''}" 
             onclick="selectCoupon(${coupon.id})" style="cursor: pointer">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">${coupon.discount * 10}æŠ˜ä¼˜æƒ åˆ¸</div>
              <div class="text-xs text-gray-500">${coupon.condition || 'ç‰¹æ®Šæ´»åŠ¨'}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // ä¿®æ”¹å…³é—­ç»“ç®—é¡µé¢çš„å‡½æ•°
    function closeCheckout() {
      document.getElementById('checkoutPage').classList.add('hidden');
    }

    // è·å–çˆ¸çˆ¸ä¼˜æƒ åˆ¸
    function getDaddyCoupon() {
      document.getElementById('couponModal').classList.add('hidden');
      document.getElementById('daddyModal').classList.remove('hidden');
      
      // é‡ç½®æ¨¡æ€æ¡†çŠ¶æ€
      document.getElementById('daddyModalText').textContent = 'è¯·å¯¹ç€éº¦å…‹é£å«ä¸€å£°"çˆ¸çˆ¸"';
      document.getElementById('daddy-voice-result').classList.add('hidden');
      document.getElementById('daddy-voice-result').textContent = '';
      document.getElementById('startRecordingBtn').classList.remove('hidden');
      document.getElementById('recording-controls').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.remove('recording');
    }

    // å¤„ç†"çˆ¸çˆ¸"ä¼˜æƒ åˆ¸è·å–æˆåŠŸ
    function processDaddyCoupon(isDaddy) {
      // éšè—å½•éŸ³åŠ¨ç”»
      document.getElementById('voice-animation-daddy').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.remove('recording');
      
      // é‡ç½®å½•éŸ³æŒ‰é’®çŠ¶æ€ï¼Œç¡®ä¿ä¸‹æ¬¡å¯ä»¥æ­£å¸¸ä½¿ç”¨
      document.getElementById('recording-controls').classList.add('hidden');
      document.getElementById('startRecordingBtn').classList.remove('hidden');
      
      if (isDaddy) {
        document.getElementById('daddyModal').classList.add('hidden');
        
        const coupon = {
          id: Date.now(),
          discount: 0.9,
          used: false,
          condition: "å«ä¸€å£°çˆ¸çˆ¸è·å¾—",
          expiryDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000) // 30å¤©æœ‰æ•ˆæœŸ
        };
        availableCoupons.push(coupon);
        
        // ä¿å­˜åˆ°localStorage
        saveAvailableCoupons();
        
        updateMyCoupons();
        
        showToast('æ­å–œè·å¾—9æŠ˜ä¼˜æƒ åˆ¸ï¼');
      } else {
        // éšè—çˆ¸çˆ¸æ¨¡æ€æ¡†
        document.getElementById('daddyModal').classList.add('hidden');
        
        // æ˜¾ç¤ºæ•²å¤´è¡¨æƒ…åŠ¨ç”»
        document.getElementById('knockHeadAnimation').classList.remove('hidden');
      }
    }

    function closeDaddyModal() {
      document.getElementById('daddyModal').classList.add('hidden');
      
      // åœæ­¢è¯­éŸ³è¯†åˆ«ï¼ˆå¦‚æœæ­£åœ¨è¿›è¡Œï¼‰
      stopDaddyVoiceRecognition();
      
      // é‡ç½®å½•éŸ³æŒ‰é’®çŠ¶æ€ï¼Œç¡®ä¿ä¸‹æ¬¡å¯ä»¥æ­£å¸¸ä½¿ç”¨
      document.getElementById('recording-controls').classList.add('hidden');
      document.getElementById('startRecordingBtn').classList.remove('hidden');
      document.getElementById('voice-animation-daddy').classList.add('hidden');
      document.getElementById('voice-animation-daddy').classList.remove('recording');
    }

    // å…³é—­æ•²å¤´è¡¨æƒ…åŠ¨ç”»
    function closeKnockHeadAnimation() {
      document.getElementById('knockHeadAnimation').classList.add('hidden');
    }

    // åˆå§‹åŒ–åŠ è½½ä¼˜æƒ åˆ¸
    function loadAvailableCoupons() {
      try {
        const savedCoupons = localStorage.getItem('coupons');
        if (savedCoupons) {
          availableCoupons = JSON.parse(savedCoupons);
          
          // å¤„ç†æ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºDateå¯¹è±¡
          availableCoupons.forEach(coupon => {
            if (typeof coupon.expiryDate === 'string') {
              coupon.expiryDate = new Date(coupon.expiryDate);
            }
          });
        }
      } catch (error) {
        console.error('åŠ è½½ä¼˜æƒ åˆ¸å¤±è´¥:', error);
        availableCoupons = [];
      }
    }

    // ä½¿ç”¨ä¼˜æƒ åˆ¸
    function useCoupon(id) {
      const coupon = availableCoupons.find(c => c.id === id);
      if (!coupon) return;
      
      // å¦‚æœç‚¹å‡»çš„æ˜¯å·²é€‰ä¸­çš„ä¼˜æƒ åˆ¸ï¼Œåˆ™å–æ¶ˆé€‰æ‹©
      if (selectedCoupon && selectedCoupon.id === id) {
        clearSelectedCoupon();
        return;
      }
      
      // é€‰æ‹©æ–°çš„ä¼˜æƒ åˆ¸
      selectedCoupon = coupon;
      showToast(`å·²é€‰æ‹©${coupon.discount * 10}æŠ˜ä¼˜æƒ åˆ¸`);
      
      // åˆ‡æ¢åˆ°è´­ç‰©è½¦é¡µé¢
      switchToPage('cart');
      
      // æ›´æ–°è´­ç‰©è½¦UI
      updateCartUI();
      
      // å¦‚æœè´­ç‰©è½¦ä¸ä¸ºç©ºï¼Œè‡ªåŠ¨è¿›å…¥ç»“ç®—é¡µé¢
      if (cart.length > 0) {
        setTimeout(() => {
          switchToPage('checkout');
        }, 500);
      }
    }

    // æ›´æ–°æˆ‘çš„ä¼˜æƒ åˆ¸åˆ—è¡¨
    function updateMyCoupons() {
      const myCouponsContainer = document.getElementById('my-coupons');
      
      if (!myCouponsContainer) return;
      
      if (availableCoupons.length === 0) {
        myCouponsContainer.innerHTML = `
          <div class="text-center py-8">
            <i class="fa fa-ticket text-4xl text-gray-300 mb-4"></i>
            <p class="text-gray-500">æš‚æ— ä¼˜æƒ åˆ¸</p>
            <button onclick="showCouponModal()" class="mt-4 bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90">
              è·å–ä¼˜æƒ åˆ¸
            </button>
          </div>
        `;
        return;
      }
      
      myCouponsContainer.innerHTML = availableCoupons.map(coupon => `
        <div class="coupon-card ${coupon.used ? 'opacity-50' : ''} ${selectedCoupon?.id === coupon.id ? 'selected' : ''}" 
             data-id="${coupon.id}" ${!coupon.used ? `onclick="useCoupon(${coupon.id})"` : ''} style="cursor: ${!coupon.used ? 'pointer' : 'default'}">
          <div class="flex justify-between items-center">
            <div>
              <div class="coupon-discount">${(coupon.discount * 10).toFixed(0)}æŠ˜ä¼˜æƒ åˆ¸</div>
              <div class="coupon-condition">${coupon.condition || 'ç‰¹æ®Šæ´»åŠ¨'}</div>
              <div class="text-sm text-gray-500 mt-2">æœ‰æ•ˆæœŸè‡³ï¼š${new Date(coupon.expiryDate).toLocaleDateString()}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // æ˜¾ç¤ºä¼˜æƒ åˆ¸é¡µé¢
    function showCouponPage() {
      switchToPage('coupon');
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing initialization code ...
      
      // åˆå§‹åŒ–ä¼˜æƒ åˆ¸
      loadAvailableCoupons();
      updateMyCoupons();
      
      // æ·»åŠ å¯¼èˆªæŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('home-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('menu');
      });
      
      document.getElementById('cart-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('cart');
      });
      
      document.getElementById('coupon-nav').addEventListener('click', function(e) {
        e.preventDefault();
        showCouponPage();
      });
      
      // ä¸º"çˆ¸çˆ¸"ä¼˜æƒ åˆ¸æŒ‰é’®æ·»åŠ äº‹ä»¶
      document.getElementById('startRecordingBtn').addEventListener('click', function() {
        // ä½¿ç”¨Web Speech APIè¿›è¡Œè¯­éŸ³è¯†åˆ«
        document.getElementById('startRecordingBtn').classList.add('hidden');
        document.getElementById('recording-controls').classList.remove('hidden');
        document.getElementById('voice-animation-daddy').classList.remove('hidden');
        document.getElementById('voice-animation-daddy').classList.add('recording');
        
        startDaddyVoiceRecognition();
      });
      
      document.getElementById('stopRecordingBtn').addEventListener('click', function() {
        stopDaddyVoiceRecognition();
      });
      
      document.getElementById('cancelRecordingBtn').addEventListener('click', function() {
        // åœæ­¢å½•éŸ³å¹¶é‡ç½®çŠ¶æ€ï¼Œä¸å¤„ç†ç»“æœ
        stopDaddyVoiceRecognition();
        document.getElementById('recording-controls').classList.add('hidden');
        document.getElementById('startRecordingBtn').classList.remove('hidden');
        document.getElementById('voice-animation-daddy').classList.add('hidden');
        document.getElementById('voice-animation-daddy').classList.remove('recording');
        document.getElementById('daddy-voice-result').classList.add('hidden');
      });
      
      // ç‚¹å‡»æ•²å¤´åŠ¨ç”»èƒŒæ™¯å…³é—­
      document.getElementById('knockHeadAnimation').addEventListener('click', function(e) {
        if (e.target === this) {
          closeKnockHeadAnimation();
        }
      });
    });
    
    // ... existing code ...

    // åˆå§‹åŒ–å˜é‡å’Œå…ƒç´ 
    // const searchInput = document.getElementById('search-input'); // å·²åœ¨å‰é¢å£°æ˜è¿‡
    const voiceSearchBtn = document.getElementById('voice-search-btn');
    const voiceSearchModal = document.getElementById('voice-search-modal');
    const voiceAnimation = document.getElementById('voice-animation');
    const voiceResult = document.getElementById('voice-result');
    const voiceCancelBtn = document.getElementById('voice-cancel-btn');
    const voiceConfirmBtn = document.getElementById('voice-confirm-btn');
    
    // è¯­éŸ³è¯†åˆ«å˜é‡
    let recognition;
    let recognitionResult = '';
    
    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
    function initSpeechRecognition() {
      // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.lang = 'zh-CN'; // è®¾ç½®ä¸ºä¸­æ–‡
        
        // å¤„ç†è¯†åˆ«ç»“æœ
        recognition.onresult = function(event) {
          let interimTranscript = '';
          let finalTranscript = '';
          
          for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
              finalTranscript += transcript;
            } else {
              interimTranscript += transcript;
            }
          }
          
          // æ˜¾ç¤ºè¯†åˆ«ç»“æœ
          recognitionResult = finalTranscript || interimTranscript;
          voiceResult.textContent = recognitionResult || 'æ­£åœ¨è†å¬...';
        };
        
        // å¤„ç†è¯†åˆ«ç»“æŸ
        recognition.onend = function() {
          voiceAnimation.classList.remove('recording');
          if (!recognitionResult) {
            voiceResult.textContent = 'æœªèƒ½è¯†åˆ«ï¼Œè¯·é‡è¯•';
          }
        };
        
        // å¤„ç†é”™è¯¯
        recognition.onerror = function(event) {
          console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
          voiceAnimation.classList.remove('recording');
          voiceResult.textContent = 'è¯†åˆ«å‡ºé”™ï¼Œè¯·é‡è¯•';
        };
      } else {
        voiceSearchBtn.style.display = 'none';
        console.warn('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
      }
    }
    
    // å¼€å§‹è¯­éŸ³è¯†åˆ«
    function startVoiceRecognition() {
      if (recognition) {
        voiceSearchModal.classList.remove('hidden');
        voiceAnimation.classList.add('recording');
        voiceResult.textContent = 'è¯·è¯´å‡ºæ‚¨æƒ³è¦çš„ç¾é£Ÿ';
        recognitionResult = '';
        
        try {
          recognition.start();
        } catch (e) {
          console.error('è¯­éŸ³è¯†åˆ«å¯åŠ¨å¤±è´¥:', e);
        }
      }
    }
    
    // åœæ­¢è¯­éŸ³è¯†åˆ«
    function stopVoiceRecognition() {
      if (recognition) {
        try {
          recognition.stop();
        } catch (e) {
          console.error('è¯­éŸ³è¯†åˆ«åœæ­¢å¤±è´¥:', e);
        }
      }
    }
    
    // ç¡®è®¤è¯­éŸ³æœç´¢ç»“æœ
    function confirmVoiceSearch() {
      if (recognitionResult) {
        searchInput.value = recognitionResult;
        searchTerm = recognitionResult.toLowerCase();
        renderFoodList();
        showToast(`æ­£åœ¨æœç´¢: ${recognitionResult}`);
      }
      voiceSearchModal.classList.add('hidden');
      stopVoiceRecognition();
    }
    
    // å–æ¶ˆè¯­éŸ³æœç´¢
    function cancelVoiceSearch() {
      voiceSearchModal.classList.add('hidden');
      stopVoiceRecognition();
    }
    
    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
    initSpeechRecognition();
    
    // ç»‘å®šè¯­éŸ³æœç´¢æŒ‰é’®äº‹ä»¶
    voiceSearchBtn.addEventListener('click', startVoiceRecognition);
    voiceCancelBtn.addEventListener('click', cancelVoiceSearch);
    voiceConfirmBtn.addEventListener('click', confirmVoiceSearch);
    
    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    voiceSearchModal.addEventListener('click', function(e) {
      if (e.target === voiceSearchModal) {
        cancelVoiceSearch();
      }
    });

    // åˆå§‹åŒ–å˜é‡
    let pendingOrders = [];
    let completedOrders = [];

    // æ›´æ–°å¾…ç»“ç®—è®¢å•
    function updatePendingOrders() {
      const pendingOrdersList = document.getElementById('pending-orders-list');
      const emptyPending = document.getElementById('empty-pending');
      
      // å¦‚æœæ²¡æœ‰å¾…ç»“ç®—è®¢å•
      if (pendingOrders.length === 0) {
        pendingOrdersList.classList.add('hidden');
        emptyPending.classList.remove('hidden');
        return;
      }
      
      // æ˜¾ç¤ºå¾…ç»“ç®—è®¢å•åˆ—è¡¨
      pendingOrdersList.classList.remove('hidden');
      emptyPending.classList.add('hidden');
      
      // æ¸…ç©ºåˆ—è¡¨
      pendingOrdersList.innerHTML = '';
      
      // æ·»åŠ å¾…ç»“ç®—è®¢å•
      pendingOrders.forEach((order, index) => {
        const orderElement = document.createElement('div');
        orderElement.className = 'bg-white rounded-xl shadow-sm overflow-hidden mb-4';
        
        // è®¡ç®—è®¢å•æ€»é‡‘é¢
        const totalAmount = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        orderElement.innerHTML = `
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-bold">å¾…ç»“ç®—è®¢å• #${index + 1}</h3>
              <span class="text-primary font-bold">Â¥${totalAmount.toFixed(2)}</span>
            </div>
            <div class="text-sm text-gray-500 mb-3">
              ${order.items.length}ä»¶å•†å“ | ${new Date(order.time).toLocaleString()}
            </div>
            <div class="space-y-2 mb-4">
              ${order.items.map(item => `
                <div class="flex justify-between">
                  <span>${item.name} x${item.quantity}</span>
                  <span>Â¥${(item.price * item.quantity).toFixed(2)}</span>
                </div>
              `).join('')}
            </div>
            <div class="flex space-x-2">
              <button class="flex-1 bg-primary hover:bg-primary/90 text-white font-medium py-2 rounded-lg transition-all" onclick="checkoutPendingOrder(${index})">
                å»ç»“ç®—
              </button>
              <button class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 rounded-lg transition-all" onclick="deletePendingOrder(${index})">
                åˆ é™¤
              </button>
            </div>
          </div>
        `;
        
        pendingOrdersList.appendChild(orderElement);
      });
    }
    
    // ç»“ç®—å¾…ç»“ç®—è®¢å•
    function checkoutPendingOrder(index) {
      const order = pendingOrders[index];
      if (!order) return;
      
      // å°†å¾…ç»“ç®—è®¢å•ä¸­çš„å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦
      cart = [...order.items];
      
      // åˆ é™¤è¯¥å¾…ç»“ç®—è®¢å•
      pendingOrders.splice(index, 1);
      savePendingOrders();
      
      // è·³è½¬åˆ°ç»“ç®—é¡µé¢
      switchToPage('checkout');
    }
    
    // åˆ é™¤å¾…ç»“ç®—è®¢å•
    function deletePendingOrder(index) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¾…ç»“ç®—è®¢å•å—ï¼Ÿ')) {
        pendingOrders.splice(index, 1);
        savePendingOrders();
        updatePendingOrders();
        showToast('å·²åˆ é™¤å¾…ç»“ç®—è®¢å•');
      }
    }
    
    // ä¿å­˜å¾…ç»“ç®—è®¢å•åˆ°localStorage
    function savePendingOrders() {
      localStorage.setItem('pendingOrders', JSON.stringify(pendingOrders));
    }
    
    // åŠ è½½å¾…ç»“ç®—è®¢å•
    function loadPendingOrders() {
      try {
        const savedPendingOrders = localStorage.getItem('pendingOrders');
        if (savedPendingOrders) {
          pendingOrders = JSON.parse(savedPendingOrders);
        }
      } catch (error) {
        console.error('åŠ è½½å¾…ç»“ç®—è®¢å•å¤±è´¥:', error);
        pendingOrders = [];
      }
    }
    
    // å°†å½“å‰è´­ç‰©è½¦ä¿å­˜ä¸ºå¾…ç»“ç®—è®¢å•
    function saveAsPendingOrder() {
      if (cart.length === 0) {
        showToast('è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•ä¿å­˜');
        return;
      }
      
      const pendingOrder = {
        time: new Date().toISOString(),
        items: [...cart]
      };
      
      pendingOrders.push(pendingOrder);
      savePendingOrders();
      
      // æ¸…ç©ºè´­ç‰©è½¦
      cart = [];
      updateCartUI();
      
      showToast('å·²ä¿å­˜åˆ°å¾…ç»“ç®—è®¢å•');
      switchToPage('pending');
    }
    
    // æ›´æ–°è®¢å•åˆ—è¡¨
    function updateOrdersList() {
      const ordersList = document.getElementById('orders-list');
      const emptyOrders = document.getElementById('empty-orders');
      
      // å¦‚æœæ²¡æœ‰å·²å®Œæˆè®¢å•
      if (completedOrders.length === 0) {
        ordersList.classList.add('hidden');
        emptyOrders.classList.remove('hidden');
        return;
      }
      
      // æ˜¾ç¤ºè®¢å•åˆ—è¡¨
      ordersList.classList.remove('hidden');
      emptyOrders.classList.add('hidden');
      
      // æ¸…ç©ºåˆ—è¡¨
      ordersList.innerHTML = '';
      
      // æ·»åŠ å·²å®Œæˆè®¢å•
      completedOrders.forEach((order, index) => {
        const orderElement = document.createElement('div');
        orderElement.className = 'bg-white rounded-xl shadow-sm overflow-hidden mb-4';
        
        orderElement.innerHTML = `
          <div class="p-4">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-bold">è®¢å• #${order.id}</h3>
              <span class="text-primary font-bold">Â¥${order.amount.toFixed(2)}</span>
            </div>
            <div class="text-sm text-gray-500 mb-3">
              ${order.items.length}ä»¶å•†å“ | ${new Date(order.time).toLocaleString()}
            </div>
            <div class="space-y-2 mb-4">
              ${order.items.slice(0, 2).map(item => `
                <div class="flex justify-between">
                  <span>${item.name} x${item.quantity}</span>
                  <span>Â¥${(item.price * item.quantity).toFixed(2)}</span>
                </div>
              `).join('')}
              ${order.items.length > 2 ? `<div class="text-gray-500 text-sm">ç­‰${order.items.length}ä»¶å•†å“</div>` : ''}
            </div>
            <div class="flex justify-between items-center">
              <div class="text-sm">
                <span class="text-gray-500">çŠ¶æ€:</span>
                <span class="text-green-500">å·²å®Œæˆ</span>
              </div>
              <button class="bg-primary/10 hover:bg-primary/20 text-primary px-4 py-2 rounded-lg transition-all" onclick="viewOrderDetail(${index})">
                æŸ¥çœ‹è¯¦æƒ…
              </button>
            </div>
          </div>
        `;
        
        ordersList.appendChild(orderElement);
      });
    }
    
    // æŸ¥çœ‹è®¢å•è¯¦æƒ…
    function viewOrderDetail(index) {
      const order = completedOrders[index];
      if (!order) return;
      
      // è®¾ç½®å½“å‰è®¢å•
      currentOrder = order;
      
      // æ˜¾ç¤ºè®¢å•è¯¦æƒ…é¡µé¢
      switchToPage('orderDetail');
    }
    
    // ä¿å­˜å·²å®Œæˆè®¢å•åˆ°localStorage
    function saveCompletedOrders() {
      localStorage.setItem('completedOrders', JSON.stringify(completedOrders));
    }
    
    // åŠ è½½å·²å®Œæˆè®¢å•
    function loadCompletedOrders() {
      try {
        const savedCompletedOrders = localStorage.getItem('completedOrders');
        if (savedCompletedOrders) {
          completedOrders = JSON.parse(savedCompletedOrders);
        }
      } catch (error) {
        console.error('åŠ è½½å·²å®Œæˆè®¢å•å¤±è´¥:', error);
        completedOrders = [];
      }
    }

    // ä¿®æ”¹handlePlaceOrderå‡½æ•°ï¼Œæ·»åŠ ä¿å­˜åˆ°å·²å®Œæˆè®¢å•çš„åŠŸèƒ½
    function handlePlaceOrder() {
      if (cart.length === 0) {
        showToast('è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•æäº¤è®¢å•');
        return;
      }
      
      // è®¡ç®—è®¢å•æ€»é¢ï¼ˆè€ƒè™‘ä¼˜æƒ åˆ¸ï¼‰
      let subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
      let total = subtotal;
      let discount = 0;
      
      if (selectedCoupon) {
        discount = subtotal * (1 - selectedCoupon.discount);
        total = subtotal - discount;
      }
      
      // æ›´æ–°è®¢å•é‡‘é¢
      orderAmountSpan.textContent = `Â¥${total.toFixed(2)}`;
      
      // ä¿å­˜å½“å‰è®¢å•æ•°æ®ç”¨äºè®¢å•è¯¦æƒ…é¡µ
      currentOrder = {
        id: generateOrderNumber(),
        time: new Date().toISOString().slice(0, 16).replace('T', ' '),
        amount: total,
        subtotal: subtotal,
        discount: discount,
        payment: document.querySelector('input[name="payment"]:checked').nextElementSibling.textContent.trim(),
        recipient: detailRecipient.textContent,
        phone: detailPhone.textContent,
        address: detailAddress.textContent,
        items: [...cart],
        usedCoupon: selectedCoupon ? { ...selectedCoupon } : null
      };
      
      // å°†è®¢å•æ·»åŠ åˆ°å·²å®Œæˆè®¢å•åˆ—è¡¨
      completedOrders.unshift(currentOrder);
      saveCompletedOrders();
      
      // å¦‚æœä½¿ç”¨äº†ä¼˜æƒ åˆ¸ï¼Œæ ‡è®°ä¸ºå·²ä½¿ç”¨
      if (selectedCoupon) {
        const couponIndex = availableCoupons.findIndex(c => c.id === selectedCoupon.id);
        if (couponIndex !== -1) {
          availableCoupons[couponIndex].used = true;
          saveAvailableCoupons();
        }
      }
      
      // æ˜¾ç¤ºç»“ç®—æˆåŠŸé¡µ
      checkoutPage.classList.add('hidden');
      successPage.classList.remove('hidden');
      
      // æ›´æ–°æˆåŠŸé¡µé¢ä¼˜æƒ ä¿¡æ¯
      updateSuccessPageInfo();
      
      // æ¸…ç†å·²ç»ä½¿ç”¨çš„ä¼˜æƒ åˆ¸
      cleanupUsedCoupons();
      
      // æ¸…ç©ºè´­ç‰©è½¦
      cart = [];
    }

    // æ·»åŠ å¯¼èˆªæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing initialization code ...
      
      document.getElementById('pending-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('pending');
      });
      
      document.getElementById('orders-nav').addEventListener('click', function(e) {
        e.preventDefault();
        switchToPage('orders');
      });
      
      document.getElementById('back-to-menu-from-pending').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      document.getElementById('back-to-menu-from-orders').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      document.getElementById('go-to-menu-from-empty-pending').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      document.getElementById('go-to-menu-from-empty-orders').addEventListener('click', function() {
        switchToPage('menu');
      });
      
      // åŠ è½½å¾…ç»“ç®—è®¢å•å’Œå·²å®Œæˆè®¢å•
      loadPendingOrders();
      loadCompletedOrders();
    });
// ... existing code ...
  </script>
</body>
</html>